var GeoStylerLegend=function(P){"use strict";var Ch=Object.defineProperty;var vh=(P,C,q)=>C in P?Ch(P,C,{enumerable:!0,configurable:!0,writable:!0,value:q}):P[C]=q;var E=(P,C,q)=>vh(P,typeof C!="symbol"?C+"":C,q);var C={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function q(i){const t=Kt();for(let e=0,n=i.length;e<n;++e)pr(t,i[e]);return t}function Jt(i,t,e){let n,r;return t<i[0]?n=i[0]-t:i[2]<t?n=t-i[2]:n=0,e<i[1]?r=i[1]-e:i[3]<e?r=e-i[3]:r=0,n*n+r*r}function gr(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function mr(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function He(i,t){const e=i[0],n=i[1],r=i[2],s=i[3],a=t[0],o=t[1];let l=C.UNKNOWN;return a<e?l=l|C.LEFT:a>r&&(l=l|C.RIGHT),o<n?l=l|C.BELOW:o>s&&(l=l|C.ABOVE),l===C.UNKNOWN&&(l=C.INTERSECTING),l}function Kt(){return[1/0,1/0,-1/0,-1/0]}function Ve(i,t,e,n,r){return r?(r[0]=i,r[1]=t,r[2]=e,r[3]=n,r):[i,t,e,n]}function Je(i){return Ve(1/0,1/0,-1/0,-1/0,i)}function _r(i,t){const e=i[0],n=i[1];return Ve(e,n,e,n,t)}function yr(i,t,e,n,r){const s=Je(r);return Ke(s,i,t,e,n)}function pr(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function Ke(i,t,e,n,r){for(;e<n;e+=r)xr(i,t[e],t[e+1]);return i}function xr(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function Sr(i,t){let e;return e=t(wr(i)),e||(e=t(Cr(i)),e)||(e=t(Or(i)),e)||(e=t(vr(i)),e)?e:!1}function wr(i){return[i[0],i[1]]}function Cr(i){return[i[2],i[1]]}function Ze(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function je(i){return i[3]-i[1]}function vr(i){return[i[0],i[3]]}function Or(i){return[i[2],i[3]]}function U(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function br(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function Er(i,t,e){let n=!1;const r=He(i,t),s=He(i,e);if(r===C.INTERSECTING||s===C.INTERSECTING)n=!0;else{const a=i[0],o=i[1],l=i[2],h=i[3],c=t[0],f=t[1],u=e[0],d=e[1],g=(d-f)/(u-c);let m,y;s&C.ABOVE&&!(r&C.ABOVE)&&(m=u-(d-h)/g,n=m>=a&&m<=l),!n&&s&C.RIGHT&&!(r&C.RIGHT)&&(y=d-(u-l)*g,n=y>=o&&y<=h),!n&&s&C.BELOW&&!(r&C.BELOW)&&(m=u-(d-o)/g,n=m>=a&&m<=l),!n&&s&C.LEFT&&!(r&C.LEFT)&&(y=d-(u-a)*g,n=y>=o&&y<=h)}return n}let Qe=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var kr={PROPERTYCHANGE:"propertychange"};let Fr=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function Lr(i,t,e){let n,r;e=e||ti;let s=0,a=i.length,o=!1;for(;s<a;)n=s+(a-s>>1),r=+e(i[n],t),r<0?s=n+1:(a=n,o=!r);return o?s:~s}function ti(i,t){return i>t?1:i<t?-1:0}function ei(i,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let r=0;r<n;r++)i[i.length]=e[r]}function ii(i,t){const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}function ni(){}function Ir(i){let t,e,n;return function(){const r=Array.prototype.slice.call(arguments);return(!e||this!==n||!ii(r,e))&&(n=this,e=r,t=i.apply(this,arguments)),t}}function ri(i){for(const t in i)delete i[t]}function Ar(i){let t;for(t in i)return!1;return!t}let si=class extends Fr{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),r=n[t]||(n[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,r=this.listeners_&&this.listeners_[n];if(!r)return;const s=e?new Qe(t):t;s.target||(s.target=this.eventTarget_||this);const a=this.dispatching_||(this.dispatching_={}),o=this.pendingRemovals_||(this.pendingRemovals_={});n in a||(a[n]=0,o[n]=0),++a[n];let l;for(let h=0,c=r.length;h<c;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(s):l=r[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--a[n]===0){let h=o[n];for(delete o[n];h--;)this.removeEventListener(n,ni);delete a[n]}return l}disposeInternal(){this.listeners_&&ri(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const r=n.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[r]=ni,++this.pendingRemovals_[t]):(n.splice(r,1),n.length===0&&delete this.listeners_[t]))}};var st={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function St(i,t,e,n,r){if(r){const a=e;e=function(){i.removeEventListener(t,e),a.apply(n??this,arguments)}}else n&&n!==i&&(e=e.bind(n));const s={target:i,type:t,listener:e};return i.addEventListener(t,e),s}function ai(i,t,e,n){return St(i,t,e,n,!0)}function Zt(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),ri(i))}let Rr=class extends si{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(st.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=St(this,t[s],e);return r}return St(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const r=t.length;n=new Array(r);for(let s=0;s<r;++s)n[s]=ai(this,t[s],e)}else n=ai(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)Tr(n);else if(Array.isArray(t))for(let r=0,s=t.length;r<s;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}};function Tr(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)Zt(i[t]);else Zt(i)}function M(){throw new Error("Unimplemented abstract method.")}let Mr=0;function Pr(i){return i.ol_uid||(i.ol_uid=String(++Mr))}let oi=class extends Qe{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}},jt=class extends Rr{constructor(t){super(),this.on,this.once,this.un,Pr(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new oi(n,t,e)),n=kr.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new oi(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const r=this.values_||(this.values_={});if(n)r[t]=e;else{const s=r[t];r[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],Ar(this.values_)&&(this.values_=null),e||this.notify(t,n)}}};function Dr(i,t){if(!i)throw new Error(t)}new Array(6);function Qt(){return[1,0,0,1,0,0]}function li(i,t,e,n,r,s,a,o){const l=Math.sin(s),h=Math.cos(s);return i[0]=n*h,i[1]=r*l,i[2]=-n*l,i[3]=r*h,i[4]=a*n*h-o*n*l+t,i[5]=a*r*l+o*r*h+e,i}const Nr={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let hi=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Nr[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const at=6378137,H=Math.PI*at,Gr=[-H,-H,H,H],zr=[-180,-85,180,85],wt=at*Math.log(Math.tan(Math.PI/2));let V=class extends hi{constructor(t){super({code:t,units:"m",extent:Gr,global:!0,worldExtent:zr,getPointResolution:function(e,n){return e/Math.cosh(n[1]/at)}})}};const ci=[new V("EPSG:3857"),new V("EPSG:102100"),new V("EPSG:102113"),new V("EPSG:900913"),new V("http://www.opengis.net/def/crs/EPSG/0/3857"),new V("http://www.opengis.net/gml/srs/epsg.xml#3857")];function $r(i,t,e,n){const r=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let s=0;s<r;s+=n){t[s]=H*i[s]/180;let a=at*Math.log(Math.tan(Math.PI*(+i[s+1]+90)/360));a>wt?a=wt:a<-wt&&(a=-wt),t[s+1]=a}return t}function Wr(i,t,e,n){const r=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let s=0;s<r;s+=n)t[s]=180*i[s]/H,t[s+1]=360*Math.atan(Math.exp(i[s+1]/at))/Math.PI-90;return t}const Xr=6378137,ui=[-180,-90,180,90],Br=Math.PI*Xr/180;let $=class extends hi{constructor(t,e){super({code:t,units:"degrees",extent:ui,axisOrientation:e,global:!0,metersPerUnit:Br,worldExtent:ui})}};const fi=[new $("CRS:84"),new $("EPSG:4326","neu"),new $("urn:ogc:def:crs:OGC:1.3:CRS84"),new $("urn:ogc:def:crs:OGC:2:84"),new $("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new $("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new $("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let te={};function Yr(i){return te[i]||te[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function qr(i,t){te[i]=t}let J={};function Ct(i,t,e){const n=i.getCode(),r=t.getCode();n in J||(J[n]={}),J[n][r]=e}function Ur(i,t){let e;return i in J&&t in J[i]&&(e=J[i][t]),e}function vt(i,t,e){return Math.min(Math.max(i,t),e)}function Hr(i,t,e,n,r,s){const a=r-e,o=s-n;if(a!==0||o!==0){const l=((i-e)*a+(t-n)*o)/(a*a+o*o);l>1?(e=r,n=s):l>0&&(e+=a*l,n+=o*l)}return K(i,t,e,n)}function K(i,t,e,n){const r=e-i,s=n-t;return r*r+s*s}function ee(i,t,e){return i+e*(t-i)}function Vr(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function di(i,t){if(t!==void 0){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];t=t}else t=i.slice();return t}function Jr(i,t){if(t!==void 0&&i!==t){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];i=t}return i}function Kr(i){qr(i.getCode(),i),Ct(i,i,di)}function Zr(i){i.forEach(Kr)}function ie(i){return typeof i=="string"?Yr(i):i||null}function gi(i){Zr(i),i.forEach(function(t){i.forEach(function(e){t!==e&&Ct(t,e,di)})})}function jr(i,t,e,n){i.forEach(function(r){t.forEach(function(s){Ct(r,s,e),Ct(s,r,n)})})}function Qr(i,t){const e=i.getCode(),n=t.getCode();let r=Ur(e,n);return r||(r=Jr),r}function mi(i,t){const e=ie(i),n=ie(t);return Qr(e,n)}function ts(){gi(ci),gi(fi),jr(fi,ci,$r,Wr)}ts();function ot(i,t,e,n,r,s,a){s=s||[],a=a||2;let o=0;for(let l=t;l<e;l+=n){const h=i[l],c=i[l+1];s[o++]=r[0]*h+r[2]*c+r[4],s[o++]=r[1]*h+r[3]*c+r[5];for(let f=2;f<a;f++)s[o++]=i[l+f]}return s&&s.length!=o&&(s.length=o),s}function es(i,t,e,n,r,s,a){a=a||[];const o=Math.cos(r),l=Math.sin(r),h=s[0],c=s[1];let f=0;for(let u=t;u<e;u+=n){const d=i[u]-h,g=i[u+1]-c;a[f++]=h+d*o-g*l,a[f++]=c+d*l+g*o;for(let m=u+2;m<u+n;++m)a[f++]=i[m]}return a&&a.length!=f&&(a.length=f),a}function is(i,t,e,n,r,s,a,o){o=o||[];const l=a[0],h=a[1];let c=0;for(let f=t;f<e;f+=n){const u=i[f]-l,d=i[f+1]-h;o[c++]=l+r*u,o[c++]=h+s*d;for(let g=f+2;g<f+n;++g)o[c++]=i[g]}return o&&o.length!=c&&(o.length=c),o}function ns(i,t,e,n,r,s,a){a=a||[];let o=0;for(let l=t;l<e;l+=n){a[o++]=i[l]+r,a[o++]=i[l+1]+s;for(let h=l+2;h<l+n;++h)a[o++]=i[h]}return a&&a.length!=o&&(a.length=o),a}const _i=Qt();let rs=class extends jt{constructor(){super(),this.extent_=Kt(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Ir((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return M()}closestPointXY(t,e,n,r){return M()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return M()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Je(e),this.extentRevision_=this.getRevision()}return br(this.extent_,t)}rotate(t,e){M()}scale(t,e,n){M()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return M()}getType(){return M()}applyTransform(t){M()}intersectsExtent(t){return M()}translate(t,e){M()}transform(t,e){const n=ie(t),r=n.getUnits()=="tile-pixels"?function(s,a,o){const l=n.getExtent(),h=n.getWorldExtent(),c=je(h)/je(l);return li(_i,h[0],h[3],c,-c,0,0,0),ot(s,0,s.length,o,_i,a),mi(n,e)(s,a,o)}:mi(n,e);return this.applyTransform(r),this}},Ot=class extends rs{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return yr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return M()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=yi(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){M()}setLayout(t,e,n){let r;if(t)r=yi(t);else{for(let s=0;s<n;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=ss(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();es(n,0,n.length,r,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=Ze(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();is(r,0,r.length,s,t,e,n,r),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();ns(n,0,n.length,r,t,e,n),this.changed()}}};function ss(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function yi(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function as(i,t,e){const n=i.getFlatCoordinates();if(!n)return null;const r=i.getStride();return ot(n,0,n.length,r,t,e)}function os(i,t,e,n){for(let r=0,s=e.length;r<s;++r)i[t++]=e[r];return t}function ne(i,t,e,n){for(let r=0,s=e.length;r<s;++r){const a=e[r];for(let o=0;o<n;++o)i[t++]=a[o]}return t}function ls(i,t,e,n,r){r=r||[];let s=0;for(let a=0,o=e.length;a<o;++a){const l=ne(i,t,e[a],n);r[s++]=l,t=l}return r.length=s,r}let re=class fr extends Ot{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new fr(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){const s=this.flatCoordinates,a=K(t,e,s[0],s[1]);if(a<r){const o=this.stride;for(let l=0;l<o;++l)n[l]=s[l];return n.length=o,a}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return _r(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return mr(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=os(this.flatCoordinates,0,t,this.stride),this.changed()}};function pi(i,t,e,n,r,s,a){const o=i[t],l=i[t+1],h=i[e]-o,c=i[e+1]-l;let f;if(h===0&&c===0)f=t;else{const u=((r-o)*h+(s-l)*c)/(h*h+c*c);if(u>1)f=e;else if(u>0){for(let d=0;d<n;++d)a[d]=ee(i[t+d],i[e+d],u);a.length=n;return}else f=t}for(let u=0;u<n;++u)a[u]=i[f+u];a.length=n}function se(i,t,e,n,r){let s=i[t],a=i[t+1];for(t+=n;t<e;t+=n){const o=i[t],l=i[t+1],h=K(s,a,o,l);h>r&&(r=h),s=o,a=l}return r}function hs(i,t,e,n,r){for(let s=0,a=e.length;s<a;++s){const o=e[s];r=se(i,t,o,n,r),t=o}return r}function ae(i,t,e,n,r,s,a,o,l,h,c){if(t==e)return h;let f,u;if(r===0){if(u=K(a,o,i[t],i[t+1]),u<h){for(f=0;f<n;++f)l[f]=i[t+f];return l.length=n,u}return h}c=c||[NaN,NaN];let d=t+n;for(;d<e;)if(pi(i,d-n,d,n,a,o,c),u=K(a,o,c[0],c[1]),u<h){for(h=u,f=0;f<n;++f)l[f]=c[f];l.length=n,d+=n}else d+=n*Math.max((Math.sqrt(u)-Math.sqrt(h))/r|0,1);if(s&&(pi(i,e-n,t,n,a,o,c),u=K(a,o,c[0],c[1]),u<h)){for(h=u,f=0;f<n;++f)l[f]=c[f];l.length=n}return h}function cs(i,t,e,n,r,s,a,o,l,h,c){c=c||[NaN,NaN];for(let f=0,u=e.length;f<u;++f){const d=e[f];h=ae(i,t,d,n,r,s,a,o,l,h,c),t=d}return h}function xi(i,t,e,n,r,s,a){const o=(e-t)/n;if(o<3){for(;t<e;t+=n)s[a++]=i[t],s[a++]=i[t+1];return a}const l=new Array(o);l[0]=1,l[o-1]=1;const h=[t,e-n];let c=0;for(;h.length>0;){const f=h.pop(),u=h.pop();let d=0;const g=i[u],m=i[u+1],y=i[f],x=i[f+1];for(let p=u+n;p<f;p+=n){const S=i[p],O=i[p+1],R=Hr(S,O,g,m,y,x);R>d&&(c=p,d=R)}d>r&&(l[(c-t)/n]=1,u+n<c&&h.push(u,c),c+n<f&&h.push(c,f))}for(let f=0;f<o;++f)l[f]&&(s[a++]=i[t+f*n],s[a++]=i[t+f*n+1]);return a}function Z(i,t){return t*Math.round(i/t)}function us(i,t,e,n,r,s,a){if(t==e)return a;let o=Z(i[t],r),l=Z(i[t+1],r);t+=n,s[a++]=o,s[a++]=l;let h,c;do if(h=Z(i[t],r),c=Z(i[t+1],r),t+=n,t==e)return s[a++]=h,s[a++]=c,a;while(h==o&&c==l);for(;t<e;){const f=Z(i[t],r),u=Z(i[t+1],r);if(t+=n,f==h&&u==c)continue;const d=h-o,g=c-l,m=f-o,y=u-l;if(d*y==g*m&&(d<0&&m<d||d==m||d>0&&m>d)&&(g<0&&y<g||g==y||g>0&&y>g)){h=f,c=u;continue}s[a++]=h,s[a++]=c,o=h,l=c,h=f,c=u}return s[a++]=h,s[a++]=c,a}function fs(i,t,e,n,r,s,a,o){for(let l=0,h=e.length;l<h;++l){const c=e[l];a=us(i,t,c,n,r,s,a),o.push(a),t=c}return a}function oe(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let a=t;a<e;a+=n)r[s++]=i.slice(a,a+n);return r.length=s,r}function ds(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let a=0,o=e.length;a<o;++a){const l=e[a];r[s++]=oe(i,t,l,n,r[s]),t=l}return r.length=s,r}function Si(i,t,e,n){let r=0;const s=i[e-n],a=i[e-n+1];let o=0,l=0;for(;t<e;t+=n){const h=i[t]-s,c=i[t+1]-a;r+=l*h-o*c,o=h,l=c}return r/2}function gs(i,t,e,n){let r=0;for(let s=0,a=e.length;s<a;++s){const o=e[s];r+=Si(i,t,o,n),t=o}return r}class lt extends Ot{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new lt(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,r){return r<Jt(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(se(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ae(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,r))}getArea(){return Si(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return oe(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=xi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new lt(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ne(this.flatCoordinates,0,t,this.stride),this.changed()}}function ms(i,t,e,n,r){return!Sr(r,function(a){return!W(i,t,e,n,a[0],a[1])})}function W(i,t,e,n,r,s){let a=0,o=i[e-n],l=i[e-n+1];for(;t<e;t+=n){const h=i[t],c=i[t+1];l<=s?c>s&&(h-o)*(s-l)-(r-o)*(c-l)>0&&a++:c<=s&&(h-o)*(s-l)-(r-o)*(c-l)<0&&a--,o=h,l=c}return a!==0}function wi(i,t,e,n,r,s){if(e.length===0||!W(i,t,e[0],n,r,s))return!1;for(let a=1,o=e.length;a<o;++a)if(W(i,e[a-1],e[a],n,r,s))return!1;return!0}function _s(i,t,e,n,r,s,a){let o,l,h,c,f,u,d;const g=r[s+1],m=[];for(let p=0,S=e.length;p<S;++p){const O=e[p];for(c=i[O-n],u=i[O-n+1],o=t;o<O;o+=n)f=i[o],d=i[o+1],(g<=u&&d<=g||u<=g&&g<=d)&&(h=(g-u)/(d-u)*(f-c)+c,m.push(h)),c=f,u=d}let y=NaN,x=-1/0;for(m.sort(ti),c=m[0],o=1,l=m.length;o<l;++o){f=m[o];const p=Math.abs(f-c);p>x&&(h=(c+f)/2,wi(i,t,e,n,h,g)&&(y=h,x=p)),c=f}return isNaN(y)&&(y=r[s]),[y,g,x]}function Ci(i,t,e,n,r){let s;for(t+=n;t<e;t+=n)if(s=r(i.slice(t-n,t),i.slice(t,t+n)),s)return s;return!1}function le(i,t,e,n,r){const s=Ke(Kt(),i,t,e,n);return U(r,s)?gr(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:Ci(i,t,e,n,function(a,o){return Er(r,a,o)}):!1}function ys(i,t,e,n,r){return!!(le(i,t,e,n,r)||W(i,t,e,n,r[0],r[1])||W(i,t,e,n,r[0],r[3])||W(i,t,e,n,r[2],r[1])||W(i,t,e,n,r[2],r[3]))}function ps(i,t,e,n,r){if(!ys(i,t,e[0],n,r))return!1;if(e.length===1)return!0;for(let s=1,a=e.length;s<a;++s)if(ms(i,e[s-1],e[s],n,r)&&!le(i,e[s-1],e[s],n,r))return!1;return!0}function xs(i,t,e,n){for(;t<e-n;){for(let r=0;r<n;++r){const s=i[t+r];i[t+r]=i[e-n+r],i[e-n+r]=s}t+=n,e-=n}}function vi(i,t,e,n){let r=0,s=i[e-n],a=i[e-n+1];for(;t<e;t+=n){const o=i[t],l=i[t+1];r+=(o-s)*(l+a),s=o,a=l}return r===0?void 0:r>0}function Ss(i,t,e,n,r){r=r!==void 0?r:!1;for(let s=0,a=e.length;s<a;++s){const o=e[s],l=vi(i,t,o,n);if(s===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;t=o}return!0}function Oi(i,t,e,n,r){r=r!==void 0?r:!1;for(let s=0,a=e.length;s<a;++s){const o=e[s],l=vi(i,t,o,n);(s===0?r&&l||!r&&!l:r&&!l||!r&&l)&&xs(i,t,o,n),t=o}return t}class bt extends Ot{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?ei(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new bt(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<Jt(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(hs(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),cs(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,r))}containsXY(t,e){return wi(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return gs(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Oi(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,ds(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Ze(this.getExtent());this.flatInteriorPoint_=_s(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new re(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new lt(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,r=[];let s=0;for(let a=0,o=n.length;a<o;++a){const l=n[a],h=new lt(e.slice(s,l),t);r.push(h),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Ss(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Oi(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=fs(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new bt(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return ps(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=ls(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function ws(i,t,e,n,r,s,a){let o,l;const h=(e-t)/n;if(h===1)o=t;else if(h===2)o=t,l=r;else if(h!==0){let c=i[t],f=i[t+1],u=0;const d=[0];for(let y=t+n;y<e;y+=n){const x=i[y],p=i[y+1];u+=Math.sqrt((x-c)*(x-c)+(p-f)*(p-f)),d.push(u),c=x,f=p}const g=r*u,m=Lr(d,g);m<0?(l=(g-d[-m-2])/(d[-m-1]-d[-m-2]),o=t+(-m-2)*n):o=t+m*n}a=a>1?a:2,s=s||new Array(a);for(let c=0;c<a;++c)s[c]=o===void 0?NaN:l===void 0?i[o+c]:ee(i[o+c],i[o+n+c],l);return s}function Cs(i,t,e,n,r,s){if(e==t)return null;let a;if(r<i[t+n-1])return s?(a=i.slice(t,t+n),a[n-1]=r,a):null;if(i[e-1]<r)return s?(a=i.slice(e-n,e),a[n-1]=r,a):null;if(r==i[t+n-1])return i.slice(t,t+n);let o=t/n,l=e/n;for(;o<l;){const u=o+l>>1;r<i[(u+1)*n-1]?l=u:o=u+1}const h=i[o*n-1];if(r==h)return i.slice((o-1)*n,(o-1)*n+n);const c=i[(o+1)*n-1],f=(r-h)/(c-h);a=[];for(let u=0;u<n-1;++u)a.push(ee(i[(o-1)*n+u],i[o*n+u],f));return a.push(r),a}function vs(i,t,e,n){let r=i[t],s=i[t+1],a=0;for(let o=t+n;o<e;o+=n){const l=i[o],h=i[o+1];a+=Math.sqrt((l-r)*(l-r)+(h-s)*(h-s)),r=l,s=h}return a}class Et extends Ot{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){ei(this.flatCoordinates,t),this.changed()}clone(){const t=new Et(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<Jt(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(se(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ae(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,r))}forEachSegment(t){return Ci(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Cs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return oe(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return ws(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return vs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=xi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Et(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return le(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ne(this.flatCoordinates,0,t,this.stride),this.changed()}}let Os=class{drawCustom(t,e,n,r,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,n){}drawFeature(t,e,n){}drawGeometryCollection(t,e,n){}drawLineString(t,e,n){}drawMultiLineString(t,e,n){}drawMultiPoint(t,e,n){}drawMultiPolygon(t,e,n){}drawPoint(t,e,n){}drawPolygon(t,e,n){}drawText(t,e,n){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}};var L={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};const D=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";D.includes("firefox"),D.includes("safari")&&!D.includes("chrom")&&(D.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(D)),D.includes("webkit")&&D.includes("edge"),D.includes("macintosh");const bs=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Es=typeof Image<"u"&&Image.prototype.decode;(function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i})();function ht(i,t,e,n){let r;return bs?r=new OffscreenCanvas(i||300,t||300):r=document.createElement("canvas"),i&&(r.width=i),t&&(r.height=t),r.getContext("2d",n)}let he;function bi(){return he||(he=ht(1,1)),he}var kt={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},I={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};I.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}},I.max=I.whitepoint[2].D65,I.rgb=function(i,t){t=t||I.whitepoint[2].E;var e=i[0]/t[0],n=i[1]/t[1],r=i[2]/t[2],s,a,o;return s=e*3.240969941904521+n*-1.537383177570093+r*-.498610760293,a=e*-.96924363628087+n*1.87596750150772+r*.041555057407175,o=e*.055630079696993+n*-.20397695888897+r*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,.4166666666666667)-.055:s=s*12.92,a=a>.0031308?1.055*Math.pow(a,.4166666666666667)-.055:a=a*12.92,o=o>.0031308?1.055*Math.pow(o,.4166666666666667)-.055:o=o*12.92,s=Math.min(Math.max(0,s),1),a=Math.min(Math.max(0,a),1),o=Math.min(Math.max(0,o),1),[s*255,a*255,o*255]},kt.xyz=function(i,t){var e=i[0]/255,n=i[1]/255,r=i[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=e*.41239079926595+n*.35758433938387+r*.18048078840183,a=e*.21263900587151+n*.71516867876775+r*.072192315360733,o=e*.019330818715591+n*.11919477979462+r*.95053215224966;return t=t||I.whitepoint[2].E,[s*t[0],a*t[1],o*t[2]]};var Ei={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,t,e){var n,r,s,a,o,l,h,c,f,u,d,g,m;if(s=i[0],a=i[1],o=i[2],s===0)return[0,0,0];var y=.0011070564598794539;return t=t||"D65",e=e||2,f=I.whitepoint[e][t][0],u=I.whitepoint[e][t][1],d=I.whitepoint[e][t][2],g=4*f/(f+15*u+3*d),m=9*u/(f+15*u+3*d),n=a/(13*s)+g||0,r=o/(13*s)+m||0,h=s>8?u*Math.pow((s+16)/116,3):u*s*y,l=h*9*n/(4*r)||0,c=h*(12-3*n-20*r)/(4*r)||0,[l,h,c]}};I.luv=function(i,t,e){var n,r,s,a,o,l,h,c,f,u,d,g,m,y=.008856451679035631,x=903.2962962962961;t=t||"D65",e=e||2,f=I.whitepoint[e][t][0],u=I.whitepoint[e][t][1],d=I.whitepoint[e][t][2],g=4*f/(f+15*u+3*d),m=9*u/(f+15*u+3*d),l=i[0],h=i[1],c=i[2],n=4*l/(l+15*h+3*c)||0,r=9*h/(l+15*h+3*c)||0;var p=h/u;return s=p<=y?x*p:116*Math.pow(p,.3333333333333333)-16,a=13*s*(n-g),o=13*s*(r-m),[s,a,o]},Ei.lchuv=function(i){var t=i[0],e=i[1],n=i[2],r=Math.sqrt(e*e+n*n),s=Math.atan2(n,e),a=s*360/2/Math.PI;return a<0&&(a+=360),[t,r,a]},I.lchuv=function(i){return Ei.lchuv(I.luv(i))};var ki={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Fi={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function ks(i){var c,f;var t,e=[],n=1,r;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),ki[i])e=ki[i].slice(),r="rgb";else if(i==="transparent")n=0,r="rgb",e=[0,0,0];else if(i[0]==="#"){var s=i.slice(1),a=s.length,o=a<=4;n=1,o?(e=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],a===4&&(n=parseInt(s[3]+s[3],16)/255)):(e=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],a===8&&(n=parseInt(s[6]+s[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),r="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var l=t[1];r=l.replace(/a$/,"");var h=r==="cmyk"?4:r==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=e.shift()),e=e.map(function(u,d){if(u[u.length-1]==="%")return u=parseFloat(u)/100,d===3?u:r==="rgb"?u*255:r[0]==="h"||r[0]==="l"&&!d?u*100:r==="lab"?u*125:r==="lch"?d<2?u*150:u*360:r[0]==="o"&&!d?u:r==="oklab"?u*.4:r==="oklch"?d<2?u*.4:u*360:u;if(r[d]==="h"||d===2&&r[r.length-1]==="h"){if(Fi[u]!==void 0)return Fi[u];if(u.endsWith("deg"))return parseFloat(u);if(u.endsWith("turn"))return parseFloat(u)*360;if(u.endsWith("grad"))return parseFloat(u)*360/400;if(u.endsWith("rad"))return parseFloat(u)*180/Math.PI}return u==="none"?0:parseFloat(u)}),n=e.length>h?e.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(e=i.match(/([0-9]+)/g).map(function(u){return parseFloat(u)}),r=((f=(c=i.match(/([a-z])/ig))==null?void 0:c.join(""))==null?void 0:f.toLowerCase())||"rgb");return{space:r,values:e,alpha:n}}var ce={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var t=i[0]/360,e=i[1]/100,n=i[2]/100,r,s,a,o,l,h=0;if(e===0)return l=n*255,[l,l,l];for(s=n<.5?n*(1+e):n+e-n*e,r=2*n-s,o=[0,0,0];h<3;)a=t+1/3*-(h-1),a<0?a++:a>1&&a--,l=6*a<1?r+(s-r)*6*a:2*a<1?s:3*a<2?r+(s-r)*(2/3-a)*6:r,o[h++]=l*255;return o}};kt.hsl=function(i){var t=i[0]/255,e=i[1]/255,n=i[2]/255,r=Math.min(t,e,n),s=Math.max(t,e,n),a=s-r,o,l,h;return s===r?o=0:t===s?o=(e-n)/a:e===s?o=2+(n-t)/a:n===s&&(o=4+(t-e)/a),o=Math.min(o*60,360),o<0&&(o+=360),h=(r+s)/2,s===r?l=0:h<=.5?l=a/(s+r):l=a/(2-s-r),[o,l*100,h*100]};function Fs(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var t,e=ks(i);if(!e.space)return[];const n=e.space[0]==="h"?ce.min:kt.min,r=e.space[0]==="h"?ce.max:kt.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],n[0]),r[0]),t[1]=Math.min(Math.max(e.values[1],n[1]),r[1]),t[2]=Math.min(Math.max(e.values[2],n[2]),r[2]),e.space[0]==="h"&&(t=ce.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}const Ls=[NaN,NaN,NaN,0];function Is(i){return typeof i=="string"?i:Li(i)}const As=1024,ct={};let ue=0;function Rs(i){if(i==="none")return Ls;if(ct.hasOwnProperty(i))return ct[i];if(ue>=As){let e=0;for(const n in ct)e++&3||(delete ct[n],--ue)}const t=Fs(i);if(t.length!==4)throw new Error('failed to parse "'+i+'" as color');for(const e of t)if(isNaN(e))throw new Error('failed to parse "'+i+'" as color');return Ms(t),ct[i]=t,++ue,t}function Ts(i){return Array.isArray(i)?i:Rs(i)}function Ms(i){return i[0]=vt(i[0]+.5|0,0,255),i[1]=vt(i[1]+.5|0,0,255),i[2]=vt(i[2]+.5|0,0,255),i[3]=vt(i[3],0,1),i}function Li(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const r=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+r+")"}function Ps(i,t){return new Promise((e,n)=>{function r(){a(),e(i)}function s(){a(),n(new Error("Image load error"))}function a(){i.removeEventListener("load",r),i.removeEventListener("error",s)}i.addEventListener("load",r),i.addEventListener("error",s)})}function Ds(i,t){return t&&(i.src=t),i.src&&Es?new Promise((e,n)=>i.decode().then(()=>e(i)).catch(r=>i.complete&&i.width?e(i):n(r))):Ps(i)}let Ns=class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];!(t++&3)&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,n){const r=fe(t,e,n);return r in this.cache_?this.cache_[r]:null}getPattern(t,e,n){const r=fe(t,e,n);return r in this.patternCache_?this.patternCache_[r]:null}set(t,e,n,r,s){const a=fe(t,e,n),o=a in this.cache_;this.cache_[a]=r,s&&(r.getImageState()===L.IDLE&&r.load(),r.getImageState()===L.LOADING?r.ready().then(()=>{this.patternCache_[a]=bi().createPattern(r.getImage(1),"repeat")}):this.patternCache_[a]=bi().createPattern(r.getImage(1),"repeat")),o||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};function fe(i,t,e){const n=e?Ts(e):"null";return t+":"+i+":"+n}const N=new Ns;let ut=null,Gs=class extends si{constructor(t,e,n,r,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=s,this.imageState_=r===void 0?L.IDLE:r,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===L.LOADED){ut||(ut=ht(1,1,void 0,{willReadFrequently:!0})),ut.drawImage(this.image_,0,0);try{ut.getImageData(0,0,1,1),this.tainted_=!1}catch{ut=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(st.CHANGE)}handleImageError_(){this.imageState_=L.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=L.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=ht(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===L.IDLE){this.image_||this.initializeImage_(),this.imageState_=L.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Ds(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==L.LOADED)return;const e=this.image_,n=ht(Math.ceil(e.width*t),Math.ceil(e.height*t)),r=n.canvas;n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=Is(this.color_),n.fillRect(0,0,r.width/t,r.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=r}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===L.LOADED||this.imageState_===L.ERROR)t();else{const e=()=>{(this.imageState_===L.LOADED||this.imageState_===L.ERROR)&&(this.removeEventListener(st.CHANGE,e),t())};this.addEventListener(st.CHANGE,e)}})),this.ready_}};function zs(i,t,e,n,r,s){let a=t===void 0?void 0:N.get(t,e,r);return a||(a=new Gs(i,i&&"src"in i?i.src||void 0:t,e,n,r),N.set(t,e,r,a,s)),a&&!N.getPattern(t,e,r)&&N.set(t,e,r,a,s),a}function Ft(i){return i?Array.isArray(i)?Li(i):typeof i=="object"&&"src"in i?$s(i):i:null}function $s(i){if(!i.offset||!i.size)return N.getPattern(i.src,"anonymous",i.color);const t=i.src+":"+i.offset,e=N.getPattern(t,void 0,i.color);if(e)return e;const n=N.get(i.src,"anonymous",null);if(n.getImageState()!==L.LOADED)return null;const r=ht(i.size[0],i.size[1]);return r.drawImage(n.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),zs(r.canvas,t,void 0,L.LOADED,i.color,!0),N.getPattern(t,void 0,i.color)}const Ws="10px sans-serif",Ii="#000",Ai="round",Ri=[],Ti=0,Mi="round",Pi=10,Di="#000",Ni="center",Xs="middle",Gi=1;new jt;let Bs=class extends Os{constructor(t,e,n,r,s,a,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=r,this.transformRotation_=r?Vr(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=a,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Qt()}drawImages_(t,e,n,r){if(!this.image_)return;const s=ot(t,e,n,r,this.transform_,this.pixelCoordinates_),a=this.context_,o=this.tmpLocalTransform_,l=a.globalAlpha;this.imageOpacity_!=1&&(a.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,f=s.length;c<f;c+=2){const u=s[c]-this.imageAnchorX_,d=s[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=u+this.imageAnchorX_,m=d+this.imageAnchorY_;li(o,g,m,1,1,h,-g,-m),a.save(),a.transform.apply(a,o),a.translate(g,m),a.scale(this.imageScale_[0],this.imageScale_[1]),a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),a.restore()}else a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,u,d,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(a.globalAlpha=l)}drawText_(t,e,n,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=ot(t,e,n,r,this.transform_,this.pixelCoordinates_),a=this.context_;let o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<n;e+=r){const l=s[e]+this.textOffsetX_,h=s[e+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(a.save(),a.translate(l-this.textOffsetX_,h-this.textOffsetY_),a.rotate(o),a.translate(this.textOffsetX_,this.textOffsetY_),a.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&a.strokeText(this.text_,0,0),this.textFillState_&&a.fillText(this.text_,0,0),a.restore()):(this.textStrokeState_&&a.strokeText(this.text_,l,h),this.textFillState_&&a.fillText(this.text_,l,h))}}moveToLineTo_(t,e,n,r,s){const a=this.context_,o=ot(t,e,n,r,this.transform_,this.pixelCoordinates_);a.moveTo(o[0],o[1]);let l=o.length;s&&(l-=2);for(let h=2;h<l;h+=2)a.lineTo(o[h],o[h+1]);return s&&a.closePath(),n}drawRings_(t,e,n,r){for(let s=0,a=n.length;s<a;++s)e=this.moveToLineTo_(t,e,n[s],r,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!U(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=as(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],r=e[3]-e[1],s=Math.sqrt(n*n+r*r),a=this.context_;a.beginPath(),a.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const n=e.getGeometryFunction()(t);n&&(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,r=e.length;n<r;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!U(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(U(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,r=t.getFlatCoordinates();let s=0;const a=t.getEnds(),o=t.getStride();n.beginPath();for(let l=0,h=a.length;l<h;++l)s=this.moveToLineTo_(r,s,a[l],o,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!U(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!U(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let r=0;const s=t.getEndss(),a=t.getStride();e.beginPath();for(let o=0,l=s.length;o<l;++o){const h=s[o];r=this.drawRings_(n,r,h,a)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),ii(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,r=t.textAlign?t.textAlign:Ni;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=r&&(n.textAlign=r,e.textAlign=r),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:Ft(n||Ii)}}if(!e)this.strokeState_=null;else{const n=e.getColor(),r=e.getLineCap(),s=e.getLineDash(),a=e.getLineDashOffset(),o=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=s||Ri;this.strokeState_={lineCap:r!==void 0?r:Ai,lineDash:this.pixelRatio_===1?c:c.map(f=>f*this.pixelRatio_),lineDashOffset:(a||Ti)*this.pixelRatio_,lineJoin:o!==void 0?o:Mi,lineWidth:(l!==void 0?l:Gi)*this.pixelRatio_,miterLimit:h!==void 0?h:Pi,strokeStyle:Ft(n||Di)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),r=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*n,this.imageAnchorY_=r[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const a=t.getScaleArray();this.imageScale_=[a[0]*this.pixelRatio_/n,a[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const d=e.getColor();this.textFillState_={fillStyle:Ft(d||Ii)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const d=n.getColor(),g=n.getLineCap(),m=n.getLineDash(),y=n.getLineDashOffset(),x=n.getLineJoin(),p=n.getWidth(),S=n.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:Ai,lineDash:m||Ri,lineDashOffset:y||Ti,lineJoin:x!==void 0?x:Mi,lineWidth:p!==void 0?p:Gi,miterLimit:S!==void 0?S:Pi,strokeStyle:Ft(d||Di)}}const r=t.getFont(),s=t.getOffsetX(),a=t.getOffsetY(),o=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),f=t.getTextAlign(),u=t.getTextBaseline();this.textState_={font:r!==void 0?r:Ws,textAlign:f!==void 0?f:Ni,textBaseline:u!==void 0?u:Xs},this.text_=c!==void 0?Array.isArray(c)?c.reduce((d,g,m)=>d+=m%2?" ":g,""):c:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=a!==void 0?this.pixelRatio_*a:0,this.textRotateWithView_=o!==void 0?o:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}};function de(i){return i!=null&&typeof i.valueOf()=="string"}function Lt(i){return i!=null&&typeof i.valueOf()=="number"}function zi(i){return i!=null&&typeof i.valueOf()=="boolean"}const $i=i=>la(i)||Ys(i),Ys=i=>de(i)||Lt(i)||zi(i)||i===null,qs=i=>!!((i!=null&&i.min||i!=null&&i.max)&&(!i.min||me(i.min)||Lt(i.min))&&(!i.max||me(i.max)||Lt(i.min))),Us=i=>["==","*=","!=","<","<=",">",">=","<=x<="].includes(i),Hs=i=>["&&","||"].includes(i),Vs=i=>i==="!",ge=i=>Js(i)||Ks(i)||_e(i)||Zs(i)||_e(i)||zi(i),Js=i=>{const t=i&&i[0]==="<=x<="?4:3;return Array.isArray(i)&&i.length===t&&Us(i[0])&&$i(i[1])&&$i(i[2])&&(i[0]!=="<=x<="||Lt(i[3]))},Ks=i=>Array.isArray(i)&&i.length>=3&&Hs(i[0])&&i.every((t,e)=>e===0||ge(t)),Zs=i=>Array.isArray(i)&&i.length===2&&Vs(i[0])&&ge(i[1]),Wi=i=>js(i)||ia(i)||na(i)||ra(i),js=i=>Qs(i)||ea(i)||ta(i),Qs=i=>(i==null?void 0:i.kind)==="Icon",ta=i=>(i==null?void 0:i.kind)==="Text",ea=i=>(i==null?void 0:i.kind)==="Mark"&&de(i==null?void 0:i.wellKnownName),ia=i=>(i==null?void 0:i.kind)==="Line",na=i=>(i==null?void 0:i.kind)==="Fill",ra=i=>(i==null?void 0:i.kind)==="Raster",sa=i=>{var t;return!!(de(i==null?void 0:i.name)&&(!(i!=null&&i.filter)||ge(i.filter))&&(!(i!=null&&i.scaleDenominator)||qs(i.scaleDenominator))&&((t=i==null?void 0:i.symbolizers)!=null&&t.every(e=>Wi(e))))},me=i=>["abs","acos","add","asin","atan","atan2","ceil","cos","div","exp","floor","interpolate","log","max","min","modulo","mul","pi","pow","random","rint","round","sin","sqrt","strIndexOf","strLastIndexOf","strLength","sub","tan","toDegrees","toNumber","toRadians"].includes(i==null?void 0:i.name),aa=i=>["numberFormat","strAbbreviate","strCapitalize","strConcat","strDefaultIfBlank","strReplace","strStripAccents","strSubstring","strSubstringStart","strToLowerCase","strToString","strToUpperCase","strTrim"].includes(i==null?void 0:i.name),_e=i=>["all","any","between","double2bool","equalTo","greaterThan","greaterThanOrEqualTo","in","lessThan","lessThanOrEqualTo","not","notEqualTo","parseBoolean","strEndsWith","strEqualsIgnoreCase","strMatches","strStartsWith"].includes(i==null?void 0:i.name),oa=i=>["case","property","step"].includes(i==null?void 0:i.name),la=i=>_e(i)||me(i)||aa(i)||oa(i);function Xi(i){return!/^(-?\d|--)/.test(i)}function Bi(i){const t=[];let e="",n="",r=7;for(let s,a=0;s=i.charAt(a);a++)if(/[a-zA-Z\d\xa0-\uffff_-]/.test(s)&&r===7)e+=s;else if(s==="\\"&&r===7)r=6;else if(s===" "&&r===7){if(e!==""){if(!Xi(e))return null;t.push(e),e=""}}else if(r===6)/[0-9a-f]/i.test(s)?(n+=s,r=8):(e+=s,r=7);else{if(r!==8)return null;/[0-9a-f]/i.test(s)&&n.length<6?n+=s:(e+=String.fromCodePoint(parseInt(n,16)),e+=s,n="",r=7)}if(e!==""){if(!Xi(e))return null;t.push(e)}return t.join(" ")}function ha(i,t){let e=t,n="";const r={"font-family":[]};for(let s,a=0;s=i.charAt(a);a+=1)if(e!==4||s!=='"'&&s!=="'")if(e===3&&s===",")e=4,n="";else if(e===4&&s===","){const o=Bi(n);o&&r["font-family"].push(o),n=""}else if(e===5&&s===" ")/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:deg|grad|rad|turn)$/.test(n)?(r["font-style"]+=" "+n,n=""):a-=1,e=1;else if(e!==1||s!==" "&&s!=="/")e===2&&s===" "?(/^(?:\+|-)?([0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)?$/.test(n)&&(r["line-height"]=n),e=4,n=""):n+=s;else{if(/^(?:(?:xx|x)-large|(?:xx|s)-small|small|large|medium)$/.test(n)||/^(?:larg|small)er$/.test(n)||/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)$/.test(n))e=s==="/"?2:4,r["font-size"]=n;else if(/^italic$/.test(n))r["font-style"]=n;else if(/^oblique$/.test(n))r["font-style"]=n,e=5;else if(/^small-caps$/.test(n))r["font-variant"]=n;else if(/^(?:bold(?:er)?|lighter|normal)$/.test(n))r["font-weight"]=n;else if(/^[+-]?(?:[0-9]*\.)?[0-9]+(?:e[+-]?(?:0|[1-9][0-9]*))?$/.test(n)){const o=parseFloat(n);o>=1&&o<=1e3&&(r["font-weight"]=n)}else/^(?:(?:ultra|extra|semi)-)?(?:condensed|expanded)$/.test(n)&&(r["font-stretch"]=n);n=""}else{let o=a+1;do if(o=i.indexOf(s,o)+1,!o)return null;while(i.charAt(o-2)==="\\");r["font-family"].push(i.slice(a+1,o-1).replace(/\\('|")/g,"$1")),a=o-1,e=3,n=""}if(e===3&&!/^\s*$/.test(n))return null;if(e===4){const s=Bi(n);s&&r["font-family"].push(s)}return r}function ca(i){const t=ha(i,1);return t!==null&&t["font-size"]&&t["font-family"].length?t:null}function ua(i){return i!=null&&typeof i.valueOf()=="string"}const fa=i=>(i==null?void 0:i.kind)==="Icon",da=i=>(i==null?void 0:i.kind)==="Mark"&&ua(i==null?void 0:i.wellKnownName),ye=i=>["abs","acos","add","asin","atan","atan2","ceil","cos","div","exp","floor","interpolate","log","max","min","modulo","mul","pi","pow","random","rint","round","sin","sqrt","strIndexOf","strLastIndexOf","strLength","sub","tan","toDegrees","toNumber","toRadians"].includes(i==null?void 0:i.name),ft=i=>["numberFormat","strAbbreviate","strCapitalize","strConcat","strDefaultIfBlank","strReplace","strStripAccents","strSubstring","strSubstringStart","strToLowerCase","strToString","strToUpperCase","strTrim"].includes(i==null?void 0:i.name),It=i=>["all","any","between","double2bool","equalTo","greaterThan","greaterThanOrEqualTo","in","lessThan","lessThanOrEqualTo","not","notEqualTo","parseBoolean","strEndsWith","strEqualsIgnoreCase","strMatches","strStartsWith"].includes(i==null?void 0:i.name),Yi=i=>["case","property","step"].includes(i==null?void 0:i.name),k=i=>It(i)||ye(i)||ft(i)||Yi(i),pe=i=>typeof(i==null?void 0:i.source)=="string"||k(i==null?void 0:i.source)&&Array.isArray(i.position)&&Array.isArray(i.size);class qi{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}var ga={PROPERTYCHANGE:"propertychange"};class ma{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Ui(i,t){const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}function Hi(){}function _a(i){let t,e,n;return function(){const r=Array.prototype.slice.call(arguments);return(!e||this!==n||!Ui(r,e))&&(n=this,e=r,t=i.apply(this,arguments)),t}}function Vi(i){for(const t in i)delete i[t]}function ya(i){let t;for(t in i)return!1;return!t}class Ji extends ma{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),r=n[t]||(n[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,r=this.listeners_&&this.listeners_[n];if(!r)return;const s=e?new qi(t):t;s.target||(s.target=this.eventTarget_||this);const a=this.dispatching_||(this.dispatching_={}),o=this.pendingRemovals_||(this.pendingRemovals_={});n in a||(a[n]=0,o[n]=0),++a[n];let l;for(let h=0,c=r.length;h<c;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(s):l=r[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--a[n]===0){let h=o[n];for(delete o[n];h--;)this.removeEventListener(n,Hi);delete a[n]}return l}disposeInternal(){this.listeners_&&Vi(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const r=n.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[r]=Hi,++this.pendingRemovals_[t]):(n.splice(r,1),n.length===0&&delete this.listeners_[t]))}}var X={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function At(i,t,e,n,r){if(r){const a=e;e=function(){i.removeEventListener(t,e),a.apply(n??this,arguments)}}else n&&n!==i&&(e=e.bind(n));const s={target:i,type:t,listener:e};return i.addEventListener(t,e),s}function Ki(i,t,e,n){return At(i,t,e,n,!0)}function xe(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),Vi(i))}class pa extends Ji{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(X.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=At(this,t[s],e);return r}return At(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const r=t.length;n=new Array(r);for(let s=0;s<r;++s)n[s]=Ki(this,t[s],e)}else n=Ki(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)xa(n);else if(Array.isArray(t))for(let r=0,s=t.length;r<s;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}}function xa(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)xe(i[t]);else xe(i)}function b(){throw new Error("Unimplemented abstract method.")}let Sa=0;function Zi(i){return i.ol_uid||(i.ol_uid=String(++Sa))}class ji extends qi{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class Se extends pa{constructor(t){super(),this.on,this.once,this.un,Zi(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new ji(n,t,e)),n=ga.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new ji(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const r=this.values_||(this.values_={});if(n)r[t]=e;else{const s=r[t];r[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],ya(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}function Rt(i,t){if(!i)throw new Error(t)}const wa=new Array(6);function we(){return[1,0,0,1,0,0]}function Ca(i,t){const e=i[0],n=i[1],r=i[2],s=i[3],a=i[4],o=i[5],l=t[0],h=t[1],c=t[2],f=t[3],u=t[4],d=t[5];return i[0]=e*l+r*h,i[1]=n*l+s*h,i[2]=e*c+r*f,i[3]=n*c+s*f,i[4]=e*u+r*d+a,i[5]=n*u+s*d+o,i}function va(i,t,e,n,r,s,a){return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i[4]=s,i[5]=a,i}function Oa(i,t,e){return Ca(i,va(wa,t,0,0,e,0,0))}function Qi(i,t,e,n,r,s,a,o){const l=Math.sin(s),h=Math.cos(s);return i[0]=n*h,i[1]=r*l,i[2]=-n*l,i[3]=r*h,i[4]=a*n*h-o*n*l+t,i[5]=a*r*l+o*r*h+e,i}function ba(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function Ea(){return[1/0,1/0,-1/0,-1/0]}function tn(i,t,e,n,r){return r?(r[0]=i,r[1]=t,r[2]=e,r[3]=n,r):[i,t,e,n]}function en(i){return tn(1/0,1/0,-1/0,-1/0,i)}function ka(i,t){const e=i[0],n=i[1];return tn(e,n,e,n,t)}function Fa(i,t,e,n,r){const s=en(r);return La(s,i,t,e,n)}function La(i,t,e,n,r){for(;e<n;e+=r)Ia(i,t[e],t[e+1]);return i}function Ia(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function Aa(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function nn(i){return i[3]-i[1]}function dt(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function Ra(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}const rn={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class sn{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||rn[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const gt=6378137,j=Math.PI*gt,Ta=[-j,-j,j,j],Ma=[-180,-85,180,85],Tt=gt*Math.log(Math.tan(Math.PI/2));class Q extends sn{constructor(t){super({code:t,units:"m",extent:Ta,global:!0,worldExtent:Ma,getPointResolution:function(e,n){return e/Math.cosh(n[1]/gt)}})}}const an=[new Q("EPSG:3857"),new Q("EPSG:102100"),new Q("EPSG:102113"),new Q("EPSG:900913"),new Q("http://www.opengis.net/def/crs/EPSG/0/3857"),new Q("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Pa(i,t,e,n){const r=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let s=0;s<r;s+=n){t[s]=j*i[s]/180;let a=gt*Math.log(Math.tan(Math.PI*(+i[s+1]+90)/360));a>Tt?a=Tt:a<-Tt&&(a=-Tt),t[s+1]=a}return t}function Da(i,t,e,n){const r=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let s=0;s<r;s+=n)t[s]=180*i[s]/j,t[s+1]=360*Math.atan(Math.exp(i[s+1]/gt))/Math.PI-90;return t}const Na=6378137,on=[-180,-90,180,90],Ga=Math.PI*Na/180;class B extends sn{constructor(t,e){super({code:t,units:"degrees",extent:on,axisOrientation:e,global:!0,metersPerUnit:Ga,worldExtent:on})}}const ln=[new B("CRS:84"),new B("EPSG:4326","neu"),new B("urn:ogc:def:crs:OGC:1.3:CRS84"),new B("urn:ogc:def:crs:OGC:2:84"),new B("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new B("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new B("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ce={};function za(i){return Ce[i]||Ce[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function $a(i,t){Ce[i]=t}let tt={};function Mt(i,t,e){const n=i.getCode(),r=t.getCode();n in tt||(tt[n]={}),tt[n][r]=e}function Wa(i,t){let e;return i in tt&&t in tt[i]&&(e=tt[i][t]),e}function Pt(i,t,e){return Math.min(Math.max(i,t),e)}function Xa(i,t,e,n){const r=e-i,s=n-t;return r*r+s*s}function Ba(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function hn(i,t){if(t!==void 0){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];t=t}else t=i.slice();return t}function Ya(i,t){if(t!==void 0&&i!==t){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];i=t}return i}function qa(i){$a(i.getCode(),i),Mt(i,i,hn)}function Ua(i){i.forEach(qa)}function ve(i){return typeof i=="string"?za(i):i||null}function cn(i){Ua(i),i.forEach(function(t){i.forEach(function(e){t!==e&&Mt(t,e,hn)})})}function Ha(i,t,e,n){i.forEach(function(r){t.forEach(function(s){Mt(r,s,e),Mt(s,r,n)})})}function Va(i,t){const e=i.getCode(),n=t.getCode();let r=Wa(e,n);return r||(r=Ya),r}function un(i,t){const e=ve(i),n=ve(t);return Va(e,n)}function Ja(){cn(an),cn(ln),Ha(ln,an,Pa,Da)}Ja();function mt(i,t,e,n,r,s,a){s=s||[],a=a||2;let o=0;for(let l=t;l<e;l+=n){const h=i[l],c=i[l+1];s[o++]=r[0]*h+r[2]*c+r[4],s[o++]=r[1]*h+r[3]*c+r[5];for(let f=2;f<a;f++)s[o++]=i[l+f]}return s&&s.length!=o&&(s.length=o),s}function Ka(i,t,e,n,r,s,a){a=a||[];const o=Math.cos(r),l=Math.sin(r),h=s[0],c=s[1];let f=0;for(let u=t;u<e;u+=n){const d=i[u]-h,g=i[u+1]-c;a[f++]=h+d*o-g*l,a[f++]=c+d*l+g*o;for(let m=u+2;m<u+n;++m)a[f++]=i[m]}return a&&a.length!=f&&(a.length=f),a}function Za(i,t,e,n,r,s,a,o){o=o||[];const l=a[0],h=a[1];let c=0;for(let f=t;f<e;f+=n){const u=i[f]-l,d=i[f+1]-h;o[c++]=l+r*u,o[c++]=h+s*d;for(let g=f+2;g<f+n;++g)o[c++]=i[g]}return o&&o.length!=c&&(o.length=c),o}function ja(i,t,e,n,r,s,a){a=a||[];let o=0;for(let l=t;l<e;l+=n){a[o++]=i[l]+r,a[o++]=i[l+1]+s;for(let h=l+2;h<l+n;++h)a[o++]=i[h]}return a&&a.length!=o&&(a.length=o),a}const fn=we();class Qa extends Se{constructor(){super(),this.extent_=Ea(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=_a((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return b()}closestPointXY(t,e,n,r){return b()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return b()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&en(e),this.extentRevision_=this.getRevision()}return Ra(this.extent_,t)}rotate(t,e){b()}scale(t,e,n){b()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return b()}getType(){return b()}applyTransform(t){b()}intersectsExtent(t){return b()}translate(t,e){b()}transform(t,e){const n=ve(t),r=n.getUnits()=="tile-pixels"?function(s,a,o){const l=n.getExtent(),h=n.getWorldExtent(),c=nn(h)/nn(l);return Qi(fn,h[0],h[3],c,-c,0,0,0),mt(s,0,s.length,o,fn,a),un(n,e)(s,a,o)}:un(n,e);return this.applyTransform(r),this}}class to extends Qa{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Fa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return b()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=dn(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){b()}setLayout(t,e,n){let r;if(t)r=dn(t);else{for(let s=0;s<n;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=eo(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();Ka(n,0,n.length,r,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=Aa(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();Za(r,0,r.length,s,t,e,n,r),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();ja(n,0,n.length,r,t,e,n),this.changed()}}}function eo(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function dn(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function io(i,t,e){const n=i.getFlatCoordinates();if(!n)return null;const r=i.getStride();return mt(n,0,n.length,r,t,e)}function no(i,t,e,n){for(let r=0,s=e.length;r<s;++r)i[t++]=e[r];return t}class Oe extends to{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Oe(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){const s=this.flatCoordinates,a=Xa(t,e,s[0],s[1]);if(a<r){const o=this.stride;for(let l=0;l<o;++l)n[l]=s[l];return n.length=o,a}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return ka(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return ba(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=no(this.flatCoordinates,0,t,this.stride),this.changed()}}var w={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Dt(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}class _t{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Dt(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new _t({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return b()}getImage(t){return b()}getHitDetectionImage(){return b()}getPixelRatio(t){return 1}getImageState(){return b()}getImageSize(){return b()}getOrigin(){return b()}getSize(){return b()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Dt(t)}listenImageChange(t){b()}load(){b()}unlistenImageChange(t){b()}ready(){return Promise.resolve()}}var Nt={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},A={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};A.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}},A.max=A.whitepoint[2].D65,A.rgb=function(i,t){t=t||A.whitepoint[2].E;var e=i[0]/t[0],n=i[1]/t[1],r=i[2]/t[2],s,a,o;return s=e*3.240969941904521+n*-1.537383177570093+r*-.498610760293,a=e*-.96924363628087+n*1.87596750150772+r*.041555057407175,o=e*.055630079696993+n*-.20397695888897+r*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,.4166666666666667)-.055:s=s*12.92,a=a>.0031308?1.055*Math.pow(a,.4166666666666667)-.055:a=a*12.92,o=o>.0031308?1.055*Math.pow(o,.4166666666666667)-.055:o=o*12.92,s=Math.min(Math.max(0,s),1),a=Math.min(Math.max(0,a),1),o=Math.min(Math.max(0,o),1),[s*255,a*255,o*255]},Nt.xyz=function(i,t){var e=i[0]/255,n=i[1]/255,r=i[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=e*.41239079926595+n*.35758433938387+r*.18048078840183,a=e*.21263900587151+n*.71516867876775+r*.072192315360733,o=e*.019330818715591+n*.11919477979462+r*.95053215224966;return t=t||A.whitepoint[2].E,[s*t[0],a*t[1],o*t[2]]};var gn={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,t,e){var n,r,s,a,o,l,h,c,f,u,d,g,m;if(s=i[0],a=i[1],o=i[2],s===0)return[0,0,0];var y=.0011070564598794539;return t=t||"D65",e=e||2,f=A.whitepoint[e][t][0],u=A.whitepoint[e][t][1],d=A.whitepoint[e][t][2],g=4*f/(f+15*u+3*d),m=9*u/(f+15*u+3*d),n=a/(13*s)+g||0,r=o/(13*s)+m||0,h=s>8?u*Math.pow((s+16)/116,3):u*s*y,l=h*9*n/(4*r)||0,c=h*(12-3*n-20*r)/(4*r)||0,[l,h,c]}};A.luv=function(i,t,e){var n,r,s,a,o,l,h,c,f,u,d,g,m,y=.008856451679035631,x=903.2962962962961;t=t||"D65",e=e||2,f=A.whitepoint[e][t][0],u=A.whitepoint[e][t][1],d=A.whitepoint[e][t][2],g=4*f/(f+15*u+3*d),m=9*u/(f+15*u+3*d),l=i[0],h=i[1],c=i[2],n=4*l/(l+15*h+3*c)||0,r=9*h/(l+15*h+3*c)||0;var p=h/u;return s=p<=y?x*p:116*Math.pow(p,.3333333333333333)-16,a=13*s*(n-g),o=13*s*(r-m),[s,a,o]},gn.lchuv=function(i){var t=i[0],e=i[1],n=i[2],r=Math.sqrt(e*e+n*n),s=Math.atan2(n,e),a=s*360/2/Math.PI;return a<0&&(a+=360),[t,r,a]},A.lchuv=function(i){return gn.lchuv(A.luv(i))};var mn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},_n={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function ro(i){var c,f;var t,e=[],n=1,r;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),mn[i])e=mn[i].slice(),r="rgb";else if(i==="transparent")n=0,r="rgb",e=[0,0,0];else if(i[0]==="#"){var s=i.slice(1),a=s.length,o=a<=4;n=1,o?(e=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],a===4&&(n=parseInt(s[3]+s[3],16)/255)):(e=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],a===8&&(n=parseInt(s[6]+s[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),r="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var l=t[1];r=l.replace(/a$/,"");var h=r==="cmyk"?4:r==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=e.shift()),e=e.map(function(u,d){if(u[u.length-1]==="%")return u=parseFloat(u)/100,d===3?u:r==="rgb"?u*255:r[0]==="h"||r[0]==="l"&&!d?u*100:r==="lab"?u*125:r==="lch"?d<2?u*150:u*360:r[0]==="o"&&!d?u:r==="oklab"?u*.4:r==="oklch"?d<2?u*.4:u*360:u;if(r[d]==="h"||d===2&&r[r.length-1]==="h"){if(_n[u]!==void 0)return _n[u];if(u.endsWith("deg"))return parseFloat(u);if(u.endsWith("turn"))return parseFloat(u)*360;if(u.endsWith("grad"))return parseFloat(u)*360/400;if(u.endsWith("rad"))return parseFloat(u)*180/Math.PI}return u==="none"?0:parseFloat(u)}),n=e.length>h?e.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(e=i.match(/([0-9]+)/g).map(function(u){return parseFloat(u)}),r=((f=(c=i.match(/([a-z])/ig))==null?void 0:c.join(""))==null?void 0:f.toLowerCase())||"rgb");return{space:r,values:e,alpha:n}}var be={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var t=i[0]/360,e=i[1]/100,n=i[2]/100,r,s,a,o,l,h=0;if(e===0)return l=n*255,[l,l,l];for(s=n<.5?n*(1+e):n+e-n*e,r=2*n-s,o=[0,0,0];h<3;)a=t+1/3*-(h-1),a<0?a++:a>1&&a--,l=6*a<1?r+(s-r)*6*a:2*a<1?s:3*a<2?r+(s-r)*(2/3-a)*6:r,o[h++]=l*255;return o}};Nt.hsl=function(i){var t=i[0]/255,e=i[1]/255,n=i[2]/255,r=Math.min(t,e,n),s=Math.max(t,e,n),a=s-r,o,l,h;return s===r?o=0:t===s?o=(e-n)/a:e===s?o=2+(n-t)/a:n===s&&(o=4+(t-e)/a),o=Math.min(o*60,360),o<0&&(o+=360),h=(r+s)/2,s===r?l=0:h<=.5?l=a/(s+r):l=a/(2-s-r),[o,l*100,h*100]};function so(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var t,e=ro(i);if(!e.space)return[];const n=e.space[0]==="h"?be.min:Nt.min,r=e.space[0]==="h"?be.max:Nt.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],n[0]),r[0]),t[1]=Math.min(Math.max(e.values[1],n[1]),r[1]),t[2]=Math.min(Math.max(e.values[2],n[2]),r[2]),e.space[0]==="h"&&(t=be.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}const ao=[NaN,NaN,NaN,0];function oo(i){return typeof i=="string"?i:yn(i)}const lo=1024,yt={};let Ee=0;function ho(i){if(i==="none")return ao;if(yt.hasOwnProperty(i))return yt[i];if(Ee>=lo){let e=0;for(const n in yt)e++&3||(delete yt[n],--Ee)}const t=so(i);if(t.length!==4)throw new Error('failed to parse "'+i+'" as color');for(const e of t)if(isNaN(e))throw new Error('failed to parse "'+i+'" as color');return co(t),yt[i]=t,++Ee,t}function ke(i){return Array.isArray(i)?i:ho(i)}function co(i){return i[0]=Pt(i[0]+.5|0,0,255),i[1]=Pt(i[1]+.5|0,0,255),i[2]=Pt(i[2]+.5|0,0,255),i[3]=Pt(i[3],0,1),i}function yn(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const r=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+r+")"}const G=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";G.includes("firefox"),G.includes("safari")&&!G.includes("chrom")&&(G.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(G)),G.includes("webkit")&&G.includes("edge"),G.includes("macintosh");const uo=typeof devicePixelRatio<"u"?devicePixelRatio:1,fo=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,go=typeof Image<"u"&&Image.prototype.decode;(function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i})();function Y(i,t,e,n){let r;return fo?r=new OffscreenCanvas(i||300,t||300):r=document.createElement("canvas"),i&&(r.width=i),t&&(r.height=t),r.getContext("2d",n)}let Fe;function pn(){return Fe||(Fe=Y(1,1)),Fe}function mo(i,t){return new Promise((e,n)=>{function r(){a(),e(i)}function s(){a(),n(new Error("Image load error"))}function a(){i.removeEventListener("load",r),i.removeEventListener("error",s)}i.addEventListener("load",r),i.addEventListener("error",s)})}function _o(i,t){return t&&(i.src=t),i.src&&go?new Promise((e,n)=>i.decode().then(()=>e(i)).catch(r=>i.complete&&i.width?e(i):n(r))):mo(i)}class yo{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];!(t++&3)&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,n){const r=Le(t,e,n);return r in this.cache_?this.cache_[r]:null}getPattern(t,e,n){const r=Le(t,e,n);return r in this.patternCache_?this.patternCache_[r]:null}set(t,e,n,r,s){const a=Le(t,e,n),o=a in this.cache_;this.cache_[a]=r,s&&(r.getImageState()===w.IDLE&&r.load(),r.getImageState()===w.LOADING?r.ready().then(()=>{this.patternCache_[a]=pn().createPattern(r.getImage(1),"repeat")}):this.patternCache_[a]=pn().createPattern(r.getImage(1),"repeat")),o||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Le(i,t,e){const n=e?ke(e):"null";return t+":"+i+":"+n}const z=new yo;let pt=null;class po extends Ji{constructor(t,e,n,r,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=s,this.imageState_=r===void 0?w.IDLE:r,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===w.LOADED){pt||(pt=Y(1,1,void 0,{willReadFrequently:!0})),pt.drawImage(this.image_,0,0);try{pt.getImageData(0,0,1,1),this.tainted_=!1}catch{pt=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(X.CHANGE)}handleImageError_(){this.imageState_=w.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=w.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=Y(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===w.IDLE){this.image_||this.initializeImage_(),this.imageState_=w.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&_o(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==w.LOADED)return;const e=this.image_,n=Y(Math.ceil(e.width*t),Math.ceil(e.height*t)),r=n.canvas;n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=oo(this.color_),n.fillRect(0,0,r.width/t,r.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=r}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===w.LOADED||this.imageState_===w.ERROR)t();else{const e=()=>{(this.imageState_===w.LOADED||this.imageState_===w.ERROR)&&(this.removeEventListener(X.CHANGE,e),t())};this.addEventListener(X.CHANGE,e)}})),this.ready_}}function Ie(i,t,e,n,r,s){let a=t===void 0?void 0:z.get(t,e,r);return a||(a=new po(i,i&&"src"in i?i.src||void 0:t,e,n,r),z.set(t,e,r,a,s)),s&&a&&!z.getPattern(t,e,r)&&z.set(t,e,r,a,s),a}function et(i){return i?Array.isArray(i)?yn(i):typeof i=="object"&&"src"in i?xo(i):i:null}function xo(i){if(!i.offset||!i.size)return z.getPattern(i.src,"anonymous",i.color);const t=i.src+":"+i.offset,e=z.getPattern(t,void 0,i.color);if(e)return e;const n=z.get(i.src,"anonymous",null);if(n.getImageState()!==w.LOADED)return null;const r=Y(i.size[0],i.size[1]);return r.drawImage(n.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),Ie(r.canvas,t,void 0,w.LOADED,i.color,!0),z.getPattern(t,void 0,i.color)}const So="10px sans-serif",Gt="#000",zt="round",xn=[],Sn=0,$t="round",Ae=10,Re="#000",wn="center",wo="middle",Te=1;new Se;class Wt extends _t{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?w.LOADING:w.LOADED,this.imageState_===w.LOADING&&this.ready().then(()=>this.imageState_=w.LOADED),this.render()}clone(){const t=this.getScale(),e=new Wt({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-e[0]/n[0],t[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const n=this.renderOptions_,r=Y(n.size*t,n.size*t);this.draw_(n,r,t),e=r.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let r=this.radius,s=this.radius2_===void 0?r:this.radius2_;if(r<s){const Vt=r;r=s,s=Vt}const a=this.radius2_===void 0?this.points_:this.points_*2,o=2*Math.PI/a,l=s*Math.sin(o),h=Math.sqrt(s*s-l*l),c=r-h,f=Math.sqrt(l*l+c*c),u=f/l;if(t==="miter"&&u<=n)return u*e;const d=e/2/u,g=e/2*(c/f),y=Math.sqrt((r+d)*(r+d)+g*g)-r;if(this.radius2_===void 0||t==="bevel")return y*2;const x=r*Math.sin(o),p=Math.sqrt(r*r-x*x),S=s-p,R=Math.sqrt(x*x+S*S)/x;if(R<=n){const Vt=R*e/2-s-r;return 2*Math.max(y,Vt)}return y*2}createRenderOptions(){let t=zt,e=$t,n=0,r=null,s=0,a,o=0;this.stroke_&&(a=et(this.stroke_.getColor()??Re),o=this.stroke_.getWidth()??Te,r=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??$t,t=this.stroke_.getLineCap()??zt,n=this.stroke_.getMiterLimit()??Ae);const l=this.calculateLineJoinSize_(e,o,n),h=Math.max(this.radius,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:a,strokeWidth:o,size:c,lineCap:t,lineDash:r,lineDashOffset:s,lineJoin:e,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let r=this.fill_.getColor();r===null&&(r=Gt),e.fillStyle=et(r),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let n=this.fill_.getColor(),r=0;typeof n=="string"&&(n=ke(n)),n===null?r=1:Array.isArray(n)&&(r=n.length===4?n[3]:1),r===0&&(e=Y(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const n=this.radius;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{const r=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);const s=this.angle_-Math.PI/2,a=2*Math.PI/e;for(let o=0;o<e;o++){const l=s+o*a,h=o%2===0?n:r;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Gt,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Me extends Wt{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Me({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}}class Xt{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new Xt({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=Ie(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===w.IDLE&&e.load(),e.getImageState()===w.LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}class Pe{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Pe({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class Bt{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Cn,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new Bt({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Cn,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function Cn(i){return i.getGeometry()}const Co="#333";class De{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=Dt(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Xt({color:Co}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new De({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Dt(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}function vn(i,t,e,n){return e!==void 0&&n!==void 0?[e/i,n/t]:e!==void 0?e/i:n!==void 0?n/t:1}class Yt extends _t{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,r=t.scale!==void 0?t.scale:1,s=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:n,scale:r,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const a=t.img!==void 0?t.img:null;let o=t.src;Rt(!(o!==void 0&&a),"`image` and `src` cannot be provided at the same time"),(o===void 0||o.length===0)&&a&&(o=a.src||Zi(a)),Rt(o!==void 0&&o.length>0,"A defined and non-empty `src` or `image` must be provided"),Rt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=w.IDLE:a!==void 0&&("complete"in a?a.complete?l=a.src?w.LOADED:w.IDLE:l=w.LOADING:l=w.LOADED),this.color_=t.color!==void 0?ke(t.color):null,this.iconImage_=Ie(a,o,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let h,c;if(t.size)[h,c]=t.size;else{const f=this.getImage(1);if(f.width&&f.height)h=f.width,c=f.height;else if(f instanceof HTMLImageElement){this.initialOptions_=t;const u=()=>{if(this.unlistenImageChange(u),!this.initialOptions_)return;const d=this.iconImage_.getSize();this.setScale(vn(d[0],d[1],t.width,t.height))};this.listenImageChange(u);return}}h!==void 0&&this.setScale(vn(h,c,t.width,t.height))}}clone(){let t,e,n;return this.initialOptions_?(e=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Yt({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=r[0]),this.anchorYUnits_=="fraction"&&(t[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+r[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]-e[0]/n[0],t[1]+e[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==w.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==w.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(X.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(X.CHANGE,t)}ready(){return this.iconImage_.ready()}}const On={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},bn="3.7.7",vo=bn,it=typeof Buffer=="function",En=typeof TextDecoder=="function"?new TextDecoder:void 0,kn=typeof TextEncoder=="function"?new TextEncoder:void 0,xt=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),qt=(i=>{let t={};return i.forEach((e,n)=>t[e]=n),t})(xt),Oo=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,F=String.fromCharCode.bind(String),Fn=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):i=>new Uint8Array(Array.prototype.slice.call(i,0)),Ln=i=>i.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),In=i=>i.replace(/[^A-Za-z0-9\+\/]/g,""),An=i=>{let t,e,n,r,s="";const a=i.length%3;for(let o=0;o<i.length;){if((e=i.charCodeAt(o++))>255||(n=i.charCodeAt(o++))>255||(r=i.charCodeAt(o++))>255)throw new TypeError("invalid character found");t=e<<16|n<<8|r,s+=xt[t>>18&63]+xt[t>>12&63]+xt[t>>6&63]+xt[t&63]}return a?s.slice(0,a-3)+"===".substring(a):s},Ne=typeof btoa=="function"?i=>btoa(i):it?i=>Buffer.from(i,"binary").toString("base64"):An,Ge=it?i=>Buffer.from(i).toString("base64"):i=>{let e=[];for(let n=0,r=i.length;n<r;n+=4096)e.push(F.apply(null,i.subarray(n,n+4096)));return Ne(e.join(""))},Ut=(i,t=!1)=>t?Ln(Ge(i)):Ge(i),bo=i=>{if(i.length<2){var t=i.charCodeAt(0);return t<128?i:t<2048?F(192|t>>>6)+F(128|t&63):F(224|t>>>12&15)+F(128|t>>>6&63)+F(128|t&63)}else{var t=65536+(i.charCodeAt(0)-55296)*1024+(i.charCodeAt(1)-56320);return F(240|t>>>18&7)+F(128|t>>>12&63)+F(128|t>>>6&63)+F(128|t&63)}},Eo=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Rn=i=>i.replace(Eo,bo),Tn=it?i=>Buffer.from(i,"utf8").toString("base64"):kn?i=>Ge(kn.encode(i)):i=>Ne(Rn(i)),nt=(i,t=!1)=>t?Ln(Tn(i)):Tn(i),Mn=i=>nt(i,!0),ko=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Fo=i=>{switch(i.length){case 4:var t=(7&i.charCodeAt(0))<<18|(63&i.charCodeAt(1))<<12|(63&i.charCodeAt(2))<<6|63&i.charCodeAt(3),e=t-65536;return F((e>>>10)+55296)+F((e&1023)+56320);case 3:return F((15&i.charCodeAt(0))<<12|(63&i.charCodeAt(1))<<6|63&i.charCodeAt(2));default:return F((31&i.charCodeAt(0))<<6|63&i.charCodeAt(1))}},Pn=i=>i.replace(ko,Fo),Dn=i=>{if(i=i.replace(/\s+/g,""),!Oo.test(i))throw new TypeError("malformed base64.");i+="==".slice(2-(i.length&3));let t,e="",n,r;for(let s=0;s<i.length;)t=qt[i.charAt(s++)]<<18|qt[i.charAt(s++)]<<12|(n=qt[i.charAt(s++)])<<6|(r=qt[i.charAt(s++)]),e+=n===64?F(t>>16&255):r===64?F(t>>16&255,t>>8&255):F(t>>16&255,t>>8&255,t&255);return e},ze=typeof atob=="function"?i=>atob(In(i)):it?i=>Buffer.from(i,"base64").toString("binary"):Dn,Nn=it?i=>Fn(Buffer.from(i,"base64")):i=>Fn(ze(i).split("").map(t=>t.charCodeAt(0))),Gn=i=>Nn(zn(i)),Lo=it?i=>Buffer.from(i,"base64").toString("utf8"):En?i=>En.decode(Nn(i)):i=>Pn(ze(i)),zn=i=>In(i.replace(/[-_]/g,t=>t=="-"?"+":"/")),$e=i=>Lo(zn(i)),Io=i=>{if(typeof i!="string")return!1;const t=i.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},$n=i=>({value:i,enumerable:!1,writable:!0,configurable:!0}),Wn=function(){const i=(t,e)=>Object.defineProperty(String.prototype,t,$n(e));i("fromBase64",function(){return $e(this)}),i("toBase64",function(t){return nt(this,t)}),i("toBase64URI",function(){return nt(this,!0)}),i("toBase64URL",function(){return nt(this,!0)}),i("toUint8Array",function(){return Gn(this)})},Xn=function(){const i=(t,e)=>Object.defineProperty(Uint8Array.prototype,t,$n(e));i("toBase64",function(t){return Ut(this,t)}),i("toBase64URI",function(){return Ut(this,!0)}),i("toBase64URL",function(){return Ut(this,!0)})},Bn={version:bn,VERSION:vo,atob:ze,atobPolyfill:Dn,btoa:Ne,btoaPolyfill:An,fromBase64:$e,toBase64:nt,encode:nt,encodeURI:Mn,encodeURL:Mn,utob:Rn,btou:Pn,decode:$e,isValid:Io,fromUint8Array:Ut,toUint8Array:Gn,extendString:Wn,extendUint8Array:Xn,extendBuiltins:()=>{Wn(),Xn()}},We=/^ttf:\/\/(.+)#(.+)$/,Yn="data:image/svg+xml;base64,",qn=["horline","vertline","line"],Un="geostyler-mark-symbolizer";class _{static getRgbaColor(t,e){if(ft(t)&&(t=_.evaluateStringFunction(t)),typeof t!="string")return;if(t.startsWith("rgba("))return t;if(!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t))return;const r=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16);return ye(e)&&(e=_.evaluateNumberFunction(e)),e<0&&(e=1),"rgba("+r+", "+s+", "+a+", "+e+")"}static splitRgbaColor(t){const e=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/),n=parseInt(e[0],10),r=parseInt(e[1],10),s=parseInt(e[2],10),a=parseFloat(e[3]);return[n,r,s,a]}static getHexColor(t){if(t.startsWith("#"))return t;if(t.startsWith("rgb")){const e=_.splitRgbaColor(t);return _.getHexCodeFromRgbArray(e)}else if(On[t.toLocaleLowerCase()]!==void 0){const e=On[t.toLocaleLowerCase()];return _.getHexCodeFromRgbArray(e)}else return}static getHexCodeFromRgbArray(t){return"#"+t.map((e,n)=>{const r=e.toString(16);return n<3?r.length===1?"0"+r:r:""}).join("")}static getOpacity(t){if(!t.startsWith("rgba("))return;const e=_.splitRgbaColor(t);if(e.length===4)return e[3]}static checkOpacity(t){return typeof t=="number"&&t>=0&&t<1}static getTextFont(t){const e=t.fontWeight??"normal",n=t.fontStyle??"normal",r=t.size,s=t.font;return e+" "+n+" "+r+"px "+(s==null?void 0:s.join(", "))}static getIsFontGlyphBased(t){return We.test(t.wellKnownName)}static getIsMarkSymbolizerFont(t){if(!t)return!1;const e=Un;return t.substring(t.length-e.length,t.length)===e}static getTextFontForMarkSymbolizer(t){const e=t.wellKnownName.match(We);if(!e)throw new Error(`Could not parse font-based well known name: ${t.wellKnownName}`);const n=e[1];return`Normal ${t.radius||5}px '${n}', ${Un}`}static getCharacterForMarkSymbolizer(t){const e=t.wellKnownName.match(We);if(!e)throw new Error(`Could not parse font-based well known name: ${t.wellKnownName}`);return String.fromCharCode(parseInt(e[2],16))}static getFontNameFromOlFont(t){const e=t.match(/(?:\d+\S+) '?"?([^,'"]+)/);if(!e)throw new Error(`Could not find font family name in the following string: ${t}`);return e[1]}static getSizeFromOlFont(t){const e=t.match(/(?:(\d+)px)/);return e?parseInt(e[1],10):0}static getBase64EncodedSvg(t){return Yn+Bn.encode(t)}static getBase64DecodedSvg(t){return Bn.decode(t.replace(Yn,""))}static resolveAttributeTemplate(t,e,n="n.v.",r=(s,a)=>a){let s="\\{\\{",a="\\}\\}",o=new RegExp(s+"(.*?)"+a,"g"),l=e.match(o);return l&&l.forEach(h=>{let c=0;for(let[f,u]of Object.entries(t.getProperties()))if(h.slice(2,h.length-2).toLowerCase()===f.toLowerCase()){e=e.replace(h,r(f,u));break}else c++;c===Object.keys(t.getProperties()).length&&(e=e.replace(h,n))}),e}static evaluateFunction(t,e){if(t.name==="property"){if(!e)throw new Error(`Could not evalute 'property' function. Feature ${e} is not defined.`);return ft(t.args[0])?e==null?void 0:e.get(_.evaluateStringFunction(t.args[0],e)):e==null?void 0:e.get(t.args[0])}if(Yi(t))return _.evaluateUnknownFunction(t,e);if(ft(t))return _.evaluateStringFunction(t,e);if(ye(t))return _.evaluateNumberFunction(t,e);if(It(t))return _.evaluateBooleanFunction(t,e)}static evaluateBooleanFunction(t,e){const n=t.args.map(r=>k(r)?_.evaluateFunction(r,e):r);switch(t.name){case"all":return n.map(a=>this.evaluateBooleanFunction(a,e)).every(a=>a===!0);case"any":return n.map(a=>this.evaluateBooleanFunction(a,e)).some(a=>a===!0);case"between":return n[0]>=n[1]&&n[0]<=n[2];case"double2bool":return!1;case"equalTo":return n[0]===n[1];case"greaterThan":return n[0]>n[1];case"greaterThanOrEqualTo":return n[0]>=n[1];case"in":return n.slice(1).includes(n[0]);case"lessThan":return n[0]<n[1];case"lessThanOrEqualTo":return n[0]<=n[1];case"not":return!n[0];case"notEqualTo":return n[0]!==n[1];case"parseBoolean":return!!n[0];case"strEndsWith":return n[0].endsWith(n[1]);case"strEqualsIgnoreCase":return n[0].toLowerCase()===n[1].toLowerCase();case"strMatches":const s=n[1].match(/\/(.*?)\/([gimy]{0,4})$/);return s&&s.length===3?new RegExp(s[1],s[2]).test(n[0]):!1;case"strStartsWith":return n[0].startsWith(n[1]);default:return!1}}static evaluateNumberFunction(t,e){if(t.name==="pi")return Math.PI;if(t.name==="random")return Math.random();const n=t.args.map(r=>k(r)?_.evaluateFunction(r,e):r);switch(t.name){case"abs":return Math.abs(n[0]);case"acos":return Math.acos(n[0]);case"add":return n[0]+n[1];case"asin":return Math.asin(n[0]);case"atan":return Math.atan(n[0]);case"atan2":return n[0];case"ceil":return Math.ceil(n[0]);case"cos":return Math.cos(n[0]);case"div":return n[0]/n[1];case"exp":return Math.exp(n[0]);case"floor":return Math.floor(n[0]);case"log":return Math.log(n[0]);case"max":return Math.max(...n);case"min":return Math.min(...n);case"modulo":return n[0]%n[1];case"mul":return n[0]*n[1];case"pow":return Math.pow(n[0],n[1]);case"rint":return n[0];case"round":return Math.round(n[0]);case"sin":return Math.sin(n[0]);case"sqrt":return Math.sqrt(n[0]);case"strIndexOf":return n[0].indexOf(n[1]);case"strLastIndexOf":return n[0].lastIndexOf(n[1]);case"strLength":return n[0].length;case"sub":return n[0]-n[1];case"tan":return Math.tan(n[0]);case"toDegrees":return n[0]*(180/Math.PI);case"toRadians":return n[0]*(Math.PI/180);default:return n[0]}}static evaluateUnknownFunction(t,e){const n=t.args.map(r=>k(r)?_.evaluateFunction(r,e):r);switch(t.name){case"property":return e==null?void 0:e.get(n[0]);case"case":const r=n;let s;for(let a=0;a<r.length;a++){const o=r[a];if(a===r.length-1){s=o;break}else if(o.case===!0){s=o.value;break}else if(_.evaluateBooleanFunction(o.case,e)){s=o.value;break}}return s;default:return n[0]}}static evaluateStringFunction(t,e){var s;const n=t.args.map(a=>k(a)?_.evaluateFunction(a,e):a);switch(t.name){case"numberFormat":return n[0];case"strAbbreviate":return n[0];case"strCapitalize":var r=n[0].toLowerCase().split(" ");for(let a of r)a=a.charAt(0).toUpperCase()+a.substring(1);return r.join(" ");case"strConcat":return n.join();case"strDefaultIfBlank":return((s=n[0])==null?void 0:s.length)<1?n[1]:n[0];case"strReplace":return n[3]===!0?n[0].replaceAll(n[1],n[2]):n[0].replace(n[1],n[2]);case"strStripAccents":return n[0].normalize("NFKD").replace(/[\u0300-\u036f]/g,"");case"strSubstring":return n[0].substring(n[1],n[2]);case"strSubstringStart":return n[0].substring(n[1]);case"strToLowerCase":return n[0].toLowerCase();case"strToUpperCase":return n[0].toUpperCase();case"strTrim":return n[0].trim();default:return n[0]}}static containsGeoStylerFunctions(t){return t.rules.some(e=>{var a,o,l,h;const n=Array.isArray(e.filter)&&((a=e.filter)==null?void 0:a.some(k)),r=(o=e.symbolizers)==null?void 0:o.some(c=>Object.values(c).some(k)),s=k((l=e==null?void 0:e.scaleDenominator)==null?void 0:l.max)||k((h=e==null?void 0:e.scaleDenominator)==null?void 0:h.min);return n||r||s})}}const Hn={arrow:'d="M 0,-10 L 5,-5 L 2.5,-5 L 2.5,10 L -2.5,10 L -2.5,-5 L -5,-5 L 0,-10 Z"',arrowhead:'d="M -10 -10 L 0 0 L -10 10"',asterisk_fill:'d="M -1.5,-10 L 1.5,-10L 1.5,-3.939 L 6.011,-8.132 L 8.132,-6.011 L 3.939,-1.5 L 10,-1.5 L 10,1.5 L 3.939,1.5 L 8.132,6.011 L 6.011,8.132 L 1.5,3.939 L 1.5,10 L -1.5,10 L -1.5,3.939 L -6.011,8.132 L -8.132,6.011 L -3.939,1.5 L -10,1.5 L -10,-1.5 L -3.939,-1.5 L -8.132,-6.011 L -6.011,-8.132 L -1.5,-3.939 L -1.5,-10 Z"',backslash:'d="M -12 -12 L 12 12"',carrow:'d="M -10 10 L 0 -10 L 10 10 Z"',circle:'cx="0" cy="0" r="10"',cross:'d="M -12 0 L 12 0 M 0 -12 L 0 12"',cross_fill:'d="M -10,-2 L -10,-2 L -10,2 L -2,2 L -2,10 L 2,10 L 2,2 L 10,2 L 10,-2 L 2,-2 L 2,-10 L -2,-10 L -2,-2 L -10,-2 Z"',cross2:'d="M -12 -12 L 12 12 M 12 -12 L -12 12"',decagon:'points="5.878,8.09 9.511,3.09 9.511,-3.09 5.878,-8.09 0,-10 -5.878,-8.09 -9.511,-3.09 -9.511,3.09 -5.878,8.09 0,10 5.878,8.09"',diagonal_half_square:'points="-10,-10 10,10 -10,10 -10,-10"',diamond:'points="-10,0 0,10 10,0 0,-10 -10,0"',equilateral_triangle:'points="-8.66,5 8.66,5 0,-10 -8.66,5"',filled_arrowhead:'d="M 0,0 L -10,10 L -10,-10 L 0,0 Z"',half_arc:'d="M -10 0 A -10 -10 0 0 1 10 0"',half_square:'points="-10,-10 0,-10 0,10 -10,10 -10,-10"',heart:'d="M -9.5 -2 A 1 1 0 0 1 0 -7.5 A 1 1 0 0 1 9.5 -2 L 0 10 Z"',hexagon:'points="-8.66,-5 -8.66,5 0,10 8.66,5 8.66,-5 0,-10 -8.66,-5"',horline:'d="M -12 0 L 12 0"',left_half_triangle:'points="0,10 10,10 0,-10 0,10"',line:'d="M 0 -12 L 0 12"',oarrow:'d="M -10 10 L 0 -10 L 10 10"',octagon:'points="-4.142,10 4.142,10 10,4.142 10,-4.142 4.142,-10 -4.142,-10 -10,-4.142 -10,4.142 -4.142,10"',parallelogram_left:'points="10,5 5,-5 -10,-5 -5,5 10,5"',parallelogram_right:'points="5,5 10,-5 -5,-5 -10,5 5,5"',pentagon:'points="-9.511,-3.09 -5.878,8.09 5.878,8.09 9.511,-3.09 0,-10 -9.511,-3.09"',quarter_arc:'d="M 0 -10 A 10 10 0 0 0 -10 0"',quarter_circle:'d="M 0 -10 A 10 10 0 0 0 -10 0 L 0 0 Z"',quarter_square:'points="-10,-10 0,-10 0,0 -10,0 -10,-10"',right_half_triangle:'points="-10,10 0,10 0,-10 -10,10"',rounded_square:'x="-10" y="-10" width="20" height="20" rx="2.5" ry="2.5"',semi_circle:'d="M -10 0 A -10 -10 0 0 1 10 0 L 0 0 Z"',shield:'points="10,5 10,-10 -10,-10 -10,5 0,10 10,5"',slash:'d="M 12 -12 L -12 12"',square:'points="-10,-10 10,-10 10,10 -10,10"',square_with_corners:'points="-6.072,10 6.072,10 10,6.072 10,-6.072 6.072,-10 -6.072,-10 -10,-6.072 -10,6.072 -6.072,10"',star:'d="M -2.24514,-3.09017 -9.51057,-3.09017 -3.63271,1.18034 -5.87785,8.09017 0,3.81966 5.87785,8.09017 3.63271,1.18034 9.51057,-3.09017 2.24514,-3.09017 0,-10 -2.24514,-3.09017 Z"',star_diamond:'d="M -2.70091,-2.70091 -10,0 -2.70091,2.70091 0,10 2.70091,2.70091 10,0 2.70091,-2.70091 0,-10 Z"',third_arc:'d="M 0 -10 A 10 10 0 0 0 -5 8.66"',third_circle:'d="M 0 -10 A 10 10 0 0 0 -5 8.66 L 0 0 Z"',trapezoid:'points="5,-5 10,5 -10,5 -5,-5 5,-5"',triangle:'points="-10,10 10,10 0,-10 -10,10"'},Ao=i=>{switch(i){case"shape://backslash":return"backslash";case"shape://carrow":return"carrow";case"shape://dot":return"circle";case"shape://horline":return"horline";case"shape://oarrow":return"oarrow";case"shape://plus":return"cross";case"shape://slash":return"slash";case"shape://times":case"x":return"cross2";case"shape://vertline":return"line";default:return i}},Vn=i=>i in Hn,Ro=(i="circle",t={dimensions:40})=>{const{dimensions:e,fill:n,fillOpacity:r,stroke:s,strokeWidth:a,strokeOpacity:o}=t;if(!Vn(i))throw new Error("Unknown shape: "+i);const l='<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+e+'" viewBox="-12 -12 24 24">',h="</svg>";let c=Hn[i]+" ";c.startsWith("points=")?c='<polygon id="'+i+'" '+c:c.startsWith("x=")?c='<rect id="'+i+'" '+c:c.startsWith("cx=")?c='<circle id="'+i+'" '+c:c='<path id="'+i+'" '+c;let f="";return n&&(f+="fill:"+n+"; "),_.checkOpacity(r)&&(f+="fill-opacity:"+r+"; "),s&&(f+="stroke:"+s+"; "),a&&(f+="stroke-width:"+a+"; "),_.checkOpacity(o)&&(f+="stroke-opacity:"+o+"; "),qn.includes(i)&&(f=f+"stroke-linejoin: butt; "),c+='style="'+f.trim()+'" />',l+c+h},Xe=i=>{try{const e=new DOMParser().parseFromString(i,"application/xml");if(e.querySelector("parsererror"))throw new Error("Invalid XML format");const r=e.querySelector("svg");if(!r)throw new Error("<svg> element not found");const s=r==null?void 0:r.getAttribute("width");if(!s)throw new Error("<svg> element must include dimensions (no width attribute exists)");const a=Array.from(r==null?void 0:r.children).find(u=>u instanceof Element),o=(a==null?void 0:a.getAttribute("id"))??"",h=((a==null?void 0:a.getAttribute("style"))??"").split(";").filter(u=>u.trim()!==""),c={};for(const u of h){const[d,g]=u.split(":").map(m=>m.trim());d&&g&&(c[d]=g)}return{id:o,dimensions:Number(s),...c.fill&&{fill:c.fill},...c["fill-opacity"]&&{fillOpacity:Number(c["fill-opacity"])},...c.stroke&&{stroke:c.stroke},...c["stroke-width"]&&{strokeWidth:Number(c["stroke-width"])},...c["stroke-opacity"]&&{strokeOpacity:Number(c["stroke-opacity"])}}}catch{throw new Error("Error parsing SVG")}};class To{drawCustom(t,e,n,r,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,n){}drawFeature(t,e,n){}drawGeometryCollection(t,e,n){}drawLineString(t,e,n){}drawMultiLineString(t,e,n){}drawMultiPoint(t,e,n){}drawMultiPolygon(t,e,n){}drawPoint(t,e,n){}drawPolygon(t,e,n){}drawText(t,e,n){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class Mo extends To{constructor(t,e,n,r,s,a,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=r,this.transformRotation_=r?Ba(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=a,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=we()}drawImages_(t,e,n,r){if(!this.image_)return;const s=mt(t,e,n,r,this.transform_,this.pixelCoordinates_),a=this.context_,o=this.tmpLocalTransform_,l=a.globalAlpha;this.imageOpacity_!=1&&(a.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,f=s.length;c<f;c+=2){const u=s[c]-this.imageAnchorX_,d=s[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=u+this.imageAnchorX_,m=d+this.imageAnchorY_;Qi(o,g,m,1,1,h,-g,-m),a.save(),a.transform.apply(a,o),a.translate(g,m),a.scale(this.imageScale_[0],this.imageScale_[1]),a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),a.restore()}else a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,u,d,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(a.globalAlpha=l)}drawText_(t,e,n,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=mt(t,e,n,r,this.transform_,this.pixelCoordinates_),a=this.context_;let o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<n;e+=r){const l=s[e]+this.textOffsetX_,h=s[e+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(a.save(),a.translate(l-this.textOffsetX_,h-this.textOffsetY_),a.rotate(o),a.translate(this.textOffsetX_,this.textOffsetY_),a.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&a.strokeText(this.text_,0,0),this.textFillState_&&a.fillText(this.text_,0,0),a.restore()):(this.textStrokeState_&&a.strokeText(this.text_,l,h),this.textFillState_&&a.fillText(this.text_,l,h))}}moveToLineTo_(t,e,n,r,s){const a=this.context_,o=mt(t,e,n,r,this.transform_,this.pixelCoordinates_);a.moveTo(o[0],o[1]);let l=o.length;s&&(l-=2);for(let h=2;h<l;h+=2)a.lineTo(o[h],o[h+1]);return s&&a.closePath(),n}drawRings_(t,e,n,r){for(let s=0,a=n.length;s<a;++s)e=this.moveToLineTo_(t,e,n[s],r,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!dt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=io(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],r=e[3]-e[1],s=Math.sqrt(n*n+r*r),a=this.context_;a.beginPath(),a.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const n=e.getGeometryFunction()(t);n&&(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,r=e.length;n<r;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!dt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(dt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,r=t.getFlatCoordinates();let s=0;const a=t.getEnds(),o=t.getStride();n.beginPath();for(let l=0,h=a.length;l<h;++l)s=this.moveToLineTo_(r,s,a[l],o,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!dt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!dt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let r=0;const s=t.getEndss(),a=t.getStride();e.beginPath();for(let o=0,l=s.length;o<l;++o){const h=s[o];r=this.drawRings_(n,r,h,a)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),Ui(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,r=t.textAlign?t.textAlign:wn;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=r&&(n.textAlign=r,e.textAlign=r),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:et(n||Gt)}}if(!e)this.strokeState_=null;else{const n=e.getColor(),r=e.getLineCap(),s=e.getLineDash(),a=e.getLineDashOffset(),o=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=s||xn;this.strokeState_={lineCap:r!==void 0?r:zt,lineDash:this.pixelRatio_===1?c:c.map(f=>f*this.pixelRatio_),lineDashOffset:(a||Sn)*this.pixelRatio_,lineJoin:o!==void 0?o:$t,lineWidth:(l!==void 0?l:Te)*this.pixelRatio_,miterLimit:h!==void 0?h:Ae,strokeStyle:et(n||Re)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),r=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*n,this.imageAnchorY_=r[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const a=t.getScaleArray();this.imageScale_=[a[0]*this.pixelRatio_/n,a[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const d=e.getColor();this.textFillState_={fillStyle:et(d||Gt)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const d=n.getColor(),g=n.getLineCap(),m=n.getLineDash(),y=n.getLineDashOffset(),x=n.getLineJoin(),p=n.getWidth(),S=n.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:zt,lineDash:m||xn,lineDashOffset:y||Sn,lineJoin:x!==void 0?x:$t,lineWidth:p!==void 0?p:Te,miterLimit:S!==void 0?S:Ae,strokeStyle:et(d||Re)}}const r=t.getFont(),s=t.getOffsetX(),a=t.getOffsetY(),o=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),f=t.getTextAlign(),u=t.getTextBaseline();this.textState_={font:r!==void 0?r:So,textAlign:f!==void 0?f:wn,textBaseline:u!==void 0?u:wo},this.text_=c!==void 0?Array.isArray(c)?c.reduce((d,g,m)=>d+=m%2?" ":g,""):c:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=a!==void 0?this.pixelRatio_*a:0,this.textRotateWithView_=o!==void 0?o:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}function Po(i,t){const e=i.canvas;t=t||{};const n=t.pixelRatio||uo,r=t.size;r&&(e.width=r[0]*n,e.height=r[1]*n,e.style.width=r[0]+"px",e.style.height=r[1]+"px");const s=[0,0,e.width,e.height],a=Oa(we(),n,n);return new Mo(i,n,s,a,0)}let Do=class dr extends Se{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new dr(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(xe(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=At(t,X.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?No(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};function No(i){if(typeof i=="function")return i;let t;return Array.isArray(i)?t=i:(Rt(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[i]),function(){return t}}class Jn{constructor(t){E(this,"unsupportedProperties",{Symbolizer:{MarkSymbolizer:{avoidEdges:"none",blur:"none",offsetAnchor:"none",pitchAlignment:"none",pitchScale:"none"},FillSymbolizer:{antialias:"none",opacity:{support:"none",info:"Use fillOpacity instead."}},IconSymbolizer:{allowOverlap:"none",anchor:"none",avoidEdges:"none",color:"none",haloBlur:"none",haloColor:"none",haloWidth:"none",keepUpright:"none",offsetAnchor:"none",size:{support:"partial",info:"Will set/get the width of the ol Icon."},optional:"none",padding:"none",pitchAlignment:"none",rotationAlignment:"none",textFit:"none",textFitPadding:"none"},LineSymbolizer:{blur:"none",gapWidth:"none",gradient:"none",miterLimit:"none",roundLimit:"none",spacing:"none",graphicFill:"none",graphicStroke:"none",perpendicularOffset:"none"},RasterSymbolizer:"none",TextSymbolizer:{anchor:"none",placement:{support:"partial",info:"point and line supported. line-center will be mapped to line."}}},Function:{double2bool:{support:"none",info:"Always returns false"},atan2:{support:"none",info:"Currently returns the first argument"},rint:{support:"none",info:"Currently returns the first argument"},numberFormat:{support:"none",info:"Currently returns the first argument"},strAbbreviate:{support:"none",info:"Currently returns the first argument"}}});E(this,"title","OpenLayers Style Parser");E(this,"olIconStyleCache",{});E(this,"OlStyleConstructor",Bt);E(this,"OlStyleImageConstructor",_t);E(this,"OlStyleFillConstructor",Xt);E(this,"OlStyleStrokeConstructor",Pe);E(this,"OlStyleTextConstructor",De);E(this,"OlStyleCircleConstructor",Me);E(this,"OlStyleIconConstructor",Yt);E(this,"OlStyleRegularshapeConstructor",Wt);E(this,"isOlParserStyleFct",t=>typeof t=="function");t&&(this.OlStyleConstructor=t.style.Style,this.OlStyleImageConstructor=t.style.Image,this.OlStyleFillConstructor=t.style.Fill,this.OlStyleStrokeConstructor=t.style.Stroke,this.OlStyleTextConstructor=t.style.Text,this.OlStyleCircleConstructor=t.style.Circle,this.OlStyleIconConstructor=t.style.Icon,this.OlStyleRegularshapeConstructor=t.style.RegularShape)}getPointSymbolizerFromOlStyle(t){let e;if(t.getImage()instanceof this.OlStyleCircleConstructor){const n=t.getImage(),r=n.getFill(),s=n.getStroke(),a=n.getDisplacement();e={kind:"Mark",wellKnownName:"circle",color:r?_.getHexColor(r.getColor()):void 0,opacity:n.getOpacity()!==1?n.getOpacity():void 0,fillOpacity:r?_.getOpacity(r.getColor()):void 0,radius:n.getRadius()!==0?n.getRadius():5,strokeColor:s?s.getColor():void 0,strokeOpacity:s?_.getOpacity(s.getColor()):void 0,strokeWidth:s?s.getWidth():void 0,offset:a[0]||a[1]?a:void 0}}else if(t.getImage()instanceof this.OlStyleRegularshapeConstructor){const n=t.getImage(),r=n.getFill(),s=n.getStroke(),a=n.getRadius(),o=n.getRadius2(),l=n.getPoints(),h=n.getAngle(),c=n.getDisplacement(),f={kind:"Mark",color:r?_.getHexColor(r.getColor()):void 0,opacity:n.getOpacity()!==1?n.getOpacity():void 0,fillOpacity:r?_.getOpacity(r.getColor()):void 0,strokeColor:s?s.getColor():void 0,strokeOpacity:s?_.getOpacity(s.getColor()):void 0,strokeWidth:s?s.getWidth():void 0,radius:a!==0?a:5,rotate:n.getRotation()/Math.PI*180,offset:c[0]||c[1]?c:void 0};switch(l){case 2:switch(h){case 0:f.wellKnownName="shape://vertline";break;case Math.PI/2:f.wellKnownName="shape://horline";break;case Math.PI/4:f.wellKnownName="shape://slash";break;case 2*Math.PI-Math.PI/4:f.wellKnownName="shape://backslash";break}break;case 3:switch(h){case 0:f.wellKnownName="triangle";break;case Math.PI/2:f.wellKnownName="shape://carrow";break}break;case 4:Number.isFinite(o)?n.getAngle()===0?f.wellKnownName="cross":f.wellKnownName="x":f.wellKnownName="square";break;case 5:f.wellKnownName="star";break;default:throw new Error("Could not parse OlStyle. Only 2, 3, 4 or 5 point regular shapes are allowed")}e=f}else if(t.getText()instanceof this.OlStyleTextConstructor){const n=t.getText(),r=n.getFill(),s=n.getStroke(),a=n.getRotation();let o=n.getText()||"a";const l=n.getFont()||"10px sans-serif",h=_.getFontNameFromOlFont(l),c=_.getSizeFromOlFont(l),f=[n.getOffsetX(),n.getOffsetY()];Array.isArray(o)&&(o=o[0]),e={kind:"Mark",wellKnownName:`ttf://${h}#0x${o.charCodeAt(0).toString(16)}`,color:r?_.getHexColor(r.getColor()):void 0,opacity:r?_.getOpacity(r.getColor()):void 0,strokeColor:s?s.getColor():void 0,strokeOpacity:s?_.getOpacity(s.getColor()):void 0,strokeWidth:s?s.getWidth():void 0,radius:c!==0?c:5,rotate:a?a/Math.PI*180:0,offset:f[0]||f[1]?f:void 0}}else{const n=t.getImage(),r=n.getDisplacement();let s=n.getWidth();const a=n.getRotation()/Math.PI*180,o=n.getOpacity();try{const l=_.getBase64DecodedSvg(n.getSrc()),{id:h,dimensions:c,fill:f,stroke:u,strokeWidth:d}=Xe(l);let{fillOpacity:g,strokeOpacity:m}=Xe(l);g=_.checkOpacity(g)?g:_.getOpacity(String(f)),m=_.checkOpacity(m)?m:_.getOpacity(String(u)),e={kind:"Mark",wellKnownName:h,...f&&{color:f},..._.checkOpacity(g)&&{fillOpacity:g},...u&&{strokeColor:u.substring(0,7)},...d&&{strokeWidth:d},..._.checkOpacity(m)&&{strokeOpacity:m},...c/2!==0&&{radius:c/2},..._.checkOpacity(o)&&{opacity:o},...a&&{rotate:a},...(r[0]||r[1])&&{offset:r}}}catch{e={kind:"Icon",image:this.getImageFromIconStyle(n),size:s,..._.checkOpacity(o)&&{opacity:o},...a&&{rotate:a},...(r[0]||r[1])&&{offset:r}}}}return e}getImageFromIconStyle(t){const e=t.getSize();if(Array.isArray(e)){let n=t.offset_;const r=t.offsetOrigin_;if(r&&r!=="top-left")throw new Error(`Offset origin ${r} not supported`);return{source:t.getSrc(),position:n,size:e}}else return t.getSrc()?t.getSrc():void 0}getLineSymbolizerFromOlStyle(t){const e=t.getStroke(),n=e?e.getLineDash():void 0;return{kind:"Line",color:e?_.getHexColor(e.getColor()):void 0,opacity:e?_.getOpacity(e.getColor()):void 0,width:e?e.getWidth():void 0,cap:e?e.getLineCap():"butt",join:e?e.getLineJoin():"miter",dasharray:n||void 0,dashOffset:e?e.getLineDashOffset():void 0}}getFillSymbolizerFromOlStyle(t){const e=t.getFill(),n=t.getStroke(),r=n?n.getLineDash():void 0,s={kind:"Fill"};return e&&(s.color=_.getHexColor(e.getColor())),e&&(s.fillOpacity=_.getOpacity(e.getColor())),n&&(s.outlineColor=_.getHexColor(n.getColor())),r&&(s.outlineDasharray=r),n&&(s.outlineOpacity=_.getOpacity(n.getColor())),n&&n.getWidth()&&(s.outlineWidth=n.getWidth()),s}getTextSymbolizerFromOlStyle(t){const e=t.getText();if(!e)throw new Error("Could not get text from olStyle.");const n=e.getFill(),r=e.getStroke(),s=e.getOffsetX(),a=e.getOffsetY(),o=e.getFont(),l=e.getRotation(),h=e.getOverflow()?e.getOverflow():void 0,c=e.getPlacement(),f=e.getText(),u=Array.isArray(f)?f[0]:f;let d=1/0,g,m,y;if(o){const x=ca(o);if(x["font-weight"]&&(m=x["font-weight"]),x["font-size"]&&(d=parseInt(x["font-size"],10)),x["font-family"]){const p=x["font-family"];g=p==null?void 0:p.map(S=>S.includes(" ")?'"'+S+'"':S)}x["font-style"]&&(y=x["font-style"])}return{kind:"Text",label:u,placement:c,allowOverlap:h,color:n?_.getHexColor(n.getColor()):void 0,size:isFinite(d)?d:void 0,font:g,fontWeight:m||void 0,fontStyle:y||void 0,offset:s!==void 0&&a!==void 0?[s,a]:[0,0],haloColor:r&&r.getColor()?_.getHexColor(r.getColor()):void 0,haloWidth:r?r.getWidth():void 0,rotate:l!==void 0?l/Math.PI*180:void 0}}getSymbolizersFromOlStyle(t){const e=[];return t.forEach(n=>{let r;switch(this.getStyleTypeFromOlStyle(n)){case"Point":n.getText()&&!_.getIsMarkSymbolizerFont(n.getText().getFont())?r=this.getTextSymbolizerFromOlStyle(n):r=this.getPointSymbolizerFromOlStyle(n);break;case"Line":r=this.getLineSymbolizerFromOlStyle(n);break;case"Fill":r=this.getFillSymbolizerFromOlStyle(n);break;default:throw new Error("Failed to parse SymbolizerKind from OpenLayers Style")}e.push(r)}),e}getRuleFromOlStyle(t){let e;const n="OL Style Rule 0";return Array.isArray(t)?e=this.getSymbolizersFromOlStyle(t):e=this.getSymbolizersFromOlStyle([t]),{name:n,symbolizers:e}}getStyleTypeFromOlStyle(t){let e;if(t.getImage()instanceof this.OlStyleImageConstructor)e="Point";else if(t.getText()instanceof this.OlStyleTextConstructor)e="Point";else if(t.getFill()instanceof this.OlStyleFillConstructor)e="Fill";else if(t.getStroke()&&!t.getFill())e="Line";else throw new Error("StyleType could not be detected");return e}olStyleToGeoStylerStyle(t){const e="OL Style",n=this.getRuleFromOlStyle(t);return{name:e,rules:[n]}}readStyle(t){return new Promise(e=>{try{if(this.isOlParserStyleFct(t))e({output:t.__geoStylerStyle});else{t=t;const n=this.olStyleToGeoStylerStyle(t),r=this.checkForUnsupportedProperties(n);e({output:n,unsupportedProperties:r})}}catch(n){e({errors:[n]})}})}writeStyle(t){return new Promise(async e=>{const n=structuredClone(t),r=this.checkForUnsupportedProperties(n);try{const s=await this.getOlStyleTypeFromGeoStylerStyle(n);e({output:s,unsupportedProperties:r,warnings:r&&["Your style contains unsupportedProperties!"]})}catch(s){e({errors:[s]})}})}checkForUnsupportedProperties(t){const e=r=>r[0].toUpperCase()+r.slice(1),n={};if(t.rules.forEach(r=>{r.symbolizers.forEach(s=>{var l,h;const a=e(`${s.kind}Symbolizer`),o=(h=(l=this.unsupportedProperties)==null?void 0:l.Symbolizer)==null?void 0:h[a];o&&(typeof o=="string"?(n.Symbolizer||(n.Symbolizer={}),n.Symbolizer[a]=o):Object.keys(s).forEach(c=>{o[c]&&(n.Symbolizer||(n.Symbolizer={}),n.Symbolizer[a]||(n.Symbolizer[a]={}),n.Symbolizer[a][c]=o[c])}))})}),Object.keys(n).length>0)return n}async getOlStyleTypeFromGeoStylerStyle(t){var r,s,a,o,l,h,c,f;const e=t.rules;if(e.length===1){const u=((s=(r=t==null?void 0:t.rules)==null?void 0:r[0])==null?void 0:s.filter)!==void 0,d=((l=(o=(a=t==null?void 0:t.rules)==null?void 0:a[0])==null?void 0:o.scaleDenominator)==null?void 0:l.min)!==void 0,g=((f=(c=(h=t==null?void 0:t.rules)==null?void 0:h[0])==null?void 0:c.scaleDenominator)==null?void 0:f.max)!==void 0,m=!!(d||g),y=_.containsGeoStylerFunctions(t),x=t.rules[0].symbolizers.length,p=e[0].symbolizers.some(O=>O.kind==="Text"),S=e[0].symbolizers.some(O=>O.kind==="Icon"&&typeof O.image=="string"&&O.image.includes("{{"));return!u&&!m&&!p&&!S&&!y?x===1?await this.geoStylerStyleToOlStyle(t):await this.geoStylerStyleToOlStyleArray(t):await this.geoStylerStyleToOlParserStyleFct(t)}else return await this.geoStylerStyleToOlParserStyleFct(t)}async geoStylerStyleToOlStyle(t){const n=t.rules[0].symbolizers[0];return await this.getOlSymbolizerFromSymbolizer(n)}async geoStylerStyleToOlStyleArray(t){const e=t.rules[0],n=[];for(const r of e.symbolizers){const s=await this.getOlSymbolizerFromSymbolizer(r);n.push(s)}return n}async geoStylerStyleToOlParserStyleFct(t){const e=structuredClone(t.rules),r=async(s,a)=>{var u,d;const o=[],l=90.7142857142857,h=rn.m,f=a*h*39.37*l;for(const g of e){let m=(u=g==null?void 0:g.scaleDenominator)==null?void 0:u.min,y=(d=g==null?void 0:g.scaleDenominator)==null?void 0:d.max,x=!0;(m||y)&&(m=k(m)?_.evaluateNumberFunction(m):m,y=k(y)?_.evaluateNumberFunction(y):y,m&&f<m&&(x=!1),y&&f>=y&&(x=!1));let p=!1;if(!g.filter)p=!0;else try{p=this.geoStylerFilterToOlParserFilter(s,g.filter)}catch{p=!1}if(x&&p)for(const S of g.symbolizers){S.visibility===!1&&o.push(null),It(S.visibility)&&(_.evaluateBooleanFunction(S.visibility)||o.push(null));const O=await this.getOlSymbolizerFromSymbolizer(S,s);if(typeof O!="function")o.push(O);else{const R=O(s,a);o.push(R)}}}return o};return r.__geoStylerStyle=t,r}geoStylerFilterToOlParserFilter(t,e){const n={"&&":!0,"||":!0,"!":!0};let r=!0;if(It(e))return _.evaluateBooleanFunction(e,t);if(e===!0||e===!1)return e;const s=e[0];let a=!1;n[s]&&(a=!0);try{if(a){let o,l;switch(e[0]){case"&&":o=!0,l=e.slice(1),l.forEach(h=>{this.geoStylerFilterToOlParserFilter(t,h)||(o=!1)}),r=o;break;case"||":o=!1,l=e.slice(1),l.forEach(h=>{this.geoStylerFilterToOlParserFilter(t,h)&&(o=!0)}),r=o;break;case"!":r=!this.geoStylerFilterToOlParserFilter(t,e[1]);break;default:throw new Error("Cannot parse Filter. Unknown combination or negation operator.")}}else{let o;k(e[1])?o=_.evaluateFunction(e[1],t):o=t.get(e[1]);let l;switch(k(e[2])?l=_.evaluateFunction(e[2],t):l=e[2],e[0]){case"==":r=""+o==""+l;break;case"*=":typeof l=="string"&&typeof o=="string"&&(l.length>o.length?r=!1:r=o.indexOf(l)!==-1);break;case"!=":r=""+o!=""+l;break;case"<":r=Number(o)<Number(l);break;case"<=":r=Number(o)<=Number(l);break;case">":r=Number(o)>Number(l);break;case">=":r=Number(o)>=Number(l);break;default:throw new Error("Cannot parse Filter. Unknown comparison operator.")}}}catch{throw new Error("Cannot parse Filter. Invalid structure.")}return r}async getOlSymbolizerFromSymbolizer(t,e){let n;switch(t=structuredClone(t),t.kind){case"Mark":n=await this.getOlPointSymbolizerFromMarkSymbolizer(t,e);break;case"Icon":n=await this.getOlIconSymbolizerFromIconSymbolizer(t,e);break;case"Text":n=this.getOlTextSymbolizerFromTextSymbolizer(t,e);break;case"Line":n=this.getOlLineSymbolizerFromLineSymbolizer(t,e);break;case"Fill":n=await this.getOlPolygonSymbolizerFromFillSymbolizer(t,e);break;default:const r=new this.OlStyleFillConstructor({color:"rgba(255,255,255,0.4)"}),s=new this.OlStyleStrokeConstructor({color:"#3399CC",width:1.25});n=new this.OlStyleConstructor({image:new this.OlStyleCircleConstructor({fill:r,stroke:s,radius:5}),fill:r,stroke:s});break}return n}async getOlPointSymbolizerFromMarkSymbolizer(t,e){for(const u of Object.keys(t))k(t[u])&&(t[u]=_.evaluateFunction(t[u],e));const n=t.strokeColor,r=t.strokeOpacity,s=t.strokeWidth,a=t.color,o=t.fillOpacity,l=Number(t.rotate)*Math.PI/180,h=t.offset;let c,f=Ao(t.wellKnownName);if(Vn(f)){const u=((t==null?void 0:t.radius)??6)*2,d=t.opacity,g={dimensions:u,...a&&{fill:a},..._.checkOpacity(o)&&{fillOpacity:o},...n&&{stroke:n},...s&&{strokeWidth:s},..._.checkOpacity(r)&&{strokeOpacity:r}},m=Ro(f,g);c=new this.OlStyleConstructor({image:new this.OlStyleIconConstructor({src:_.getBase64EncodedSvg(m),crossOrigin:"anonymous",...h&&{displacement:h},..._.checkOpacity(d)&&{opacity:d},...l&&{rotation:l},scale:1})})}else if(_.getIsFontGlyphBased(t)){const u=n&&r?_.getRgbaColor(n,r):n,d=a&&o?_.getRgbaColor(a,o):a,g=new this.OlStyleStrokeConstructor({...u&&{color:u},...s&&{width:s}}),m=new this.OlStyleFillConstructor({...d&&{color:d}});c=new this.OlStyleConstructor({text:new this.OlStyleTextConstructor({text:_.getCharacterForMarkSymbolizer(t),font:_.getTextFontForMarkSymbolizer(t),...m&&{fill:m},...h&&{offsetX:h[0]},...h&&{offsetY:h[1]},...g&&{stroke:g},...l&&{rotation:l}})})}else throw new Error("MarkSymbolizer cannot be parsed. Unsupported WellKnownName.");return c}async getOlIconSymbolizerFromIconSymbolizer(t,e){for(const l of Object.keys(t))k(t[l])&&(t[l]=_.evaluateFunction(t[l],e));const n={src:pe(t.image)?t.image.source:t.image,crossOrigin:"anonymous",opacity:t.opacity,width:t.size,rotation:typeof t.rotate=="number"?t.rotate*Math.PI/180:void 0,displacement:t.offset,size:pe(t.image)?t.image.size:void 0,offset:pe(t.image)?t.image.position:void 0},r="\\{\\{",s="\\}\\}",a=new RegExp(r+".*?"+s,"g");return(typeof t.image=="string"?t.image.match(a):null)?h=>{let c=_.resolveAttributeTemplate(h,t.image,"");c||(c=t.image+"");let f;return this.olIconStyleCache[c]?(f=this.olIconStyleCache[c],n.rotation!==void 0&&f.setRotation(n.rotation),n.opacity!==void 0&&f.setOpacity(n.opacity)):(f=new this.OlStyleIconConstructor({...n,src:c}),this.olIconStyleCache[c]=f),new this.OlStyleConstructor({image:f})}:new this.OlStyleConstructor({image:new this.OlStyleIconConstructor({...n})})}getOlLineSymbolizerFromLineSymbolizer(t,e){for(const a of Object.keys(t))k(t[a])&&(t[a]=_.evaluateFunction(t[a],e));const n=t.color,r=t.opacity,s=n&&r!==null&&r!==void 0?_.getRgbaColor(n,r):n;return new this.OlStyleConstructor({stroke:new this.OlStyleStrokeConstructor({color:s,width:t.width,lineCap:t.cap,lineJoin:t.join,lineDash:t.dasharray,lineDashOffset:t.dashOffset})})}async getOlPolygonSymbolizerFromFillSymbolizer(t,e){for(const u of Object.keys(t))k(t[u])&&(t[u]=_.evaluateFunction(t[u],e));const n=t.color,r=t.fillOpacity,s=n&&Number.isFinite(r)?_.getRgbaColor(n,r):n;let a=n?new this.OlStyleFillConstructor({color:s}):void 0;const o=t.outlineColor,l=t.outlineOpacity,h=o&&Number.isFinite(l)?_.getRgbaColor(o,l):o,c=o||t.outlineWidth?new this.OlStyleStrokeConstructor({color:h,width:t.outlineWidth,lineDash:t.outlineDasharray}):void 0,f=new this.OlStyleConstructor({fill:a,stroke:c});if(t.graphicFill){const u=this.getOlPatternFromGraphicFill(t.graphicFill);a||(a=new this.OlStyleFillConstructor({})),u&&a.setColor(await u),f.setFill(a)}return f}async getOlPatternFromGraphicFill(t){return new Promise(async(e,n)=>{let r,s=[16,16],a=1,o=1;if(fa(t))r=await this.getOlIconSymbolizerFromIconSymbolizer(t),s=r.getSize();else if(da(t)){r=await this.getOlPointSymbolizerFromMarkSymbolizer(t);const p=_.getBase64DecodedSvg(r.getImage().getSrc()),{id:S,dimensions:O}=Xe(p);if(O)if(s=[O,O],qn.includes(String(S))){const R=r.getImage().getRotation();R/(Math.PI/2)%1!==0&&(o=Math.abs(Math.cos(R))+Math.abs(Math.sin(R)))}else a=2}else{n(new Error("Unrecognised graphicFill type"));return}const l=r.getImage(),h=s.map(p=>p*a),c=document.createElement("canvas");c.width=h[0],c.height=h[1];const f=c.getContext("2d"),u=Po(f,{size:h,pixelRatio:1}),d=h.map(p=>p/2),g=new Do(new Oe(d)),m=new Image(s[0],s[1]);m.crossOrigin="anonymous",m.src=l.getSrc();const y=new Yt({crossOrigin:"anonymous",img:m,scale:o,size:s,rotation:l.getRotation()}),x=new Bt({image:y});m.onload=()=>{y.load(),u.drawFeature(g,x);const p=f.createPattern(c,"repeat");if(!p){n(new Error("Failed to create pattern"));return}e(p)}})}getOlTextSymbolizerFromTextSymbolizer(t,e){for(const m of Object.keys(t))k(t[m])&&(t[m]=_.evaluateFunction(t[m],e));const n=t.color;let r=t.placement;r||(r="point"),r==="line-center"&&(r="line");const s=t.opacity,a=n&&Number.isFinite(s)?_.getRgbaColor(n,s):n,o=t.haloColor,l=t.haloWidth,h=o&&Number.isFinite(s)?_.getRgbaColor(o,s):o,c={font:_.getTextFont(t),fill:new this.OlStyleFillConstructor({color:a}),stroke:new this.OlStyleStrokeConstructor({color:h,width:l||0}),overflow:t.allowOverlap,offsetX:t.offset?t.offset[0]:0,offsetY:t.offset?t.offset[1]:0,rotation:typeof t.rotate=="number"?t.rotate*Math.PI/180:void 0,placement:r},f="\\{\\{",u="\\}\\}",d=new RegExp(f+".*?"+u,"g");let g;return ft(t.label)||(g=t.label?t.label.match(d):null),g?y=>{const x=new this.OlStyleTextConstructor({text:_.resolveAttributeTemplate(y,t.label,""),...c});return new this.OlStyleConstructor({text:x})}:new this.OlStyleConstructor({text:new this.OlStyleTextConstructor({text:t.label,...c})})}}E(Jn,"title","OpenLayers Style Parser");class Be extends jt{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Be(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Zt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=St(t,st.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Go(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Go(i){if(typeof i=="function")return i;let t;return Array.isArray(i)?t=i:(Dr(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[i]),function(){return t}}var Ye="http://www.w3.org/1999/xhtml",Kn={svg:"http://www.w3.org/2000/svg",xhtml:Ye,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Zn(i){var t=i+="",e=t.indexOf(":");return e>=0&&(t=i.slice(0,e))!=="xmlns"&&(i=i.slice(e+1)),Kn.hasOwnProperty(t)?{space:Kn[t],local:i}:i}function zo(i){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===Ye&&t.documentElement.namespaceURI===Ye?t.createElement(i):t.createElementNS(e,i)}}function $o(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function jn(i){var t=Zn(i);return(t.local?$o:zo)(t)}function Wo(){}function Qn(i){return i==null?Wo:function(){return this.querySelector(i)}}function Xo(i){typeof i!="function"&&(i=Qn(i));for(var t=this._groups,e=t.length,n=new Array(e),r=0;r<e;++r)for(var s=t[r],a=s.length,o=n[r]=new Array(a),l,h,c=0;c<a;++c)(l=s[c])&&(h=i.call(l,l.__data__,c,s))&&("__data__"in l&&(h.__data__=l.__data__),o[c]=h);return new T(n,this._parents)}function tr(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function Bo(){return[]}function Yo(i){return i==null?Bo:function(){return this.querySelectorAll(i)}}function qo(i){return function(){var t=i.apply(this,arguments);return t==null?[]:tr(t)}}function Uo(i){typeof i=="function"?i=qo(i):i=Yo(i);for(var t=this._groups,e=t.length,n=[],r=[],s=0;s<e;++s)for(var a=t[s],o=a.length,l,h=0;h<o;++h)(l=a[h])&&(n.push(i.call(l,l.__data__,h,a)),r.push(l));return new T(n,r)}function Ho(i){return function(){return this.matches(i)}}function er(i){return function(t){return t.matches(i)}}var Vo=Array.prototype.find;function Jo(i){return function(){return Vo.call(this.children,i)}}function Ko(){return this.firstElementChild}function Zo(i){return this.select(i==null?Ko:Jo(typeof i=="function"?i:er(i)))}var jo=Array.prototype.filter;function Qo(){return this.children}function tl(i){return function(){return jo.call(this.children,i)}}function el(i){return this.selectAll(i==null?Qo:tl(typeof i=="function"?i:er(i)))}function il(i){typeof i!="function"&&(i=Ho(i));for(var t=this._groups,e=t.length,n=new Array(e),r=0;r<e;++r)for(var s=t[r],a=s.length,o=n[r]=[],l,h=0;h<a;++h)(l=s[h])&&i.call(l,l.__data__,h,s)&&o.push(l);return new T(n,this._parents)}function ir(i){return new Array(i.length)}function nl(){return new T(this._enter||this._groups.map(ir),this._parents)}function Ht(i,t){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=t}Ht.prototype={constructor:Ht,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,t){return this._parent.insertBefore(i,t)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function rl(i){return function(){return i}}function sl(i,t,e,n,r,s){for(var a=0,o,l=t.length,h=s.length;a<h;++a)(o=t[a])?(o.__data__=s[a],n[a]=o):e[a]=new Ht(i,s[a]);for(;a<l;++a)(o=t[a])&&(r[a]=o)}function al(i,t,e,n,r,s,a){var o,l,h=new Map,c=t.length,f=s.length,u=new Array(c),d;for(o=0;o<c;++o)(l=t[o])&&(u[o]=d=a.call(l,l.__data__,o,t)+"",h.has(d)?r[o]=l:h.set(d,l));for(o=0;o<f;++o)d=a.call(i,s[o],o,s)+"",(l=h.get(d))?(n[o]=l,l.__data__=s[o],h.delete(d)):e[o]=new Ht(i,s[o]);for(o=0;o<c;++o)(l=t[o])&&h.get(u[o])===l&&(r[o]=l)}function ol(i){return i.__data__}function ll(i,t){if(!arguments.length)return Array.from(this,ol);var e=t?al:sl,n=this._parents,r=this._groups;typeof i!="function"&&(i=rl(i));for(var s=r.length,a=new Array(s),o=new Array(s),l=new Array(s),h=0;h<s;++h){var c=n[h],f=r[h],u=f.length,d=tr(i.call(c,c&&c.__data__,h,n)),g=d.length,m=o[h]=new Array(g),y=a[h]=new Array(g),x=l[h]=new Array(u);e(c,f,m,y,x,d,t);for(var p=0,S=0,O,R;p<g;++p)if(O=m[p]){for(p>=S&&(S=p+1);!(R=y[S])&&++S<g;);O._next=R||null}}return a=new T(a,n),a._enter=o,a._exit=l,a}function hl(){return new T(this._exit||this._groups.map(ir),this._parents)}function cl(i,t,e){var n=this.enter(),r=this,s=this.exit();return n=typeof i=="function"?i(n):n.append(i+""),t!=null&&(r=t(r)),e==null?s.remove():e(s),n&&r?n.merge(r).order():r}function ul(i){if(!(i instanceof T))throw new Error("invalid merge");for(var t=this._groups,e=i._groups,n=t.length,r=e.length,s=Math.min(n,r),a=new Array(n),o=0;o<s;++o)for(var l=t[o],h=e[o],c=l.length,f=a[o]=new Array(c),u,d=0;d<c;++d)(u=l[d]||h[d])&&(f[d]=u);for(;o<n;++o)a[o]=t[o];return new T(a,this._parents)}function fl(){for(var i=this._groups,t=-1,e=i.length;++t<e;)for(var n=i[t],r=n.length-1,s=n[r],a;--r>=0;)(a=n[r])&&(s&&a.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(a,s),s=a);return this}function dl(i){i||(i=gl);function t(f,u){return f&&u?i(f.__data__,u.__data__):!f-!u}for(var e=this._groups,n=e.length,r=new Array(n),s=0;s<n;++s){for(var a=e[s],o=a.length,l=r[s]=new Array(o),h,c=0;c<o;++c)(h=a[c])&&(l[c]=h);l.sort(t)}return new T(r,this._parents).order()}function gl(i,t){return i<t?-1:i>t?1:i>=t?0:NaN}function ml(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function _l(){return Array.from(this)}function yl(){for(var i=this._groups,t=0,e=i.length;t<e;++t)for(var n=i[t],r=0,s=n.length;r<s;++r){var a=n[r];if(a)return a}return null}function pl(){let i=0;for(const t of this)++i;return i}function xl(){return!this.node()}function Sl(i){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],s=0,a=r.length,o;s<a;++s)(o=r[s])&&i.call(o,o.__data__,s,r);return this}function wl(i){return function(){this.removeAttribute(i)}}function Cl(i){return function(){this.removeAttributeNS(i.space,i.local)}}function vl(i,t){return function(){this.setAttribute(i,t)}}function Ol(i,t){return function(){this.setAttributeNS(i.space,i.local,t)}}function bl(i,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(i):this.setAttribute(i,e)}}function El(i,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,e)}}function kl(i,t){var e=Zn(i);if(arguments.length<2){var n=this.node();return e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}return this.each((t==null?e.local?Cl:wl:typeof t=="function"?e.local?El:bl:e.local?Ol:vl)(e,t))}function nr(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function Fl(i){return function(){this.style.removeProperty(i)}}function Ll(i,t,e){return function(){this.style.setProperty(i,t,e)}}function Il(i,t,e){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(i):this.style.setProperty(i,n,e)}}function Al(i,t,e){return arguments.length>1?this.each((t==null?Fl:typeof t=="function"?Il:Ll)(i,t,e??"")):Rl(this.node(),i)}function Rl(i,t){return i.style.getPropertyValue(t)||nr(i).getComputedStyle(i,null).getPropertyValue(t)}function Tl(i){return function(){delete this[i]}}function Ml(i,t){return function(){this[i]=t}}function Pl(i,t){return function(){var e=t.apply(this,arguments);e==null?delete this[i]:this[i]=e}}function Dl(i,t){return arguments.length>1?this.each((t==null?Tl:typeof t=="function"?Pl:Ml)(i,t)):this.node()[i]}function rr(i){return i.trim().split(/^|\s+/)}function qe(i){return i.classList||new sr(i)}function sr(i){this._node=i,this._names=rr(i.getAttribute("class")||"")}sr.prototype={add:function(i){var t=this._names.indexOf(i);t<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var t=this._names.indexOf(i);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function ar(i,t){for(var e=qe(i),n=-1,r=t.length;++n<r;)e.add(t[n])}function or(i,t){for(var e=qe(i),n=-1,r=t.length;++n<r;)e.remove(t[n])}function Nl(i){return function(){ar(this,i)}}function Gl(i){return function(){or(this,i)}}function zl(i,t){return function(){(t.apply(this,arguments)?ar:or)(this,i)}}function $l(i,t){var e=rr(i+"");if(arguments.length<2){for(var n=qe(this.node()),r=-1,s=e.length;++r<s;)if(!n.contains(e[r]))return!1;return!0}return this.each((typeof t=="function"?zl:t?Nl:Gl)(e,t))}function Wl(){this.textContent=""}function Xl(i){return function(){this.textContent=i}}function Bl(i){return function(){var t=i.apply(this,arguments);this.textContent=t??""}}function Yl(i){return arguments.length?this.each(i==null?Wl:(typeof i=="function"?Bl:Xl)(i)):this.node().textContent}function ql(){this.innerHTML=""}function Ul(i){return function(){this.innerHTML=i}}function Hl(i){return function(){var t=i.apply(this,arguments);this.innerHTML=t??""}}function Vl(i){return arguments.length?this.each(i==null?ql:(typeof i=="function"?Hl:Ul)(i)):this.node().innerHTML}function Jl(){this.nextSibling&&this.parentNode.appendChild(this)}function Kl(){return this.each(Jl)}function Zl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function jl(){return this.each(Zl)}function Ql(i){var t=typeof i=="function"?i:jn(i);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function th(){return null}function eh(i,t){var e=typeof i=="function"?i:jn(i),n=t==null?th:typeof t=="function"?t:Qn(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),n.apply(this,arguments)||null)})}function ih(){var i=this.parentNode;i&&i.removeChild(this)}function nh(){return this.each(ih)}function rh(){var i=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(i,this.nextSibling):i}function sh(){var i=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(i,this.nextSibling):i}function ah(i){return this.select(i?sh:rh)}function oh(i){return arguments.length?this.property("__data__",i):this.node().__data__}function lh(i){return function(t){i.call(this,t,this.__data__)}}function hh(i){return i.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}function ch(i){return function(){var t=this.__on;if(t){for(var e=0,n=-1,r=t.length,s;e<r;++e)s=t[e],(!i.type||s.type===i.type)&&s.name===i.name?this.removeEventListener(s.type,s.listener,s.options):t[++n]=s;++n?t.length=n:delete this.__on}}}function uh(i,t,e){return function(){var n=this.__on,r,s=lh(t);if(n){for(var a=0,o=n.length;a<o;++a)if((r=n[a]).type===i.type&&r.name===i.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=e),r.value=t;return}}this.addEventListener(i.type,s,e),r={type:i.type,name:i.name,value:t,listener:s,options:e},n?n.push(r):this.__on=[r]}}function fh(i,t,e){var n=hh(i+""),r,s=n.length,a;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,h=o.length,c;l<h;++l)for(r=0,c=o[l];r<s;++r)if((a=n[r]).type===c.type&&a.name===c.name)return c.value}return}for(o=t?uh:ch,r=0;r<s;++r)this.each(o(n[r],t,e));return this}function lr(i,t,e){var n=nr(i),r=n.CustomEvent;typeof r=="function"?r=new r(t,e):(r=n.document.createEvent("Event"),e?(r.initEvent(t,e.bubbles,e.cancelable),r.detail=e.detail):r.initEvent(t,!1,!1)),i.dispatchEvent(r)}function dh(i,t){return function(){return lr(this,i,t)}}function gh(i,t){return function(){return lr(this,i,t.apply(this,arguments))}}function mh(i,t){return this.each((typeof t=="function"?gh:dh)(i,t))}function*_h(){for(var i=this._groups,t=0,e=i.length;t<e;++t)for(var n=i[t],r=0,s=n.length,a;r<s;++r)(a=n[r])&&(yield a)}var yh=[null];function T(i,t){this._groups=i,this._parents=t}function ph(){return this}T.prototype={constructor:T,select:Xo,selectAll:Uo,selectChild:Zo,selectChildren:el,filter:il,data:ll,enter:nl,exit:hl,join:cl,merge:ul,selection:ph,order:fl,sort:dl,call:ml,nodes:_l,node:yl,size:pl,empty:xl,each:Sl,attr:kl,style:Al,property:Dl,classed:$l,text:Yl,html:Vl,raise:Kl,lower:jl,append:Ql,insert:eh,remove:nh,clone:ah,datum:oh,on:fh,dispatch:mh,[Symbol.iterator]:_h};function Ue(i){return typeof i=="string"?new T([[document.querySelector(i)]],[document.documentElement]):new T([[i]],yh)}class hr{constructor(t,e,n){this.size=t,this.maxColumnWidth=e,this.maxColumnHeight=n}}const cr="geostyler-legend-renderer";class xh extends hr{constructor(e,n,r,s){super(e,n||0,r||0);E(this,"root",null);E(this,"currentContainer",null);const a=document.createElementNS("http://www.w3.org/2000/svg","svg");this.root=Ue(a).attr("class",cr).attr("viewBox",`0 0 ${e[0]} ${e[1]}`).attr("top",0).attr("left",0).attr("width",e[0]).attr("height",e[1]),this.currentContainer=this.root,s&&(Ue(s).select(`.${cr}`).remove(),s.append(this.root.node()))}useContainer(e){var n;this.currentContainer=(n=this.root)==null?void 0:n.append("g").attr("class","legend-item").attr("title",e)}useRoot(){this.currentContainer=this.root}addTitle(e,n,r){var s;(s=this.currentContainer)==null||s.append("g").append("text").text(e).attr("class","legend-title").attr("text-anchor","start").attr("dx",n).attr("dy",r)}addLabel(e,n,r){var s;(s=this.currentContainer)==null||s.append("text").text(e).attr("x",n).attr("y",r)}addImage(e,n,r,s,a,o){var l,h,c;return o&&((l=this.currentContainer)==null||l.append("rect").attr("x",s).attr("y",a).attr("width",n).attr("height",r).style("fill-opacity",0).style("stroke","black")),(h=this.currentContainer)==null||h.append("svg:image").attr("x",s).attr("y",a).attr("width",n).attr("height",r).attr("href",e),(c=this.root)==null||c.attr("xmlns","http://www.w3.org/2000/svg"),Promise.resolve()}generate(e){var r,s,a;const n=(r=this.root)==null?void 0:r.selectAll("g.legend-item");return this.shortenLabels(n,this.maxColumnWidth||0),this.maxColumnHeight||(s=this.root)==null||s.attr("viewBox",`0 0 ${this.size[0]} ${e}`).attr("height",e),(a=this.root)==null?void 0:a.node()}shortenLabels(e,n){e==null||e.each(function(){const r=Ue(this),s=r.select("text");if(!(r.node()instanceof SVGElement)||!s.size())return;const a=s.node();let o=a.getBoundingClientRect().width,l=!1;for(;o>n;){let h=s.text();h=h.substring(0,h.length-1),s.text(h),o=a.getBoundingClientRect().width,l=!0}if(l){let h=s.text();h=h.substring(0,h.length-3),s.text(h+"...")}})}}const ur="geostyler-legend-renderer";function rt(i){if(typeof i=="number")return i;const t=document.createElement("div");document.body.append(t),t.style.height=i;const e=parseFloat(getComputedStyle(t).height.replace(/px$/,""));return t.remove(),e}class Sh extends hr{constructor(e,n,r,s){super(e,n,r);E(this,"canvas");E(this,"context");this.target=s,this.createCanvas(...e)}useContainer(e){}useRoot(){}addTitle(e,n,r){this.context.fillText(e,rt(n),rt(r))}addLabel(e,n,r){this.context.fillText(e,rt(n),rt(r))}async addImage(e,n,r,s,a,o){const l=rt(s),h=rt(a);this.expandHeight(h+r);const c=new Image,f=new Promise(u=>c.onload=u);c.src=e,await f,this.context.drawImage(c,l,h,n,r),o&&(this.context.strokeStyle="1px solid black",this.context.strokeRect(l,h,n,r))}generate(e){return this.canvas}createCanvas(e,n){this.canvas=document.createElement("canvas"),this.canvas.className=ur,this.canvas.width=e,this.canvas.height=n,this.context=this.canvas.getContext("2d"),this.context.font="14px sans-serif",this.target&&(this.target.querySelectorAll(`.${ur}`).forEach(r=>r.remove()),this.target.append(this.canvas))}expandHeight(e){if(this.canvas.height>=e)return;const n=this.canvas;this.createCanvas(this.canvas.width,e),this.context.drawImage(n,0,0)}}const v=[45,30];class wh{constructor(t){E(this,"config",null);this.config=t}extractConfigFromStyle(t){const e={items:[],title:""};return t.name&&(e.title=t.name),t.rules.forEach(n=>{e.items.push({title:n.name,rule:n})}),e}renderLegendItem(t,e,n){if(!this.config)return;const{hideRect:r,maxColumnHeight:s,maxColumnWidth:a}=this.config;if(e.rule)return t.useContainer(e.title),this.getRuleIcon(e.rule).then(async o=>{await t.addImage(o,...v,n[0]+1,n[1],!r),t.addLabel(e.title,n[0]+v[0]+5,n[1]+20),n[1]+=v[1]+5,s&&n[1]+v[1]+5>=s&&(n[1]=5,n[0]+=a||0)}).catch(()=>{})}getGeometryForSymbolizer(t){if(!Wi(t))throw new Error("Invalid symbolizer");switch(t.kind){case"Mark":case"Icon":case"Text":return new re([v[0]/2,v[1]/2]);case"Fill":return new bt([[[3,3],[v[0]-3,3],[v[0]-3,v[1]-3],[3,v[1]-3],[3,3]]]);case"Line":return new Et([[v[0]/6,v[1]/6],[v[0]/3,v[1]/3*2],[v[0]/2,v[1]/3],[v[0]/6*5,v[1]/6*5]]);default:return new re([v[0]/2,v[1]/2])}}getRuleIcon(t){if(!sa(t))return Promise.reject("Invalid rule");const e=document.createElement("canvas");e.setAttribute("width",`${v[0]}`),e.setAttribute("height",`${v[1]}`);const n=q([[0,0],[v[0],v[1]]]),r=1,s=e.getContext("2d"),a=Qt(),o=new Bs(s,r,n,a,0),l=[];t.symbolizers.forEach(f=>l.push(this.getGeometryForSymbolizer(f)));const h=new Jn,c={name:"",rules:[{name:"",symbolizers:t.symbolizers}]};return new Promise(async(f,u)=>{function d(){l.forEach(g=>o.drawGeometry(g))}try{let{output:g,errors:m=[]}=await h.writeStyle(c);m.length>0&&u(m[0]),typeof g=="function"&&(g=g(new Be(l[0]),1)),Array.isArray(g)?g.forEach(y=>{o.setStyle(y),d()}):(o.setStyle(g),d()),f(e.toDataURL("image/png"))}catch{u()}})}renderLegend(t,e,n){if(this.config)return e.useRoot(),this.config.overflow!=="auto"&&n[0]!==0&&t.items.length*(v[1]+5)+20+n[1]>this.config.maxColumnHeight&&(n[0]+=this.config.maxColumnWidth,n[1]=0),t.title&&(e.addTitle(t.title,n[0],n[1]===0?"1em":n[1]+15),n[1]+=20),t.items.reduce((r,s)=>r.then(()=>this.renderLegendItem(e,s,n)),Promise.resolve())}async renderImages(t,e,n){for(let a=0;a<t.length;a++){const o=t[a].url,l=t[a].title;try{const c=await(await fetch(o)).blob(),u=await(async g=>new Promise((m,y)=>{try{const x=new FileReader;x.onload=async p=>{const S=p.target.result;m(S)},x.readAsDataURL(g)}catch(x){y(x)}}))(c);let d=new Image;d.src=u.toString(),await d.decode(),this.config.overflow==="auto"&&d.height+20+5+n[1]>this.config.maxColumnHeight&&(n[0]+=this.config.maxColumnWidth,n[1]=0),l&&(e.useRoot(),n[1]+=20,e.addTitle(l,...n),n[1]+=5),await e.addImage(u.toString(),d.width,d.height,...n,!1),n[1]+=d.height}catch(h){console.error("Error on fetching legend: ",h);continue}}}async renderAsImage(t,e){if(!this.config)return Promise.reject();const{styles:n,configs:r,size:[s,a],remoteLegends:o,maxColumnWidth:l,maxColumnHeight:h}=this.config,c=[];n&&n.forEach(g=>c.push(this.extractConfigFromStyle(g))),r&&c.unshift.apply(c,r);const f=t==="svg"?xh:Sh,u=new f([s,a],l||0,h||0,e),d=[0,0];for(let g=0;g<c.length;g++)await this.renderLegend(c[g],u,d);return o&&await this.renderImages(o,u,d),u.generate(d[1])}async render(t,e="svg"){await this.renderAsImage(e,t)}}return P.LegendRenderer=wh,P}({});
//# sourceMappingURL=geoStylerLegend.iife.js.map
