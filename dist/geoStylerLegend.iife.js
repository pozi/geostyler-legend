var GeoStylerLegend=function(Z){"use strict";var Uh=Object.defineProperty;var Xh=(Z,b,lt)=>b in Z?Uh(Z,b,{enumerable:!0,configurable:!0,writable:!0,value:lt}):Z[b]=lt;var $=(Z,b,lt)=>Xh(Z,typeof b!="symbol"?b+"":b,lt);var b={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function lt(i){const t=me();for(let e=0,n=i.length;e<n;++e)Lr(t,i[e]);return t}function ge(i,t,e){let n,r;return t<i[0]?n=i[0]-t:i[2]<t?n=t-i[2]:n=0,e<i[1]?r=i[1]-e:i[3]<e?r=e-i[3]:r=0,n*n+r*r}function Ir(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function Fr(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function ci(i,t){const e=i[0],n=i[1],r=i[2],s=i[3],o=t[0],a=t[1];let c=b.UNKNOWN;return o<e?c=c|b.LEFT:o>r&&(c=c|b.RIGHT),a<n?c=c|b.BELOW:a>s&&(c=c|b.ABOVE),c===b.UNKNOWN&&(c=b.INTERSECTING),c}function me(){return[1/0,1/0,-1/0,-1/0]}function ui(i,t,e,n,r){return r?(r[0]=i,r[1]=t,r[2]=e,r[3]=n,r):[i,t,e,n]}function fi(i){return ui(1/0,1/0,-1/0,-1/0,i)}function Ar(i,t){const e=i[0],n=i[1];return ui(e,n,e,n,t)}function Or(i,t,e,n,r){const s=fi(r);return di(s,i,t,e,n)}function Lr(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function di(i,t,e,n,r){for(;e<n;e+=r)kr(i,t[e],t[e+1]);return i}function kr(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function br(i,t){let e;return e=t(Rr(i)),e||(e=t(Tr(i)),e)||(e=t(Pr(i)),e)||(e=t(Mr(i)),e)?e:!1}function Rr(i){return[i[0],i[1]]}function Tr(i){return[i[2],i[1]]}function gi(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function mi(i){return i[3]-i[1]}function Mr(i){return[i[0],i[3]]}function Pr(i){return[i[2],i[3]]}function ht(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function Dr(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function Br(i,t,e){let n=!1;const r=ci(i,t),s=ci(i,e);if(r===b.INTERSECTING||s===b.INTERSECTING)n=!0;else{const o=i[0],a=i[1],c=i[2],u=i[3],d=t[0],_=t[1],g=e[0],p=e[1],x=(p-_)/(g-d);let C,E;s&b.ABOVE&&!(r&b.ABOVE)&&(C=g-(p-u)/x,n=C>=o&&C<=c),!n&&s&b.RIGHT&&!(r&b.RIGHT)&&(E=p-(g-c)*x,n=E>=a&&E<=u),!n&&s&b.BELOW&&!(r&b.BELOW)&&(C=g-(p-a)/x,n=C>=o&&C<=c),!n&&s&b.LEFT&&!(r&b.LEFT)&&(E=p-(g-o)*x,n=E>=a&&E<=u)}return n}let _i=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var Nr={PROPERTYCHANGE:"propertychange"};let Gr=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function $r(i,t,e){let n,r;e=e||pi;let s=0,o=i.length,a=!1;for(;s<o;)n=s+(o-s>>1),r=+e(i[n],t),r<0?s=n+1:(o=n,a=!r);return a?s:~s}function pi(i,t){return i>t?1:i<t?-1:0}function yi(i,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let r=0;r<n;r++)i[i.length]=e[r]}function wi(i,t){const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}function xi(){}function Wr(i){let t,e,n;return function(){const r=Array.prototype.slice.call(arguments);return(!e||this!==n||!wi(r,e))&&(n=this,e=r,t=i.apply(this,arguments)),t}}function Si(i){for(const t in i)delete i[t]}function zr(i){let t;for(t in i)return!1;return!t}let Ci=class extends Gr{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),r=n[t]||(n[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,r=this.listeners_&&this.listeners_[n];if(!r)return;const s=e?new _i(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let c;for(let u=0,d=r.length;u<d;++u)if("handleEvent"in r[u]?c=r[u].handleEvent(s):c=r[u].call(this,s),c===!1||s.propagationStopped){c=!1;break}if(--o[n]===0){let u=a[n];for(delete a[n];u--;)this.removeEventListener(n,xi);delete o[n]}return c}disposeInternal(){this.listeners_&&Si(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const r=n.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[r]=xi,++this.pendingRemovals_[t]):(n.splice(r,1),n.length===0&&delete this.listeners_[t]))}};var It={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function Wt(i,t,e,n,r){if(r){const o=e;e=function(){i.removeEventListener(t,e),o.apply(n??this,arguments)}}else n&&n!==i&&(e=e.bind(n));const s={target:i,type:t,listener:e};return i.addEventListener(t,e),s}function vi(i,t,e,n){return Wt(i,t,e,n,!0)}function _e(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),Si(i))}let Ur=class extends Ci{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(It.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=Wt(this,t[s],e);return r}return Wt(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const r=t.length;n=new Array(r);for(let s=0;s<r;++s)n[s]=vi(this,t[s],e)}else n=vi(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)Xr(n);else if(Array.isArray(t))for(let r=0,s=t.length;r<s;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}};function Xr(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)_e(i[t]);else _e(i)}function H(){throw new Error("Unimplemented abstract method.")}let Yr=0;function qr(i){return i.ol_uid||(i.ol_uid=String(++Yr))}let Ei=class extends _i{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}},pe=class extends Ur{constructor(t){super(),this.on,this.once,this.un,qr(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new Ei(n,t,e)),n=Nr.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new Ei(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const r=this.values_||(this.values_={});if(n)r[t]=e;else{const s=r[t];r[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],zr(this.values_)&&(this.values_=null),e||this.notify(t,n)}}};function Hr(i,t){if(!i)throw new Error(t)}new Array(6);function ye(){return[1,0,0,1,0,0]}function Ii(i,t,e,n,r,s,o,a){const c=Math.sin(s),u=Math.cos(s);return i[0]=n*u,i[1]=r*c,i[2]=-n*c,i[3]=r*u,i[4]=o*n*u-a*n*c+t,i[5]=o*r*c+a*r*u+e,i}const Vr={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let Fi=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Vr[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const Ft=6378137,ct=Math.PI*Ft,Jr=[-ct,-ct,ct,ct],Kr=[-180,-85,180,85],zt=Ft*Math.log(Math.tan(Math.PI/2));let ut=class extends Fi{constructor(t){super({code:t,units:"m",extent:Jr,global:!0,worldExtent:Kr,getPointResolution:function(e,n){return e/Math.cosh(n[1]/Ft)}})}};const Ai=[new ut("EPSG:3857"),new ut("EPSG:102100"),new ut("EPSG:102113"),new ut("EPSG:900913"),new ut("http://www.opengis.net/def/crs/EPSG/0/3857"),new ut("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Zr(i,t,e,n){const r=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let s=0;s<r;s+=n){t[s]=ct*i[s]/180;let o=Ft*Math.log(Math.tan(Math.PI*(+i[s+1]+90)/360));o>zt?o=zt:o<-zt&&(o=-zt),t[s+1]=o}return t}function jr(i,t,e,n){const r=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let s=0;s<r;s+=n)t[s]=180*i[s]/ct,t[s+1]=360*Math.atan(Math.exp(i[s+1]/Ft))/Math.PI-90;return t}const Qr=6378137,Oi=[-180,-90,180,90],ts=Math.PI*Qr/180;let nt=class extends Fi{constructor(t,e){super({code:t,units:"degrees",extent:Oi,axisOrientation:e,global:!0,metersPerUnit:ts,worldExtent:Oi})}};const Li=[new nt("CRS:84"),new nt("EPSG:4326","neu"),new nt("urn:ogc:def:crs:OGC:1.3:CRS84"),new nt("urn:ogc:def:crs:OGC:2:84"),new nt("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new nt("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new nt("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let we={};function es(i){return we[i]||we[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function is(i,t){we[i]=t}let ft={};function Ut(i,t,e){const n=i.getCode(),r=t.getCode();n in ft||(ft[n]={}),ft[n][r]=e}function ns(i,t){let e;return i in ft&&t in ft[i]&&(e=ft[i][t]),e}function Xt(i,t,e){return Math.min(Math.max(i,t),e)}function rs(i,t,e,n,r,s){const o=r-e,a=s-n;if(o!==0||a!==0){const c=((i-e)*o+(t-n)*a)/(o*o+a*a);c>1?(e=r,n=s):c>0&&(e+=o*c,n+=a*c)}return dt(i,t,e,n)}function dt(i,t,e,n){const r=e-i,s=n-t;return r*r+s*s}function xe(i,t,e){return i+e*(t-i)}function ss(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function ki(i,t){if(t!==void 0){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];t=t}else t=i.slice();return t}function os(i,t){if(t!==void 0&&i!==t){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];i=t}return i}function as(i){is(i.getCode(),i),Ut(i,i,ki)}function ls(i){i.forEach(as)}function Se(i){return typeof i=="string"?es(i):i||null}function bi(i){ls(i),i.forEach(function(t){i.forEach(function(e){t!==e&&Ut(t,e,ki)})})}function hs(i,t,e,n){i.forEach(function(r){t.forEach(function(s){Ut(r,s,e),Ut(s,r,n)})})}function cs(i,t){const e=i.getCode(),n=t.getCode();let r=ns(e,n);return r||(r=os),r}function Ri(i,t){const e=Se(i),n=Se(t);return cs(e,n)}function us(){bi(Ai),bi(Li),hs(Li,Ai,Zr,jr)}us();function At(i,t,e,n,r,s,o){s=s||[],o=o||2;let a=0;for(let c=t;c<e;c+=n){const u=i[c],d=i[c+1];s[a++]=r[0]*u+r[2]*d+r[4],s[a++]=r[1]*u+r[3]*d+r[5];for(let _=2;_<o;_++)s[a++]=i[c+_]}return s&&s.length!=a&&(s.length=a),s}function fs(i,t,e,n,r,s,o){o=o||[];const a=Math.cos(r),c=Math.sin(r),u=s[0],d=s[1];let _=0;for(let g=t;g<e;g+=n){const p=i[g]-u,x=i[g+1]-d;o[_++]=u+p*a-x*c,o[_++]=d+p*c+x*a;for(let C=g+2;C<g+n;++C)o[_++]=i[C]}return o&&o.length!=_&&(o.length=_),o}function ds(i,t,e,n,r,s,o,a){a=a||[];const c=o[0],u=o[1];let d=0;for(let _=t;_<e;_+=n){const g=i[_]-c,p=i[_+1]-u;a[d++]=c+r*g,a[d++]=u+s*p;for(let x=_+2;x<_+n;++x)a[d++]=i[x]}return a&&a.length!=d&&(a.length=d),a}function gs(i,t,e,n,r,s,o){o=o||[];let a=0;for(let c=t;c<e;c+=n){o[a++]=i[c]+r,o[a++]=i[c+1]+s;for(let u=c+2;u<c+n;++u)o[a++]=i[u]}return o&&o.length!=a&&(o.length=a),o}const Ti=ye();let ms=class extends pe{constructor(){super(),this.extent_=me(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Wr((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return H()}closestPointXY(t,e,n,r){return H()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return H()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&fi(e),this.extentRevision_=this.getRevision()}return Dr(this.extent_,t)}rotate(t,e){H()}scale(t,e,n){H()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return H()}getType(){return H()}applyTransform(t){H()}intersectsExtent(t){return H()}translate(t,e){H()}transform(t,e){const n=Se(t),r=n.getUnits()=="tile-pixels"?function(s,o,a){const c=n.getExtent(),u=n.getWorldExtent(),d=mi(u)/mi(c);return Ii(Ti,u[0],u[3],d,-d,0,0,0),At(s,0,s.length,a,Ti,o),Ri(n,e)(s,o,a)}:Ri(n,e);return this.applyTransform(r),this}},Yt=class extends ms{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Or(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return H()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Mi(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){H()}setLayout(t,e,n){let r;if(t)r=Mi(t);else{for(let s=0;s<n;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=_s(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();fs(n,0,n.length,r,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=gi(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();ds(r,0,r.length,s,t,e,n,r),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();gs(n,0,n.length,r,t,e,n),this.changed()}}};function _s(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function Mi(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function ps(i,t,e){const n=i.getFlatCoordinates();if(!n)return null;const r=i.getStride();return At(n,0,n.length,r,t,e)}function ys(i,t,e,n){for(let r=0,s=e.length;r<s;++r)i[t++]=e[r];return t}function Ce(i,t,e,n){for(let r=0,s=e.length;r<s;++r){const o=e[r];for(let a=0;a<n;++a)i[t++]=o[a]}return t}function ws(i,t,e,n,r){r=r||[];let s=0;for(let o=0,a=e.length;o<a;++o){const c=Ce(i,t,e[o],n);r[s++]=c,t=c}return r.length=s,r}let ve=class vr extends Yt{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new vr(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){const s=this.flatCoordinates,o=dt(t,e,s[0],s[1]);if(o<r){const a=this.stride;for(let c=0;c<a;++c)n[c]=s[c];return n.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return Ar(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Fr(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ys(this.flatCoordinates,0,t,this.stride),this.changed()}};function Pi(i,t,e,n,r,s,o){const a=i[t],c=i[t+1],u=i[e]-a,d=i[e+1]-c;let _;if(u===0&&d===0)_=t;else{const g=((r-a)*u+(s-c)*d)/(u*u+d*d);if(g>1)_=e;else if(g>0){for(let p=0;p<n;++p)o[p]=xe(i[t+p],i[e+p],g);o.length=n;return}else _=t}for(let g=0;g<n;++g)o[g]=i[_+g];o.length=n}function Ee(i,t,e,n,r){let s=i[t],o=i[t+1];for(t+=n;t<e;t+=n){const a=i[t],c=i[t+1],u=dt(s,o,a,c);u>r&&(r=u),s=a,o=c}return r}function xs(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s){const a=e[s];r=Ee(i,t,a,n,r),t=a}return r}function Ie(i,t,e,n,r,s,o,a,c,u,d){if(t==e)return u;let _,g;if(r===0){if(g=dt(o,a,i[t],i[t+1]),g<u){for(_=0;_<n;++_)c[_]=i[t+_];return c.length=n,g}return u}d=d||[NaN,NaN];let p=t+n;for(;p<e;)if(Pi(i,p-n,p,n,o,a,d),g=dt(o,a,d[0],d[1]),g<u){for(u=g,_=0;_<n;++_)c[_]=d[_];c.length=n,p+=n}else p+=n*Math.max((Math.sqrt(g)-Math.sqrt(u))/r|0,1);if(s&&(Pi(i,e-n,t,n,o,a,d),g=dt(o,a,d[0],d[1]),g<u)){for(u=g,_=0;_<n;++_)c[_]=d[_];c.length=n}return u}function Ss(i,t,e,n,r,s,o,a,c,u,d){d=d||[NaN,NaN];for(let _=0,g=e.length;_<g;++_){const p=e[_];u=Ie(i,t,p,n,r,s,o,a,c,u,d),t=p}return u}function Di(i,t,e,n,r,s,o){const a=(e-t)/n;if(a<3){for(;t<e;t+=n)s[o++]=i[t],s[o++]=i[t+1];return o}const c=new Array(a);c[0]=1,c[a-1]=1;const u=[t,e-n];let d=0;for(;u.length>0;){const _=u.pop(),g=u.pop();let p=0;const x=i[g],C=i[g+1],E=i[_],I=i[_+1];for(let F=g+n;F<_;F+=n){const O=i[F],B=i[F+1],G=rs(O,B,x,C,E,I);G>p&&(d=F,p=G)}p>r&&(c[(d-t)/n]=1,g+n<d&&u.push(g,d),d+n<_&&u.push(d,_))}for(let _=0;_<a;++_)c[_]&&(s[o++]=i[t+_*n],s[o++]=i[t+_*n+1]);return o}function gt(i,t){return t*Math.round(i/t)}function Cs(i,t,e,n,r,s,o){if(t==e)return o;let a=gt(i[t],r),c=gt(i[t+1],r);t+=n,s[o++]=a,s[o++]=c;let u,d;do if(u=gt(i[t],r),d=gt(i[t+1],r),t+=n,t==e)return s[o++]=u,s[o++]=d,o;while(u==a&&d==c);for(;t<e;){const _=gt(i[t],r),g=gt(i[t+1],r);if(t+=n,_==u&&g==d)continue;const p=u-a,x=d-c,C=_-a,E=g-c;if(p*E==x*C&&(p<0&&C<p||p==C||p>0&&C>p)&&(x<0&&E<x||x==E||x>0&&E>x)){u=_,d=g;continue}s[o++]=u,s[o++]=d,a=u,c=d,u=_,d=g}return s[o++]=u,s[o++]=d,o}function vs(i,t,e,n,r,s,o,a){for(let c=0,u=e.length;c<u;++c){const d=e[c];o=Cs(i,t,d,n,r,s,o),a.push(o),t=d}return o}function Fe(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let o=t;o<e;o+=n)r[s++]=i.slice(o,o+n);return r.length=s,r}function Es(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=e.length;o<a;++o){const c=e[o];r[s++]=Fe(i,t,c,n,r[s]),t=c}return r.length=s,r}function Bi(i,t,e,n){let r=0;const s=i[e-n],o=i[e-n+1];let a=0,c=0;for(;t<e;t+=n){const u=i[t]-s,d=i[t+1]-o;r+=c*u-a*d,a=u,c=d}return r/2}function Is(i,t,e,n){let r=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];r+=Bi(i,t,a,n),t=a}return r}class Ot extends Yt{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new Ot(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,r){return r<ge(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ee(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ie(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,r))}getArea(){return Bi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Fe(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Di(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Ot(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ce(this.flatCoordinates,0,t,this.stride),this.changed()}}function Fs(i,t,e,n,r){return!br(r,function(o){return!rt(i,t,e,n,o[0],o[1])})}function rt(i,t,e,n,r,s){let o=0,a=i[e-n],c=i[e-n+1];for(;t<e;t+=n){const u=i[t],d=i[t+1];c<=s?d>s&&(u-a)*(s-c)-(r-a)*(d-c)>0&&o++:d<=s&&(u-a)*(s-c)-(r-a)*(d-c)<0&&o--,a=u,c=d}return o!==0}function Ni(i,t,e,n,r,s){if(e.length===0||!rt(i,t,e[0],n,r,s))return!1;for(let o=1,a=e.length;o<a;++o)if(rt(i,e[o-1],e[o],n,r,s))return!1;return!0}function As(i,t,e,n,r,s,o){let a,c,u,d,_,g,p;const x=r[s+1],C=[];for(let F=0,O=e.length;F<O;++F){const B=e[F];for(d=i[B-n],g=i[B-n+1],a=t;a<B;a+=n)_=i[a],p=i[a+1],(x<=g&&p<=x||g<=x&&x<=p)&&(u=(x-g)/(p-g)*(_-d)+d,C.push(u)),d=_,g=p}let E=NaN,I=-1/0;for(C.sort(pi),d=C[0],a=1,c=C.length;a<c;++a){_=C[a];const F=Math.abs(_-d);F>I&&(u=(d+_)/2,Ni(i,t,e,n,u,x)&&(E=u,I=F)),d=_}return isNaN(E)&&(E=r[s]),[E,x,I]}function Gi(i,t,e,n,r){let s;for(t+=n;t<e;t+=n)if(s=r(i.slice(t-n,t),i.slice(t,t+n)),s)return s;return!1}function Ae(i,t,e,n,r){const s=di(me(),i,t,e,n);return ht(r,s)?Ir(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:Gi(i,t,e,n,function(o,a){return Br(r,o,a)}):!1}function Os(i,t,e,n,r){return!!(Ae(i,t,e,n,r)||rt(i,t,e,n,r[0],r[1])||rt(i,t,e,n,r[0],r[3])||rt(i,t,e,n,r[2],r[1])||rt(i,t,e,n,r[2],r[3]))}function Ls(i,t,e,n,r){if(!Os(i,t,e[0],n,r))return!1;if(e.length===1)return!0;for(let s=1,o=e.length;s<o;++s)if(Fs(i,e[s-1],e[s],n,r)&&!Ae(i,e[s-1],e[s],n,r))return!1;return!0}function ks(i,t,e,n){for(;t<e-n;){for(let r=0;r<n;++r){const s=i[t+r];i[t+r]=i[e-n+r],i[e-n+r]=s}t+=n,e-=n}}function $i(i,t,e,n){let r=0,s=i[e-n],o=i[e-n+1];for(;t<e;t+=n){const a=i[t],c=i[t+1];r+=(a-s)*(c+o),s=a,o=c}return r===0?void 0:r>0}function bs(i,t,e,n,r){r=r!==void 0?r:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],c=$i(i,t,a,n);if(s===0){if(r&&c||!r&&!c)return!1}else if(r&&!c||!r&&c)return!1;t=a}return!0}function Wi(i,t,e,n,r){r=r!==void 0?r:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],c=$i(i,t,a,n);(s===0?r&&c||!r&&!c:r&&!c||!r&&c)&&ks(i,t,a,n),t=a}return t}class qt extends Yt{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?yi(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new qt(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<ge(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(xs(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ss(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,r))}containsXY(t,e){return Ni(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Is(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Wi(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Es(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=gi(this.getExtent());this.flatInteriorPoint_=As(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new ve(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Ot(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,r=[];let s=0;for(let o=0,a=n.length;o<a;++o){const c=n[o],u=new Ot(e.slice(s,c),t);r.push(u),s=c}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;bs(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Wi(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=vs(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new qt(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return Ls(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=ws(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function Rs(i,t,e,n,r,s,o){let a,c;const u=(e-t)/n;if(u===1)a=t;else if(u===2)a=t,c=r;else if(u!==0){let d=i[t],_=i[t+1],g=0;const p=[0];for(let E=t+n;E<e;E+=n){const I=i[E],F=i[E+1];g+=Math.sqrt((I-d)*(I-d)+(F-_)*(F-_)),p.push(g),d=I,_=F}const x=r*g,C=$r(p,x);C<0?(c=(x-p[-C-2])/(p[-C-1]-p[-C-2]),a=t+(-C-2)*n):a=t+C*n}o=o>1?o:2,s=s||new Array(o);for(let d=0;d<o;++d)s[d]=a===void 0?NaN:c===void 0?i[a+d]:xe(i[a+d],i[a+n+d],c);return s}function Ts(i,t,e,n,r,s){if(e==t)return null;let o;if(r<i[t+n-1])return s?(o=i.slice(t,t+n),o[n-1]=r,o):null;if(i[e-1]<r)return s?(o=i.slice(e-n,e),o[n-1]=r,o):null;if(r==i[t+n-1])return i.slice(t,t+n);let a=t/n,c=e/n;for(;a<c;){const g=a+c>>1;r<i[(g+1)*n-1]?c=g:a=g+1}const u=i[a*n-1];if(r==u)return i.slice((a-1)*n,(a-1)*n+n);const d=i[(a+1)*n-1],_=(r-u)/(d-u);o=[];for(let g=0;g<n-1;++g)o.push(xe(i[(a-1)*n+g],i[a*n+g],_));return o.push(r),o}function Ms(i,t,e,n){let r=i[t],s=i[t+1],o=0;for(let a=t+n;a<e;a+=n){const c=i[a],u=i[a+1];o+=Math.sqrt((c-r)*(c-r)+(u-s)*(u-s)),r=c,s=u}return o}class Ht extends Yt{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){yi(this.flatCoordinates,t),this.changed()}clone(){const t=new Ht(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<ge(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ee(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ie(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,r))}forEachSegment(t){return Gi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Ts(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Fe(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return Rs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return Ms(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Di(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Ht(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Ae(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ce(this.flatCoordinates,0,t,this.stride),this.changed()}}let Ps=class{drawCustom(t,e,n,r,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,n){}drawFeature(t,e,n){}drawGeometryCollection(t,e,n){}drawLineString(t,e,n){}drawMultiLineString(t,e,n){}drawMultiPoint(t,e,n){}drawMultiPolygon(t,e,n){}drawPoint(t,e,n){}drawPolygon(t,e,n){}drawText(t,e,n){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}};var z={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};const j=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";j.includes("firefox"),j.includes("safari")&&!j.includes("chrom")&&(j.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(j)),j.includes("webkit")&&j.includes("edge"),j.includes("macintosh");const Ds=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Bs=typeof Image<"u"&&Image.prototype.decode;(function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i})();function Lt(i,t,e,n){let r;return Ds?r=new OffscreenCanvas(i||300,t||300):r=document.createElement("canvas"),i&&(r.width=i),t&&(r.height=t),r.getContext("2d",n)}let Oe;function zi(){return Oe||(Oe=Lt(1,1)),Oe}var Vt={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},U={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};U.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}},U.max=U.whitepoint[2].D65,U.rgb=function(i,t){t=t||U.whitepoint[2].E;var e=i[0]/t[0],n=i[1]/t[1],r=i[2]/t[2],s,o,a;return s=e*3.240969941904521+n*-1.537383177570093+r*-.498610760293,o=e*-.96924363628087+n*1.87596750150772+r*.041555057407175,a=e*.055630079696993+n*-.20397695888897+r*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,.4166666666666667)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,.4166666666666667)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,.4166666666666667)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]},Vt.xyz=function(i,t){var e=i[0]/255,n=i[1]/255,r=i[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=e*.41239079926595+n*.35758433938387+r*.18048078840183,o=e*.21263900587151+n*.71516867876775+r*.072192315360733,a=e*.019330818715591+n*.11919477979462+r*.95053215224966;return t=t||U.whitepoint[2].E,[s*t[0],o*t[1],a*t[2]]};var Ui={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,t,e){var n,r,s,o,a,c,u,d,_,g,p,x,C;if(s=i[0],o=i[1],a=i[2],s===0)return[0,0,0];var E=.0011070564598794539;return t=t||"D65",e=e||2,_=U.whitepoint[e][t][0],g=U.whitepoint[e][t][1],p=U.whitepoint[e][t][2],x=4*_/(_+15*g+3*p),C=9*g/(_+15*g+3*p),n=o/(13*s)+x||0,r=a/(13*s)+C||0,u=s>8?g*Math.pow((s+16)/116,3):g*s*E,c=u*9*n/(4*r)||0,d=u*(12-3*n-20*r)/(4*r)||0,[c,u,d]}};U.luv=function(i,t,e){var n,r,s,o,a,c,u,d,_,g,p,x,C,E=.008856451679035631,I=903.2962962962961;t=t||"D65",e=e||2,_=U.whitepoint[e][t][0],g=U.whitepoint[e][t][1],p=U.whitepoint[e][t][2],x=4*_/(_+15*g+3*p),C=9*g/(_+15*g+3*p),c=i[0],u=i[1],d=i[2],n=4*c/(c+15*u+3*d)||0,r=9*u/(c+15*u+3*d)||0;var F=u/g;return s=F<=E?I*F:116*Math.pow(F,.3333333333333333)-16,o=13*s*(n-x),a=13*s*(r-C),[s,o,a]},Ui.lchuv=function(i){var t=i[0],e=i[1],n=i[2],r=Math.sqrt(e*e+n*n),s=Math.atan2(n,e),o=s*360/2/Math.PI;return o<0&&(o+=360),[t,r,o]},U.lchuv=function(i){return Ui.lchuv(U.luv(i))};var Xi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Yi={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Ns(i){var d,_;var t,e=[],n=1,r;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),Xi[i])e=Xi[i].slice(),r="rgb";else if(i==="transparent")n=0,r="rgb",e=[0,0,0];else if(i[0]==="#"){var s=i.slice(1),o=s.length,a=o<=4;n=1,a?(e=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],o===4&&(n=parseInt(s[3]+s[3],16)/255)):(e=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],o===8&&(n=parseInt(s[6]+s[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),r="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var c=t[1];r=c.replace(/a$/,"");var u=r==="cmyk"?4:r==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=e.shift()),e=e.map(function(g,p){if(g[g.length-1]==="%")return g=parseFloat(g)/100,p===3?g:r==="rgb"?g*255:r[0]==="h"||r[0]==="l"&&!p?g*100:r==="lab"?g*125:r==="lch"?p<2?g*150:g*360:r[0]==="o"&&!p?g:r==="oklab"?g*.4:r==="oklch"?p<2?g*.4:g*360:g;if(r[p]==="h"||p===2&&r[r.length-1]==="h"){if(Yi[g]!==void 0)return Yi[g];if(g.endsWith("deg"))return parseFloat(g);if(g.endsWith("turn"))return parseFloat(g)*360;if(g.endsWith("grad"))return parseFloat(g)*360/400;if(g.endsWith("rad"))return parseFloat(g)*180/Math.PI}return g==="none"?0:parseFloat(g)}),n=e.length>u?e.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(e=i.match(/([0-9]+)/g).map(function(g){return parseFloat(g)}),r=((_=(d=i.match(/([a-z])/ig))==null?void 0:d.join(""))==null?void 0:_.toLowerCase())||"rgb");return{space:r,values:e,alpha:n}}var Le={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var t=i[0]/360,e=i[1]/100,n=i[2]/100,r,s,o,a,c,u=0;if(e===0)return c=n*255,[c,c,c];for(s=n<.5?n*(1+e):n+e-n*e,r=2*n-s,a=[0,0,0];u<3;)o=t+1/3*-(u-1),o<0?o++:o>1&&o--,c=6*o<1?r+(s-r)*6*o:2*o<1?s:3*o<2?r+(s-r)*(2/3-o)*6:r,a[u++]=c*255;return a}};Vt.hsl=function(i){var t=i[0]/255,e=i[1]/255,n=i[2]/255,r=Math.min(t,e,n),s=Math.max(t,e,n),o=s-r,a,c,u;return s===r?a=0:t===s?a=(e-n)/o:e===s?a=2+(n-t)/o:n===s&&(a=4+(t-e)/o),a=Math.min(a*60,360),a<0&&(a+=360),u=(r+s)/2,s===r?c=0:u<=.5?c=o/(s+r):c=o/(2-s-r),[a,c*100,u*100]};function Gs(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var t,e=Ns(i);if(!e.space)return[];const n=e.space[0]==="h"?Le.min:Vt.min,r=e.space[0]==="h"?Le.max:Vt.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],n[0]),r[0]),t[1]=Math.min(Math.max(e.values[1],n[1]),r[1]),t[2]=Math.min(Math.max(e.values[2],n[2]),r[2]),e.space[0]==="h"&&(t=Le.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}const $s=[NaN,NaN,NaN,0];function Ws(i){return typeof i=="string"?i:qi(i)}const zs=1024,kt={};let ke=0;function Us(i){if(i==="none")return $s;if(kt.hasOwnProperty(i))return kt[i];if(ke>=zs){let e=0;for(const n in kt)e++&3||(delete kt[n],--ke)}const t=Gs(i);if(t.length!==4)throw new Error('failed to parse "'+i+'" as color');for(const e of t)if(isNaN(e))throw new Error('failed to parse "'+i+'" as color');return Ys(t),kt[i]=t,++ke,t}function Xs(i){return Array.isArray(i)?i:Us(i)}function Ys(i){return i[0]=Xt(i[0]+.5|0,0,255),i[1]=Xt(i[1]+.5|0,0,255),i[2]=Xt(i[2]+.5|0,0,255),i[3]=Xt(i[3],0,1),i}function qi(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const r=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+r+")"}function qs(i,t){return new Promise((e,n)=>{function r(){o(),e(i)}function s(){o(),n(new Error("Image load error"))}function o(){i.removeEventListener("load",r),i.removeEventListener("error",s)}i.addEventListener("load",r),i.addEventListener("error",s)})}function Hs(i,t){return t&&(i.src=t),i.src&&Bs?new Promise((e,n)=>i.decode().then(()=>e(i)).catch(r=>i.complete&&i.width?e(i):n(r))):qs(i)}let Vs=class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];!(t++&3)&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,n){const r=be(t,e,n);return r in this.cache_?this.cache_[r]:null}getPattern(t,e,n){const r=be(t,e,n);return r in this.patternCache_?this.patternCache_[r]:null}set(t,e,n,r,s){const o=be(t,e,n),a=o in this.cache_;this.cache_[o]=r,s&&(r.getImageState()===z.IDLE&&r.load(),r.getImageState()===z.LOADING?r.ready().then(()=>{this.patternCache_[o]=zi().createPattern(r.getImage(1),"repeat")}):this.patternCache_[o]=zi().createPattern(r.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};function be(i,t,e){const n=e?Xs(e):"null";return t+":"+i+":"+n}const Q=new Vs;let bt=null,Js=class extends Ci{constructor(t,e,n,r,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=s,this.imageState_=r===void 0?z.IDLE:r,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===z.LOADED){bt||(bt=Lt(1,1,void 0,{willReadFrequently:!0})),bt.drawImage(this.image_,0,0);try{bt.getImageData(0,0,1,1),this.tainted_=!1}catch{bt=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(It.CHANGE)}handleImageError_(){this.imageState_=z.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=z.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=Lt(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===z.IDLE){this.image_||this.initializeImage_(),this.imageState_=z.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Hs(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==z.LOADED)return;const e=this.image_,n=Lt(Math.ceil(e.width*t),Math.ceil(e.height*t)),r=n.canvas;n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=Ws(this.color_),n.fillRect(0,0,r.width/t,r.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=r}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===z.LOADED||this.imageState_===z.ERROR)t();else{const e=()=>{(this.imageState_===z.LOADED||this.imageState_===z.ERROR)&&(this.removeEventListener(It.CHANGE,e),t())};this.addEventListener(It.CHANGE,e)}})),this.ready_}};function Ks(i,t,e,n,r,s){let o=t===void 0?void 0:Q.get(t,e,r);return o||(o=new Js(i,i&&"src"in i?i.src||void 0:t,e,n,r),Q.set(t,e,r,o,s)),o&&!Q.getPattern(t,e,r)&&Q.set(t,e,r,o,s),o}function Jt(i){return i?Array.isArray(i)?qi(i):typeof i=="object"&&"src"in i?Zs(i):i:null}function Zs(i){if(!i.offset||!i.size)return Q.getPattern(i.src,"anonymous",i.color);const t=i.src+":"+i.offset,e=Q.getPattern(t,void 0,i.color);if(e)return e;const n=Q.get(i.src,"anonymous",null);if(n.getImageState()!==z.LOADED)return null;const r=Lt(i.size[0],i.size[1]);return r.drawImage(n.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),Ks(r.canvas,t,void 0,z.LOADED,i.color,!0),Q.getPattern(t,void 0,i.color)}const js="10px sans-serif",Hi="#000",Vi="round",Ji=[],Ki=0,Zi="round",ji=10,Qi="#000",tn="center",Qs="middle",en=1;new pe;let to=class extends Ps{constructor(t,e,n,r,s,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=r,this.transformRotation_=r?ss(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=ye()}drawImages_(t,e,n,r){if(!this.image_)return;const s=At(t,e,n,r,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,c=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=c*this.imageOpacity_);let u=this.imageRotation_;this.transformRotation_===0&&(u-=this.viewRotation_),this.imageRotateWithView_&&(u+=this.viewRotation_);for(let d=0,_=s.length;d<_;d+=2){const g=s[d]-this.imageAnchorX_,p=s[d+1]-this.imageAnchorY_;if(u!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const x=g+this.imageAnchorX_,C=p+this.imageAnchorY_;Ii(a,x,C,1,1,u,-x,-C),o.save(),o.transform.apply(o,a),o.translate(x,C),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,g,p,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=c)}drawText_(t,e,n,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=At(t,e,n,r,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<n;e+=r){const c=s[e]+this.textOffsetX_,u=s[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(c-this.textOffsetX_,u-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,c,u),this.textFillState_&&o.fillText(this.text_,c,u))}}moveToLineTo_(t,e,n,r,s){const o=this.context_,a=At(t,e,n,r,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let c=a.length;s&&(c-=2);for(let u=2;u<c;u+=2)o.lineTo(a[u],a[u+1]);return s&&o.closePath(),n}drawRings_(t,e,n,r){for(let s=0,o=n.length;s<o;++s)e=this.moveToLineTo_(t,e,n[s],r,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ht(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=ps(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],r=e[3]-e[1],s=Math.sqrt(n*n+r*r),o=this.context_;o.beginPath(),o.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const n=e.getGeometryFunction()(t);n&&(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,r=e.length;n<r;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ht(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(ht(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,r=t.getFlatCoordinates();let s=0;const o=t.getEnds(),a=t.getStride();n.beginPath();for(let c=0,u=o.length;c<u;++c)s=this.moveToLineTo_(r,s,o[c],a,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ht(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ht(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let r=0;const s=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,c=s.length;a<c;++a){const u=s[a];r=this.drawRings_(n,r,u,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),wi(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,r=t.textAlign?t.textAlign:tn;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=r&&(n.textAlign=r,e.textAlign=r),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:Jt(n||Hi)}}if(!e)this.strokeState_=null;else{const n=e.getColor(),r=e.getLineCap(),s=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),c=e.getWidth(),u=e.getMiterLimit(),d=s||Ji;this.strokeState_={lineCap:r!==void 0?r:Vi,lineDash:this.pixelRatio_===1?d:d.map(_=>_*this.pixelRatio_),lineDashOffset:(o||Ki)*this.pixelRatio_,lineJoin:a!==void 0?a:Zi,lineWidth:(c!==void 0?c:en)*this.pixelRatio_,miterLimit:u!==void 0?u:ji,strokeStyle:Jt(n||Qi)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),r=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*n,this.imageAnchorY_=r[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const p=e.getColor();this.textFillState_={fillStyle:Jt(p||Hi)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const p=n.getColor(),x=n.getLineCap(),C=n.getLineDash(),E=n.getLineDashOffset(),I=n.getLineJoin(),F=n.getWidth(),O=n.getMiterLimit();this.textStrokeState_={lineCap:x!==void 0?x:Vi,lineDash:C||Ji,lineDashOffset:E||Ki,lineJoin:I!==void 0?I:Zi,lineWidth:F!==void 0?F:en,miterLimit:O!==void 0?O:ji,strokeStyle:Jt(p||Qi)}}const r=t.getFont(),s=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),c=t.getRotation(),u=t.getScaleArray(),d=t.getText(),_=t.getTextAlign(),g=t.getTextBaseline();this.textState_={font:r!==void 0?r:js,textAlign:_!==void 0?_:tn,textBaseline:g!==void 0?g:Qs},this.text_=d!==void 0?Array.isArray(d)?d.reduce((p,x,C)=>p+=C%2?" ":x,""):d:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=c!==void 0?c:0,this.textScale_=[this.pixelRatio_*u[0],this.pixelRatio_*u[1]]}}};function Re(i){return i!=null&&typeof i.valueOf()=="string"}function Kt(i){return i!=null&&typeof i.valueOf()=="number"}function nn(i){return i!=null&&typeof i.valueOf()=="boolean"}const rn=i=>N(i)||eo(i),eo=i=>Re(i)||Kt(i)||nn(i)||i===null,io=i=>!!((i!=null&&i.min||i!=null&&i.max)&&(!i.min||Rt(i.min)||Kt(i.min))&&(!i.max||Rt(i.max)||Kt(i.min))),no=i=>["==","*=","!=","<","<=",">",">=","<=x<="].includes(i),ro=i=>["&&","||"].includes(i),so=i=>i==="!",Te=i=>oo(i)||ao(i)||mt(i)||lo(i)||mt(i)||nn(i),oo=i=>{const t=i&&i[0]==="<=x<="?4:3;return Array.isArray(i)&&i.length===t&&no(i[0])&&rn(i[1])&&rn(i[2])&&(i[0]!=="<=x<="||Kt(i[3]))},ao=i=>Array.isArray(i)&&i.length>=3&&ro(i[0])&&i.every((t,e)=>e===0||Te(t)),lo=i=>Array.isArray(i)&&i.length===2&&so(i[0])&&Te(i[1]),sn=i=>ho(i)||uo(i)||fo(i)||go(i),ho=i=>on(i)||an(i)||co(i),on=i=>(i==null?void 0:i.kind)==="Icon",co=i=>(i==null?void 0:i.kind)==="Text",an=i=>(i==null?void 0:i.kind)==="Mark"&&Re(i==null?void 0:i.wellKnownName),uo=i=>(i==null?void 0:i.kind)==="Line",fo=i=>(i==null?void 0:i.kind)==="Fill",go=i=>(i==null?void 0:i.kind)==="Raster",mo=i=>{var t;return!!(Re(i==null?void 0:i.name)&&(!(i!=null&&i.filter)||Te(i.filter))&&(!(i!=null&&i.scaleDenominator)||io(i.scaleDenominator))&&((t=i==null?void 0:i.symbolizers)!=null&&t.every(e=>sn(e))))},Rt=i=>["abs","acos","add","asin","atan","atan2","ceil","cos","div","exp","floor","interpolate","log","max","min","modulo","mul","pi","pow","random","rint","round","sin","sqrt","strIndexOf","strLastIndexOf","strLength","sub","tan","toDegrees","toNumber","toRadians"].includes(i==null?void 0:i.name),Tt=i=>["numberFormat","strAbbreviate","strCapitalize","strConcat","strDefaultIfBlank","strReplace","strStripAccents","strSubstring","strSubstringStart","strToLowerCase","strToString","strToUpperCase","strTrim"].includes(i==null?void 0:i.name),mt=i=>["all","any","between","double2bool","equalTo","greaterThan","greaterThanOrEqualTo","in","lessThan","lessThanOrEqualTo","not","notEqualTo","parseBoolean","strEndsWith","strEqualsIgnoreCase","strMatches","strStartsWith"].includes(i==null?void 0:i.name),ln=i=>["case","property","step"].includes(i==null?void 0:i.name),N=i=>mt(i)||Rt(i)||Tt(i)||ln(i),Me=i=>typeof(i==null?void 0:i.source)=="string"||N(i==null?void 0:i.source)&&Array.isArray(i.position)&&Array.isArray(i.size);function hn(i){return!/^(-?\d|--)/.test(i)}function cn(i){const t=[];let e="",n="",r=7;for(let s,o=0;s=i.charAt(o);o++)if(/[a-zA-Z\d\xa0-\uffff_-]/.test(s)&&r===7)e+=s;else if(s==="\\"&&r===7)r=6;else if(s===" "&&r===7){if(e!==""){if(!hn(e))return null;t.push(e),e=""}}else if(r===6)/[0-9a-f]/i.test(s)?(n+=s,r=8):(e+=s,r=7);else{if(r!==8)return null;/[0-9a-f]/i.test(s)&&n.length<6?n+=s:(e+=String.fromCodePoint(parseInt(n,16)),e+=s,n="",r=7)}if(e!==""){if(!hn(e))return null;t.push(e)}return t.join(" ")}function _o(i,t){let e=t,n="";const r={"font-family":[]};for(let s,o=0;s=i.charAt(o);o+=1)if(e!==4||s!=='"'&&s!=="'")if(e===3&&s===",")e=4,n="";else if(e===4&&s===","){const a=cn(n);a&&r["font-family"].push(a),n=""}else if(e===5&&s===" ")/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:deg|grad|rad|turn)$/.test(n)?(r["font-style"]+=" "+n,n=""):o-=1,e=1;else if(e!==1||s!==" "&&s!=="/")e===2&&s===" "?(/^(?:\+|-)?([0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)?$/.test(n)&&(r["line-height"]=n),e=4,n=""):n+=s;else{if(/^(?:(?:xx|x)-large|(?:xx|s)-small|small|large|medium)$/.test(n)||/^(?:larg|small)er$/.test(n)||/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)$/.test(n))e=s==="/"?2:4,r["font-size"]=n;else if(/^italic$/.test(n))r["font-style"]=n;else if(/^oblique$/.test(n))r["font-style"]=n,e=5;else if(/^small-caps$/.test(n))r["font-variant"]=n;else if(/^(?:bold(?:er)?|lighter|normal)$/.test(n))r["font-weight"]=n;else if(/^[+-]?(?:[0-9]*\.)?[0-9]+(?:e[+-]?(?:0|[1-9][0-9]*))?$/.test(n)){const a=parseFloat(n);a>=1&&a<=1e3&&(r["font-weight"]=n)}else/^(?:(?:ultra|extra|semi)-)?(?:condensed|expanded)$/.test(n)&&(r["font-stretch"]=n);n=""}else{let a=o+1;do if(a=i.indexOf(s,a)+1,!a)return null;while(i.charAt(a-2)==="\\");r["font-family"].push(i.slice(o+1,a-1).replace(/\\('|")/g,"$1")),o=a-1,e=3,n=""}if(e===3&&!/^\s*$/.test(n))return null;if(e===4){const s=cn(n);s&&r["font-family"].push(s)}return r}function po(i){const t=_o(i,1);return t!==null&&t["font-size"]&&t["font-family"].length?t:null}var L={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class un{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}var yo={PROPERTYCHANGE:"propertychange"};class wo{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function fn(i,t){const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}function dn(){}function xo(i){let t,e,n;return function(){const r=Array.prototype.slice.call(arguments);return(!e||this!==n||!fn(r,e))&&(n=this,e=r,t=i.apply(this,arguments)),t}}function gn(i){for(const t in i)delete i[t]}function So(i){let t;for(t in i)return!1;return!t}class mn extends wo{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),r=n[t]||(n[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,r=this.listeners_&&this.listeners_[n];if(!r)return;const s=e?new un(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let c;for(let u=0,d=r.length;u<d;++u)if("handleEvent"in r[u]?c=r[u].handleEvent(s):c=r[u].call(this,s),c===!1||s.propagationStopped){c=!1;break}if(--o[n]===0){let u=a[n];for(delete a[n];u--;)this.removeEventListener(n,dn);delete o[n]}return c}disposeInternal(){this.listeners_&&gn(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const r=n.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[r]=dn,++this.pendingRemovals_[t]):(n.splice(r,1),n.length===0&&delete this.listeners_[t]))}}var st={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function Zt(i,t,e,n,r){if(r){const o=e;e=function(){i.removeEventListener(t,e),o.apply(n??this,arguments)}}else n&&n!==i&&(e=e.bind(n));const s={target:i,type:t,listener:e};return i.addEventListener(t,e),s}function _n(i,t,e,n){return Zt(i,t,e,n,!0)}function Pe(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),gn(i))}class Co extends mn{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(st.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=Zt(this,t[s],e);return r}return Zt(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const r=t.length;n=new Array(r);for(let s=0;s<r;++s)n[s]=_n(this,t[s],e)}else n=_n(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)vo(n);else if(Array.isArray(t))for(let r=0,s=t.length;r<s;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}}function vo(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)Pe(i[t]);else Pe(i)}function M(){throw new Error("Unimplemented abstract method.")}let Eo=0;function pn(i){return i.ol_uid||(i.ol_uid=String(++Eo))}class yn extends un{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class De extends Co{constructor(t){super(),this.on,this.once,this.un,pn(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new yn(n,t,e)),n=yo.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new yn(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const r=this.values_||(this.values_={});if(n)r[t]=e;else{const s=r[t];r[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],So(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}function jt(i,t){if(!i)throw new Error(t)}const Io=new Array(6);function Be(){return[1,0,0,1,0,0]}function Fo(i,t){const e=i[0],n=i[1],r=i[2],s=i[3],o=i[4],a=i[5],c=t[0],u=t[1],d=t[2],_=t[3],g=t[4],p=t[5];return i[0]=e*c+r*u,i[1]=n*c+s*u,i[2]=e*d+r*_,i[3]=n*d+s*_,i[4]=e*g+r*p+o,i[5]=n*g+s*p+a,i}function Ao(i,t,e,n,r,s,o){return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i[4]=s,i[5]=o,i}function Oo(i,t,e){return Fo(i,Ao(Io,t,0,0,e,0,0))}function wn(i,t,e,n,r,s,o,a){const c=Math.sin(s),u=Math.cos(s);return i[0]=n*u,i[1]=r*c,i[2]=-n*c,i[3]=r*u,i[4]=o*n*u-a*n*c+t,i[5]=o*r*c+a*r*u+e,i}function Lo(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function ko(){return[1/0,1/0,-1/0,-1/0]}function xn(i,t,e,n,r){return r?(r[0]=i,r[1]=t,r[2]=e,r[3]=n,r):[i,t,e,n]}function Sn(i){return xn(1/0,1/0,-1/0,-1/0,i)}function bo(i,t){const e=i[0],n=i[1];return xn(e,n,e,n,t)}function Ro(i,t,e,n,r){const s=Sn(r);return To(s,i,t,e,n)}function To(i,t,e,n,r){for(;e<n;e+=r)Mo(i,t[e],t[e+1]);return i}function Mo(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function Po(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function Cn(i){return i[3]-i[1]}function Mt(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function Do(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}const vn={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class En{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||vn[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Pt=6378137,_t=Math.PI*Pt,Bo=[-_t,-_t,_t,_t],No=[-180,-85,180,85],Qt=Pt*Math.log(Math.tan(Math.PI/2));class pt extends En{constructor(t){super({code:t,units:"m",extent:Bo,global:!0,worldExtent:No,getPointResolution:function(e,n){return e/Math.cosh(n[1]/Pt)}})}}const In=[new pt("EPSG:3857"),new pt("EPSG:102100"),new pt("EPSG:102113"),new pt("EPSG:900913"),new pt("http://www.opengis.net/def/crs/EPSG/0/3857"),new pt("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Go(i,t,e,n){const r=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let s=0;s<r;s+=n){t[s]=_t*i[s]/180;let o=Pt*Math.log(Math.tan(Math.PI*(+i[s+1]+90)/360));o>Qt?o=Qt:o<-Qt&&(o=-Qt),t[s+1]=o}return t}function $o(i,t,e,n){const r=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let s=0;s<r;s+=n)t[s]=180*i[s]/_t,t[s+1]=360*Math.atan(Math.exp(i[s+1]/Pt))/Math.PI-90;return t}const Wo=6378137,Fn=[-180,-90,180,90],zo=Math.PI*Wo/180;class ot extends En{constructor(t,e){super({code:t,units:"degrees",extent:Fn,axisOrientation:e,global:!0,metersPerUnit:zo,worldExtent:Fn})}}const An=[new ot("CRS:84"),new ot("EPSG:4326","neu"),new ot("urn:ogc:def:crs:OGC:1.3:CRS84"),new ot("urn:ogc:def:crs:OGC:2:84"),new ot("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new ot("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ot("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ne={};function Uo(i){return Ne[i]||Ne[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Xo(i,t){Ne[i]=t}let yt={};function te(i,t,e){const n=i.getCode(),r=t.getCode();n in yt||(yt[n]={}),yt[n][r]=e}function Yo(i,t){let e;return i in yt&&t in yt[i]&&(e=yt[i][t]),e}function ee(i,t,e){return Math.min(Math.max(i,t),e)}function qo(i,t,e,n){const r=e-i,s=n-t;return r*r+s*s}function Ho(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function On(i,t){if(t!==void 0){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];t=t}else t=i.slice();return t}function Vo(i,t){if(t!==void 0&&i!==t){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];i=t}return i}function Jo(i){Xo(i.getCode(),i),te(i,i,On)}function Ko(i){i.forEach(Jo)}function Ge(i){return typeof i=="string"?Uo(i):i||null}function Ln(i){Ko(i),i.forEach(function(t){i.forEach(function(e){t!==e&&te(t,e,On)})})}function Zo(i,t,e,n){i.forEach(function(r){t.forEach(function(s){te(r,s,e),te(s,r,n)})})}function jo(i,t){const e=i.getCode(),n=t.getCode();let r=Yo(e,n);return r||(r=Vo),r}function kn(i,t){const e=Ge(i),n=Ge(t);return jo(e,n)}function Qo(){Ln(In),Ln(An),Zo(An,In,Go,$o)}Qo();function Dt(i,t,e,n,r,s,o){s=s||[],o=o||2;let a=0;for(let c=t;c<e;c+=n){const u=i[c],d=i[c+1];s[a++]=r[0]*u+r[2]*d+r[4],s[a++]=r[1]*u+r[3]*d+r[5];for(let _=2;_<o;_++)s[a++]=i[c+_]}return s&&s.length!=a&&(s.length=a),s}function ta(i,t,e,n,r,s,o){o=o||[];const a=Math.cos(r),c=Math.sin(r),u=s[0],d=s[1];let _=0;for(let g=t;g<e;g+=n){const p=i[g]-u,x=i[g+1]-d;o[_++]=u+p*a-x*c,o[_++]=d+p*c+x*a;for(let C=g+2;C<g+n;++C)o[_++]=i[C]}return o&&o.length!=_&&(o.length=_),o}function ea(i,t,e,n,r,s,o,a){a=a||[];const c=o[0],u=o[1];let d=0;for(let _=t;_<e;_+=n){const g=i[_]-c,p=i[_+1]-u;a[d++]=c+r*g,a[d++]=u+s*p;for(let x=_+2;x<_+n;++x)a[d++]=i[x]}return a&&a.length!=d&&(a.length=d),a}function ia(i,t,e,n,r,s,o){o=o||[];let a=0;for(let c=t;c<e;c+=n){o[a++]=i[c]+r,o[a++]=i[c+1]+s;for(let u=c+2;u<c+n;++u)o[a++]=i[u]}return o&&o.length!=a&&(o.length=a),o}const bn=Be();class na extends De{constructor(){super(),this.extent_=ko(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=xo((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return M()}closestPointXY(t,e,n,r){return M()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return M()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Sn(e),this.extentRevision_=this.getRevision()}return Do(this.extent_,t)}rotate(t,e){M()}scale(t,e,n){M()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return M()}getType(){return M()}applyTransform(t){M()}intersectsExtent(t){return M()}translate(t,e){M()}transform(t,e){const n=Ge(t),r=n.getUnits()=="tile-pixels"?function(s,o,a){const c=n.getExtent(),u=n.getWorldExtent(),d=Cn(u)/Cn(c);return wn(bn,u[0],u[3],d,-d,0,0,0),Dt(s,0,s.length,a,bn,o),kn(n,e)(s,o,a)}:kn(n,e);return this.applyTransform(r),this}}class ra extends na{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Ro(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return M()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Rn(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){M()}setLayout(t,e,n){let r;if(t)r=Rn(t);else{for(let s=0;s<n;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=sa(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();ta(n,0,n.length,r,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=Po(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();ea(r,0,r.length,s,t,e,n,r),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();ia(n,0,n.length,r,t,e,n),this.changed()}}}function sa(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function Rn(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function oa(i,t,e){const n=i.getFlatCoordinates();if(!n)return null;const r=i.getStride();return Dt(n,0,n.length,r,t,e)}function aa(i,t,e,n){for(let r=0,s=e.length;r<s;++r)i[t++]=e[r];return t}class $e extends ra{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new $e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){const s=this.flatCoordinates,o=qo(t,e,s[0],s[1]);if(o<r){const a=this.stride;for(let c=0;c<a;++c)n[c]=s[c];return n.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return bo(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Lo(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=aa(this.flatCoordinates,0,t,this.stride),this.changed()}}function ie(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}class Bt{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=ie(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Bt({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return M()}getImage(t){return M()}getHitDetectionImage(){return M()}getPixelRatio(t){return 1}getImageState(){return M()}getImageSize(){return M()}getOrigin(){return M()}getSize(){return M()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ie(t)}listenImageChange(t){M()}load(){M()}unlistenImageChange(t){M()}ready(){return Promise.resolve()}}var ne={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},X={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};X.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}},X.max=X.whitepoint[2].D65,X.rgb=function(i,t){t=t||X.whitepoint[2].E;var e=i[0]/t[0],n=i[1]/t[1],r=i[2]/t[2],s,o,a;return s=e*3.240969941904521+n*-1.537383177570093+r*-.498610760293,o=e*-.96924363628087+n*1.87596750150772+r*.041555057407175,a=e*.055630079696993+n*-.20397695888897+r*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,.4166666666666667)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,.4166666666666667)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,.4166666666666667)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]},ne.xyz=function(i,t){var e=i[0]/255,n=i[1]/255,r=i[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=e*.41239079926595+n*.35758433938387+r*.18048078840183,o=e*.21263900587151+n*.71516867876775+r*.072192315360733,a=e*.019330818715591+n*.11919477979462+r*.95053215224966;return t=t||X.whitepoint[2].E,[s*t[0],o*t[1],a*t[2]]};var Tn={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,t,e){var n,r,s,o,a,c,u,d,_,g,p,x,C;if(s=i[0],o=i[1],a=i[2],s===0)return[0,0,0];var E=.0011070564598794539;return t=t||"D65",e=e||2,_=X.whitepoint[e][t][0],g=X.whitepoint[e][t][1],p=X.whitepoint[e][t][2],x=4*_/(_+15*g+3*p),C=9*g/(_+15*g+3*p),n=o/(13*s)+x||0,r=a/(13*s)+C||0,u=s>8?g*Math.pow((s+16)/116,3):g*s*E,c=u*9*n/(4*r)||0,d=u*(12-3*n-20*r)/(4*r)||0,[c,u,d]}};X.luv=function(i,t,e){var n,r,s,o,a,c,u,d,_,g,p,x,C,E=.008856451679035631,I=903.2962962962961;t=t||"D65",e=e||2,_=X.whitepoint[e][t][0],g=X.whitepoint[e][t][1],p=X.whitepoint[e][t][2],x=4*_/(_+15*g+3*p),C=9*g/(_+15*g+3*p),c=i[0],u=i[1],d=i[2],n=4*c/(c+15*u+3*d)||0,r=9*u/(c+15*u+3*d)||0;var F=u/g;return s=F<=E?I*F:116*Math.pow(F,.3333333333333333)-16,o=13*s*(n-x),a=13*s*(r-C),[s,o,a]},Tn.lchuv=function(i){var t=i[0],e=i[1],n=i[2],r=Math.sqrt(e*e+n*n),s=Math.atan2(n,e),o=s*360/2/Math.PI;return o<0&&(o+=360),[t,r,o]},X.lchuv=function(i){return Tn.lchuv(X.luv(i))};var Mn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Pn={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function la(i){var d,_;var t,e=[],n=1,r;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),Mn[i])e=Mn[i].slice(),r="rgb";else if(i==="transparent")n=0,r="rgb",e=[0,0,0];else if(i[0]==="#"){var s=i.slice(1),o=s.length,a=o<=4;n=1,a?(e=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],o===4&&(n=parseInt(s[3]+s[3],16)/255)):(e=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],o===8&&(n=parseInt(s[6]+s[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),r="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var c=t[1];r=c.replace(/a$/,"");var u=r==="cmyk"?4:r==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=e.shift()),e=e.map(function(g,p){if(g[g.length-1]==="%")return g=parseFloat(g)/100,p===3?g:r==="rgb"?g*255:r[0]==="h"||r[0]==="l"&&!p?g*100:r==="lab"?g*125:r==="lch"?p<2?g*150:g*360:r[0]==="o"&&!p?g:r==="oklab"?g*.4:r==="oklch"?p<2?g*.4:g*360:g;if(r[p]==="h"||p===2&&r[r.length-1]==="h"){if(Pn[g]!==void 0)return Pn[g];if(g.endsWith("deg"))return parseFloat(g);if(g.endsWith("turn"))return parseFloat(g)*360;if(g.endsWith("grad"))return parseFloat(g)*360/400;if(g.endsWith("rad"))return parseFloat(g)*180/Math.PI}return g==="none"?0:parseFloat(g)}),n=e.length>u?e.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(e=i.match(/([0-9]+)/g).map(function(g){return parseFloat(g)}),r=((_=(d=i.match(/([a-z])/ig))==null?void 0:d.join(""))==null?void 0:_.toLowerCase())||"rgb");return{space:r,values:e,alpha:n}}var We={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var t=i[0]/360,e=i[1]/100,n=i[2]/100,r,s,o,a,c,u=0;if(e===0)return c=n*255,[c,c,c];for(s=n<.5?n*(1+e):n+e-n*e,r=2*n-s,a=[0,0,0];u<3;)o=t+1/3*-(u-1),o<0?o++:o>1&&o--,c=6*o<1?r+(s-r)*6*o:2*o<1?s:3*o<2?r+(s-r)*(2/3-o)*6:r,a[u++]=c*255;return a}};ne.hsl=function(i){var t=i[0]/255,e=i[1]/255,n=i[2]/255,r=Math.min(t,e,n),s=Math.max(t,e,n),o=s-r,a,c,u;return s===r?a=0:t===s?a=(e-n)/o:e===s?a=2+(n-t)/o:n===s&&(a=4+(t-e)/o),a=Math.min(a*60,360),a<0&&(a+=360),u=(r+s)/2,s===r?c=0:u<=.5?c=o/(s+r):c=o/(2-s-r),[a,c*100,u*100]};function ha(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var t,e=la(i);if(!e.space)return[];const n=e.space[0]==="h"?We.min:ne.min,r=e.space[0]==="h"?We.max:ne.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],n[0]),r[0]),t[1]=Math.min(Math.max(e.values[1],n[1]),r[1]),t[2]=Math.min(Math.max(e.values[2],n[2]),r[2]),e.space[0]==="h"&&(t=We.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}const ca=[NaN,NaN,NaN,0];function ua(i){return typeof i=="string"?i:Dn(i)}const fa=1024,Nt={};let ze=0;function da(i){if(i==="none")return ca;if(Nt.hasOwnProperty(i))return Nt[i];if(ze>=fa){let e=0;for(const n in Nt)e++&3||(delete Nt[n],--ze)}const t=ha(i);if(t.length!==4)throw new Error('failed to parse "'+i+'" as color');for(const e of t)if(isNaN(e))throw new Error('failed to parse "'+i+'" as color');return ga(t),Nt[i]=t,++ze,t}function Ue(i){return Array.isArray(i)?i:da(i)}function ga(i){return i[0]=ee(i[0]+.5|0,0,255),i[1]=ee(i[1]+.5|0,0,255),i[2]=ee(i[2]+.5|0,0,255),i[3]=ee(i[3],0,1),i}function Dn(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const r=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+r+")"}const tt=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";tt.includes("firefox"),tt.includes("safari")&&!tt.includes("chrom")&&(tt.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(tt)),tt.includes("webkit")&&tt.includes("edge"),tt.includes("macintosh");const ma=typeof devicePixelRatio<"u"?devicePixelRatio:1,_a=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,pa=typeof Image<"u"&&Image.prototype.decode;(function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i})();function at(i,t,e,n){let r;return _a?r=new OffscreenCanvas(i||300,t||300):r=document.createElement("canvas"),i&&(r.width=i),t&&(r.height=t),r.getContext("2d",n)}let Xe;function Bn(){return Xe||(Xe=at(1,1)),Xe}function ya(i,t){return new Promise((e,n)=>{function r(){o(),e(i)}function s(){o(),n(new Error("Image load error"))}function o(){i.removeEventListener("load",r),i.removeEventListener("error",s)}i.addEventListener("load",r),i.addEventListener("error",s)})}function wa(i,t){return t&&(i.src=t),i.src&&pa?new Promise((e,n)=>i.decode().then(()=>e(i)).catch(r=>i.complete&&i.width?e(i):n(r))):ya(i)}class xa{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];!(t++&3)&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,n){const r=Ye(t,e,n);return r in this.cache_?this.cache_[r]:null}getPattern(t,e,n){const r=Ye(t,e,n);return r in this.patternCache_?this.patternCache_[r]:null}set(t,e,n,r,s){const o=Ye(t,e,n),a=o in this.cache_;this.cache_[o]=r,s&&(r.getImageState()===L.IDLE&&r.load(),r.getImageState()===L.LOADING?r.ready().then(()=>{this.patternCache_[o]=Bn().createPattern(r.getImage(1),"repeat")}):this.patternCache_[o]=Bn().createPattern(r.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Ye(i,t,e){const n=e?Ue(e):"null";return t+":"+i+":"+n}const et=new xa;let Gt=null;class Sa extends mn{constructor(t,e,n,r,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=s,this.imageState_=r===void 0?L.IDLE:r,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===L.LOADED){Gt||(Gt=at(1,1,void 0,{willReadFrequently:!0})),Gt.drawImage(this.image_,0,0);try{Gt.getImageData(0,0,1,1),this.tainted_=!1}catch{Gt=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(st.CHANGE)}handleImageError_(){this.imageState_=L.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=L.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=at(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===L.IDLE){this.image_||this.initializeImage_(),this.imageState_=L.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&wa(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==L.LOADED)return;const e=this.image_,n=at(Math.ceil(e.width*t),Math.ceil(e.height*t)),r=n.canvas;n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=ua(this.color_),n.fillRect(0,0,r.width/t,r.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=r}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===L.LOADED||this.imageState_===L.ERROR)t();else{const e=()=>{(this.imageState_===L.LOADED||this.imageState_===L.ERROR)&&(this.removeEventListener(st.CHANGE,e),t())};this.addEventListener(st.CHANGE,e)}})),this.ready_}}function qe(i,t,e,n,r,s){let o=t===void 0?void 0:et.get(t,e,r);return o||(o=new Sa(i,i&&"src"in i?i.src||void 0:t,e,n,r),et.set(t,e,r,o,s)),s&&o&&!et.getPattern(t,e,r)&&et.set(t,e,r,o,s),o}function wt(i){return i?Array.isArray(i)?Dn(i):typeof i=="object"&&"src"in i?Ca(i):i:null}function Ca(i){if(!i.offset||!i.size)return et.getPattern(i.src,"anonymous",i.color);const t=i.src+":"+i.offset,e=et.getPattern(t,void 0,i.color);if(e)return e;const n=et.get(i.src,"anonymous",null);if(n.getImageState()!==L.LOADED)return null;const r=at(i.size[0],i.size[1]);return r.drawImage(n.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),qe(r.canvas,t,void 0,L.LOADED,i.color,!0),et.getPattern(t,void 0,i.color)}const va="10px sans-serif",re="#000",se="round",Nn=[],Gn=0,oe="round",He=10,Ve="#000",$n="center",Ea="middle",Je=1;new De;class ae extends Bt{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?L.LOADING:L.LOADED,this.imageState_===L.LOADING&&this.ready().then(()=>this.imageState_=L.LOADED),this.render()}clone(){const t=this.getScale(),e=new ae({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-e[0]/n[0],t[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const n=this.renderOptions_,r=at(n.size*t,n.size*t);this.draw_(n,r,t),e=r.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let r=this.radius,s=this.radius2_===void 0?r:this.radius2_;if(r<s){const Ct=r;r=s,s=Ct}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,c=s*Math.sin(a),u=Math.sqrt(s*s-c*c),d=r-u,_=Math.sqrt(c*c+d*d),g=_/c;if(t==="miter"&&g<=n)return g*e;const p=e/2/g,x=e/2*(d/_),E=Math.sqrt((r+p)*(r+p)+x*x)-r;if(this.radius2_===void 0||t==="bevel")return E*2;const I=r*Math.sin(a),F=Math.sqrt(r*r-I*I),O=s-F,G=Math.sqrt(I*I+O*O)/I;if(G<=n){const Ct=G*e/2-s-r;return 2*Math.max(E,Ct)}return E*2}createRenderOptions(){let t=se,e=oe,n=0,r=null,s=0,o,a=0;this.stroke_&&(o=wt(this.stroke_.getColor()??Ve),a=this.stroke_.getWidth()??Je,r=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??oe,t=this.stroke_.getLineCap()??se,n=this.stroke_.getMiterLimit()??He);const c=this.calculateLineJoinSize_(e,a,n),u=Math.max(this.radius,this.radius2_||0),d=Math.ceil(2*u+c);return{strokeStyle:o,strokeWidth:a,size:d,lineCap:t,lineDash:r,lineDashOffset:s,lineJoin:e,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let r=this.fill_.getColor();r===null&&(r=re),e.fillStyle=wt(r),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let n=this.fill_.getColor(),r=0;typeof n=="string"&&(n=Ue(n)),n===null?r=1:Array.isArray(n)&&(r=n.length===4?n[3]:1),r===0&&(e=at(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const n=this.radius;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{const r=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const c=s+a*o,u=a%2===0?n:r;t.lineTo(u*Math.cos(c),u*Math.sin(c))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=re,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Ke extends ae{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Ke({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}}class le{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new le({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=qe(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===L.IDLE&&e.load(),e.getImageState()===L.LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}class Ze{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Ze({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class he{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Wn,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new he({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Wn,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function Wn(i){return i.getGeometry()}const Ia="#333";class je{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=ie(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new le({color:Ia}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new je({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ie(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}function zn(i,t,e,n){return e!==void 0&&n!==void 0?[e/i,n/t]:e!==void 0?e/i:n!==void 0?n/t:1}class ce extends Bt{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,r=t.scale!==void 0?t.scale:1,s=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:n,scale:r,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a=t.src;jt(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||pn(o)),jt(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),jt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let c;if(t.src!==void 0?c=L.IDLE:o!==void 0&&("complete"in o?o.complete?c=o.src?L.LOADED:L.IDLE:c=L.LOADING:c=L.LOADED),this.color_=t.color!==void 0?Ue(t.color):null,this.iconImage_=qe(o,a,this.crossOrigin_,c,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let u,d;if(t.size)[u,d]=t.size;else{const _=this.getImage(1);if(_.width&&_.height)u=_.width,d=_.height;else if(_ instanceof HTMLImageElement){this.initialOptions_=t;const g=()=>{if(this.unlistenImageChange(g),!this.initialOptions_)return;const p=this.iconImage_.getSize();this.setScale(zn(p[0],p[1],t.width,t.height))};this.listenImageChange(g);return}}u!==void 0&&this.setScale(zn(u,d,t.width,t.height))}}clone(){let t,e,n;return this.initialOptions_?(e=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new ce({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=r[0]),this.anchorYUnits_=="fraction"&&(t[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+r[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]-e[0]/n[0],t[1]+e[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==L.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==L.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(st.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(st.CHANGE,t)}ready(){return this.iconImage_.ready()}}const Un={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var Qe={},ue={};ue.byteLength=Oa,ue.toByteArray=ka,ue.fromByteArray=Ta;for(var J=[],V=[],Fa=typeof Uint8Array<"u"?Uint8Array:Array,ti="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",xt=0,Aa=ti.length;xt<Aa;++xt)J[xt]=ti[xt],V[ti.charCodeAt(xt)]=xt;V[45]=62,V[95]=63;function Xn(i){var t=i.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=i.indexOf("=");e===-1&&(e=t);var n=e===t?0:4-e%4;return[e,n]}function Oa(i){var t=Xn(i),e=t[0],n=t[1];return(e+n)*3/4-n}function La(i,t,e){return(t+e)*3/4-e}function ka(i){var t,e=Xn(i),n=e[0],r=e[1],s=new Fa(La(i,n,r)),o=0,a=r>0?n-4:n,c;for(c=0;c<a;c+=4)t=V[i.charCodeAt(c)]<<18|V[i.charCodeAt(c+1)]<<12|V[i.charCodeAt(c+2)]<<6|V[i.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return r===2&&(t=V[i.charCodeAt(c)]<<2|V[i.charCodeAt(c+1)]>>4,s[o++]=t&255),r===1&&(t=V[i.charCodeAt(c)]<<10|V[i.charCodeAt(c+1)]<<4|V[i.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function ba(i){return J[i>>18&63]+J[i>>12&63]+J[i>>6&63]+J[i&63]}function Ra(i,t,e){for(var n,r=[],s=t;s<e;s+=3)n=(i[s]<<16&16711680)+(i[s+1]<<8&65280)+(i[s+2]&255),r.push(ba(n));return r.join("")}function Ta(i){for(var t,e=i.length,n=e%3,r=[],s=16383,o=0,a=e-n;o<a;o+=s)r.push(Ra(i,o,o+s>a?a:o+s));return n===1?(t=i[e-1],r.push(J[t>>2]+J[t<<4&63]+"==")):n===2&&(t=(i[e-2]<<8)+i[e-1],r.push(J[t>>10]+J[t>>4&63]+J[t<<2&63]+"=")),r.join("")}var ei={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ei.read=function(i,t,e,n,r){var s,o,a=r*8-n-1,c=(1<<a)-1,u=c>>1,d=-7,_=e?r-1:0,g=e?-1:1,p=i[t+_];for(_+=g,s=p&(1<<-d)-1,p>>=-d,d+=a;d>0;s=s*256+i[t+_],_+=g,d-=8);for(o=s&(1<<-d)-1,s>>=-d,d+=n;d>0;o=o*256+i[t+_],_+=g,d-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(p?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-u}return(p?-1:1)*o*Math.pow(2,s-n)},ei.write=function(i,t,e,n,r,s){var o,a,c,u=s*8-r-1,d=(1<<u)-1,_=d>>1,g=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:s-1,x=n?1:-1,C=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=d):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+_>=1?t+=g/c:t+=g*Math.pow(2,1-_),t*c>=2&&(o++,c/=2),o+_>=d?(a=0,o=d):o+_>=1?(a=(t*c-1)*Math.pow(2,r),o=o+_):(a=t*Math.pow(2,_-1)*Math.pow(2,r),o=0));r>=8;i[e+p]=a&255,p+=x,a/=256,r-=8);for(o=o<<r|a,u+=r;u>0;i[e+p]=o&255,p+=x,o/=256,u-=8);i[e+p-x]|=C*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(i){const t=ue,e=ei,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;i.Buffer=a,i.SlowBuffer=F,i.INSPECT_MAX_BYTES=50;const r=2147483647;i.kMaxLength=r,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const f=new Uint8Array(1),l={foo:function(){return 42}};return Object.setPrototypeOf(l,Uint8Array.prototype),Object.setPrototypeOf(f,l),f.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(f){if(f>r)throw new RangeError('The value "'+f+'" is invalid for option "size"');const l=new Uint8Array(f);return Object.setPrototypeOf(l,a.prototype),l}function a(f,l,h){if(typeof f=="number"){if(typeof l=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return _(f)}return c(f,l,h)}a.poolSize=8192;function c(f,l,h){if(typeof f=="string")return g(f,l);if(ArrayBuffer.isView(f))return x(f);if(f==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof f);if(K(f,ArrayBuffer)||f&&K(f.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(K(f,SharedArrayBuffer)||f&&K(f.buffer,SharedArrayBuffer)))return C(f,l,h);if(typeof f=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const m=f.valueOf&&f.valueOf();if(m!=null&&m!==f)return a.from(m,l,h);const y=E(f);if(y)return y;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof f[Symbol.toPrimitive]=="function")return a.from(f[Symbol.toPrimitive]("string"),l,h);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof f)}a.from=function(f,l,h){return c(f,l,h)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function u(f){if(typeof f!="number")throw new TypeError('"size" argument must be of type number');if(f<0)throw new RangeError('The value "'+f+'" is invalid for option "size"')}function d(f,l,h){return u(f),f<=0?o(f):l!==void 0?typeof h=="string"?o(f).fill(l,h):o(f).fill(l):o(f)}a.alloc=function(f,l,h){return d(f,l,h)};function _(f){return u(f),o(f<0?0:I(f)|0)}a.allocUnsafe=function(f){return _(f)},a.allocUnsafeSlow=function(f){return _(f)};function g(f,l){if((typeof l!="string"||l==="")&&(l="utf8"),!a.isEncoding(l))throw new TypeError("Unknown encoding: "+l);const h=O(f,l)|0;let m=o(h);const y=m.write(f,l);return y!==h&&(m=m.slice(0,y)),m}function p(f){const l=f.length<0?0:I(f.length)|0,h=o(l);for(let m=0;m<l;m+=1)h[m]=f[m]&255;return h}function x(f){if(K(f,Uint8Array)){const l=new Uint8Array(f);return C(l.buffer,l.byteOffset,l.byteLength)}return p(f)}function C(f,l,h){if(l<0||f.byteLength<l)throw new RangeError('"offset" is outside of buffer bounds');if(f.byteLength<l+(h||0))throw new RangeError('"length" is outside of buffer bounds');let m;return l===void 0&&h===void 0?m=new Uint8Array(f):h===void 0?m=new Uint8Array(f,l):m=new Uint8Array(f,l,h),Object.setPrototypeOf(m,a.prototype),m}function E(f){if(a.isBuffer(f)){const l=I(f.length)|0,h=o(l);return h.length===0||f.copy(h,0,0,l),h}if(f.length!==void 0)return typeof f.length!="number"||hi(f.length)?o(0):p(f);if(f.type==="Buffer"&&Array.isArray(f.data))return p(f.data)}function I(f){if(f>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return f|0}function F(f){return+f!=f&&(f=0),a.alloc(+f)}a.isBuffer=function(l){return l!=null&&l._isBuffer===!0&&l!==a.prototype},a.compare=function(l,h){if(K(l,Uint8Array)&&(l=a.from(l,l.offset,l.byteLength)),K(h,Uint8Array)&&(h=a.from(h,h.offset,h.byteLength)),!a.isBuffer(l)||!a.isBuffer(h))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(l===h)return 0;let m=l.length,y=h.length;for(let w=0,S=Math.min(m,y);w<S;++w)if(l[w]!==h[w]){m=l[w],y=h[w];break}return m<y?-1:y<m?1:0},a.isEncoding=function(l){switch(String(l).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(l,h){if(!Array.isArray(l))throw new TypeError('"list" argument must be an Array of Buffers');if(l.length===0)return a.alloc(0);let m;if(h===void 0)for(h=0,m=0;m<l.length;++m)h+=l[m].length;const y=a.allocUnsafe(h);let w=0;for(m=0;m<l.length;++m){let S=l[m];if(K(S,Uint8Array))w+S.length>y.length?(a.isBuffer(S)||(S=a.from(S)),S.copy(y,w)):Uint8Array.prototype.set.call(y,S,w);else if(a.isBuffer(S))S.copy(y,w);else throw new TypeError('"list" argument must be an Array of Buffers');w+=S.length}return y};function O(f,l){if(a.isBuffer(f))return f.length;if(ArrayBuffer.isView(f)||K(f,ArrayBuffer))return f.byteLength;if(typeof f!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof f);const h=f.length,m=arguments.length>2&&arguments[2]===!0;if(!m&&h===0)return 0;let y=!1;for(;;)switch(l){case"ascii":case"latin1":case"binary":return h;case"utf8":case"utf-8":return li(f).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h*2;case"hex":return h>>>1;case"base64":return Cr(f).length;default:if(y)return m?-1:li(f).length;l=(""+l).toLowerCase(),y=!0}}a.byteLength=O;function B(f,l,h){let m=!1;if((l===void 0||l<0)&&(l=0),l>this.length||((h===void 0||h>this.length)&&(h=this.length),h<=0)||(h>>>=0,l>>>=0,h<=l))return"";for(f||(f="utf8");;)switch(f){case"hex":return Mh(this,l,h);case"utf8":case"utf-8":return dr(this,l,h);case"ascii":return Rh(this,l,h);case"latin1":case"binary":return Th(this,l,h);case"base64":return kh(this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ph(this,l,h);default:if(m)throw new TypeError("Unknown encoding: "+f);f=(f+"").toLowerCase(),m=!0}}a.prototype._isBuffer=!0;function G(f,l,h){const m=f[l];f[l]=f[h],f[h]=m}a.prototype.swap16=function(){const l=this.length;if(l%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let h=0;h<l;h+=2)G(this,h,h+1);return this},a.prototype.swap32=function(){const l=this.length;if(l%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let h=0;h<l;h+=4)G(this,h,h+3),G(this,h+1,h+2);return this},a.prototype.swap64=function(){const l=this.length;if(l%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let h=0;h<l;h+=8)G(this,h,h+7),G(this,h+1,h+6),G(this,h+2,h+5),G(this,h+3,h+4);return this},a.prototype.toString=function(){const l=this.length;return l===0?"":arguments.length===0?dr(this,0,l):B.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(l){if(!a.isBuffer(l))throw new TypeError("Argument must be a Buffer");return this===l?!0:a.compare(this,l)===0},a.prototype.inspect=function(){let l="";const h=i.INSPECT_MAX_BYTES;return l=this.toString("hex",0,h).replace(/(.{2})/g,"$1 ").trim(),this.length>h&&(l+=" ... "),"<Buffer "+l+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(l,h,m,y,w){if(K(l,Uint8Array)&&(l=a.from(l,l.offset,l.byteLength)),!a.isBuffer(l))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof l);if(h===void 0&&(h=0),m===void 0&&(m=l?l.length:0),y===void 0&&(y=0),w===void 0&&(w=this.length),h<0||m>l.length||y<0||w>this.length)throw new RangeError("out of range index");if(y>=w&&h>=m)return 0;if(y>=w)return-1;if(h>=m)return 1;if(h>>>=0,m>>>=0,y>>>=0,w>>>=0,this===l)return 0;let S=w-y,A=m-h;const P=Math.min(S,A),T=this.slice(y,w),D=l.slice(h,m);for(let k=0;k<P;++k)if(T[k]!==D[k]){S=T[k],A=D[k];break}return S<A?-1:A<S?1:0};function Ct(f,l,h,m,y){if(f.length===0)return-1;if(typeof h=="string"?(m=h,h=0):h>2147483647?h=2147483647:h<-2147483648&&(h=-2147483648),h=+h,hi(h)&&(h=y?0:f.length-1),h<0&&(h=f.length+h),h>=f.length){if(y)return-1;h=f.length-1}else if(h<0)if(y)h=0;else return-1;if(typeof l=="string"&&(l=a.from(l,m)),a.isBuffer(l))return l.length===0?-1:fr(f,l,h,m,y);if(typeof l=="number")return l=l&255,typeof Uint8Array.prototype.indexOf=="function"?y?Uint8Array.prototype.indexOf.call(f,l,h):Uint8Array.prototype.lastIndexOf.call(f,l,h):fr(f,[l],h,m,y);throw new TypeError("val must be string, number or Buffer")}function fr(f,l,h,m,y){let w=1,S=f.length,A=l.length;if(m!==void 0&&(m=String(m).toLowerCase(),m==="ucs2"||m==="ucs-2"||m==="utf16le"||m==="utf-16le")){if(f.length<2||l.length<2)return-1;w=2,S/=2,A/=2,h/=2}function P(D,k){return w===1?D[k]:D.readUInt16BE(k*w)}let T;if(y){let D=-1;for(T=h;T<S;T++)if(P(f,T)===P(l,D===-1?0:T-D)){if(D===-1&&(D=T),T-D+1===A)return D*w}else D!==-1&&(T-=T-D),D=-1}else for(h+A>S&&(h=S-A),T=h;T>=0;T--){let D=!0;for(let k=0;k<A;k++)if(P(f,T+k)!==P(l,k)){D=!1;break}if(D)return T}return-1}a.prototype.includes=function(l,h,m){return this.indexOf(l,h,m)!==-1},a.prototype.indexOf=function(l,h,m){return Ct(this,l,h,m,!0)},a.prototype.lastIndexOf=function(l,h,m){return Ct(this,l,h,m,!1)};function Ih(f,l,h,m){h=Number(h)||0;const y=f.length-h;m?(m=Number(m),m>y&&(m=y)):m=y;const w=l.length;m>w/2&&(m=w/2);let S;for(S=0;S<m;++S){const A=parseInt(l.substr(S*2,2),16);if(hi(A))return S;f[h+S]=A}return S}function Fh(f,l,h,m){return de(li(l,f.length-h),f,h,m)}function Ah(f,l,h,m){return de(Gh(l),f,h,m)}function Oh(f,l,h,m){return de(Cr(l),f,h,m)}function Lh(f,l,h,m){return de($h(l,f.length-h),f,h,m)}a.prototype.write=function(l,h,m,y){if(h===void 0)y="utf8",m=this.length,h=0;else if(m===void 0&&typeof h=="string")y=h,m=this.length,h=0;else if(isFinite(h))h=h>>>0,isFinite(m)?(m=m>>>0,y===void 0&&(y="utf8")):(y=m,m=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const w=this.length-h;if((m===void 0||m>w)&&(m=w),l.length>0&&(m<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");y||(y="utf8");let S=!1;for(;;)switch(y){case"hex":return Ih(this,l,h,m);case"utf8":case"utf-8":return Fh(this,l,h,m);case"ascii":case"latin1":case"binary":return Ah(this,l,h,m);case"base64":return Oh(this,l,h,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Lh(this,l,h,m);default:if(S)throw new TypeError("Unknown encoding: "+y);y=(""+y).toLowerCase(),S=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function kh(f,l,h){return l===0&&h===f.length?t.fromByteArray(f):t.fromByteArray(f.slice(l,h))}function dr(f,l,h){h=Math.min(f.length,h);const m=[];let y=l;for(;y<h;){const w=f[y];let S=null,A=w>239?4:w>223?3:w>191?2:1;if(y+A<=h){let P,T,D,k;switch(A){case 1:w<128&&(S=w);break;case 2:P=f[y+1],(P&192)===128&&(k=(w&31)<<6|P&63,k>127&&(S=k));break;case 3:P=f[y+1],T=f[y+2],(P&192)===128&&(T&192)===128&&(k=(w&15)<<12|(P&63)<<6|T&63,k>2047&&(k<55296||k>57343)&&(S=k));break;case 4:P=f[y+1],T=f[y+2],D=f[y+3],(P&192)===128&&(T&192)===128&&(D&192)===128&&(k=(w&15)<<18|(P&63)<<12|(T&63)<<6|D&63,k>65535&&k<1114112&&(S=k))}}S===null?(S=65533,A=1):S>65535&&(S-=65536,m.push(S>>>10&1023|55296),S=56320|S&1023),m.push(S),y+=A}return bh(m)}const gr=4096;function bh(f){const l=f.length;if(l<=gr)return String.fromCharCode.apply(String,f);let h="",m=0;for(;m<l;)h+=String.fromCharCode.apply(String,f.slice(m,m+=gr));return h}function Rh(f,l,h){let m="";h=Math.min(f.length,h);for(let y=l;y<h;++y)m+=String.fromCharCode(f[y]&127);return m}function Th(f,l,h){let m="";h=Math.min(f.length,h);for(let y=l;y<h;++y)m+=String.fromCharCode(f[y]);return m}function Mh(f,l,h){const m=f.length;(!l||l<0)&&(l=0),(!h||h<0||h>m)&&(h=m);let y="";for(let w=l;w<h;++w)y+=Wh[f[w]];return y}function Ph(f,l,h){const m=f.slice(l,h);let y="";for(let w=0;w<m.length-1;w+=2)y+=String.fromCharCode(m[w]+m[w+1]*256);return y}a.prototype.slice=function(l,h){const m=this.length;l=~~l,h=h===void 0?m:~~h,l<0?(l+=m,l<0&&(l=0)):l>m&&(l=m),h<0?(h+=m,h<0&&(h=0)):h>m&&(h=m),h<l&&(h=l);const y=this.subarray(l,h);return Object.setPrototypeOf(y,a.prototype),y};function W(f,l,h){if(f%1!==0||f<0)throw new RangeError("offset is not uint");if(f+l>h)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(l,h,m){l=l>>>0,h=h>>>0,m||W(l,h,this.length);let y=this[l],w=1,S=0;for(;++S<h&&(w*=256);)y+=this[l+S]*w;return y},a.prototype.readUintBE=a.prototype.readUIntBE=function(l,h,m){l=l>>>0,h=h>>>0,m||W(l,h,this.length);let y=this[l+--h],w=1;for(;h>0&&(w*=256);)y+=this[l+--h]*w;return y},a.prototype.readUint8=a.prototype.readUInt8=function(l,h){return l=l>>>0,h||W(l,1,this.length),this[l]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(l,h){return l=l>>>0,h||W(l,2,this.length),this[l]|this[l+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(l,h){return l=l>>>0,h||W(l,2,this.length),this[l]<<8|this[l+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(l,h){return l=l>>>0,h||W(l,4,this.length),(this[l]|this[l+1]<<8|this[l+2]<<16)+this[l+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(l,h){return l=l>>>0,h||W(l,4,this.length),this[l]*16777216+(this[l+1]<<16|this[l+2]<<8|this[l+3])},a.prototype.readBigUInt64LE=it(function(l){l=l>>>0,Et(l,"offset");const h=this[l],m=this[l+7];(h===void 0||m===void 0)&&$t(l,this.length-8);const y=h+this[++l]*2**8+this[++l]*2**16+this[++l]*2**24,w=this[++l]+this[++l]*2**8+this[++l]*2**16+m*2**24;return BigInt(y)+(BigInt(w)<<BigInt(32))}),a.prototype.readBigUInt64BE=it(function(l){l=l>>>0,Et(l,"offset");const h=this[l],m=this[l+7];(h===void 0||m===void 0)&&$t(l,this.length-8);const y=h*2**24+this[++l]*2**16+this[++l]*2**8+this[++l],w=this[++l]*2**24+this[++l]*2**16+this[++l]*2**8+m;return(BigInt(y)<<BigInt(32))+BigInt(w)}),a.prototype.readIntLE=function(l,h,m){l=l>>>0,h=h>>>0,m||W(l,h,this.length);let y=this[l],w=1,S=0;for(;++S<h&&(w*=256);)y+=this[l+S]*w;return w*=128,y>=w&&(y-=Math.pow(2,8*h)),y},a.prototype.readIntBE=function(l,h,m){l=l>>>0,h=h>>>0,m||W(l,h,this.length);let y=h,w=1,S=this[l+--y];for(;y>0&&(w*=256);)S+=this[l+--y]*w;return w*=128,S>=w&&(S-=Math.pow(2,8*h)),S},a.prototype.readInt8=function(l,h){return l=l>>>0,h||W(l,1,this.length),this[l]&128?(255-this[l]+1)*-1:this[l]},a.prototype.readInt16LE=function(l,h){l=l>>>0,h||W(l,2,this.length);const m=this[l]|this[l+1]<<8;return m&32768?m|4294901760:m},a.prototype.readInt16BE=function(l,h){l=l>>>0,h||W(l,2,this.length);const m=this[l+1]|this[l]<<8;return m&32768?m|4294901760:m},a.prototype.readInt32LE=function(l,h){return l=l>>>0,h||W(l,4,this.length),this[l]|this[l+1]<<8|this[l+2]<<16|this[l+3]<<24},a.prototype.readInt32BE=function(l,h){return l=l>>>0,h||W(l,4,this.length),this[l]<<24|this[l+1]<<16|this[l+2]<<8|this[l+3]},a.prototype.readBigInt64LE=it(function(l){l=l>>>0,Et(l,"offset");const h=this[l],m=this[l+7];(h===void 0||m===void 0)&&$t(l,this.length-8);const y=this[l+4]+this[l+5]*2**8+this[l+6]*2**16+(m<<24);return(BigInt(y)<<BigInt(32))+BigInt(h+this[++l]*256+this[++l]*65536+this[++l]*16777216)}),a.prototype.readBigInt64BE=it(function(l){l=l>>>0,Et(l,"offset");const h=this[l],m=this[l+7];(h===void 0||m===void 0)&&$t(l,this.length-8);const y=(h<<24)+this[++l]*2**16+this[++l]*2**8+this[++l];return(BigInt(y)<<BigInt(32))+BigInt(this[++l]*16777216+this[++l]*65536+this[++l]*256+m)}),a.prototype.readFloatLE=function(l,h){return l=l>>>0,h||W(l,4,this.length),e.read(this,l,!0,23,4)},a.prototype.readFloatBE=function(l,h){return l=l>>>0,h||W(l,4,this.length),e.read(this,l,!1,23,4)},a.prototype.readDoubleLE=function(l,h){return l=l>>>0,h||W(l,8,this.length),e.read(this,l,!0,52,8)},a.prototype.readDoubleBE=function(l,h){return l=l>>>0,h||W(l,8,this.length),e.read(this,l,!1,52,8)};function Y(f,l,h,m,y,w){if(!a.isBuffer(f))throw new TypeError('"buffer" argument must be a Buffer instance');if(l>y||l<w)throw new RangeError('"value" argument is out of bounds');if(h+m>f.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(l,h,m,y){if(l=+l,h=h>>>0,m=m>>>0,!y){const A=Math.pow(2,8*m)-1;Y(this,l,h,m,A,0)}let w=1,S=0;for(this[h]=l&255;++S<m&&(w*=256);)this[h+S]=l/w&255;return h+m},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(l,h,m,y){if(l=+l,h=h>>>0,m=m>>>0,!y){const A=Math.pow(2,8*m)-1;Y(this,l,h,m,A,0)}let w=m-1,S=1;for(this[h+w]=l&255;--w>=0&&(S*=256);)this[h+w]=l/S&255;return h+m},a.prototype.writeUint8=a.prototype.writeUInt8=function(l,h,m){return l=+l,h=h>>>0,m||Y(this,l,h,1,255,0),this[h]=l&255,h+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(l,h,m){return l=+l,h=h>>>0,m||Y(this,l,h,2,65535,0),this[h]=l&255,this[h+1]=l>>>8,h+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(l,h,m){return l=+l,h=h>>>0,m||Y(this,l,h,2,65535,0),this[h]=l>>>8,this[h+1]=l&255,h+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(l,h,m){return l=+l,h=h>>>0,m||Y(this,l,h,4,4294967295,0),this[h+3]=l>>>24,this[h+2]=l>>>16,this[h+1]=l>>>8,this[h]=l&255,h+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(l,h,m){return l=+l,h=h>>>0,m||Y(this,l,h,4,4294967295,0),this[h]=l>>>24,this[h+1]=l>>>16,this[h+2]=l>>>8,this[h+3]=l&255,h+4};function mr(f,l,h,m,y){Sr(l,m,y,f,h,7);let w=Number(l&BigInt(4294967295));f[h++]=w,w=w>>8,f[h++]=w,w=w>>8,f[h++]=w,w=w>>8,f[h++]=w;let S=Number(l>>BigInt(32)&BigInt(4294967295));return f[h++]=S,S=S>>8,f[h++]=S,S=S>>8,f[h++]=S,S=S>>8,f[h++]=S,h}function _r(f,l,h,m,y){Sr(l,m,y,f,h,7);let w=Number(l&BigInt(4294967295));f[h+7]=w,w=w>>8,f[h+6]=w,w=w>>8,f[h+5]=w,w=w>>8,f[h+4]=w;let S=Number(l>>BigInt(32)&BigInt(4294967295));return f[h+3]=S,S=S>>8,f[h+2]=S,S=S>>8,f[h+1]=S,S=S>>8,f[h]=S,h+8}a.prototype.writeBigUInt64LE=it(function(l,h=0){return mr(this,l,h,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=it(function(l,h=0){return _r(this,l,h,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(l,h,m,y){if(l=+l,h=h>>>0,!y){const P=Math.pow(2,8*m-1);Y(this,l,h,m,P-1,-P)}let w=0,S=1,A=0;for(this[h]=l&255;++w<m&&(S*=256);)l<0&&A===0&&this[h+w-1]!==0&&(A=1),this[h+w]=(l/S>>0)-A&255;return h+m},a.prototype.writeIntBE=function(l,h,m,y){if(l=+l,h=h>>>0,!y){const P=Math.pow(2,8*m-1);Y(this,l,h,m,P-1,-P)}let w=m-1,S=1,A=0;for(this[h+w]=l&255;--w>=0&&(S*=256);)l<0&&A===0&&this[h+w+1]!==0&&(A=1),this[h+w]=(l/S>>0)-A&255;return h+m},a.prototype.writeInt8=function(l,h,m){return l=+l,h=h>>>0,m||Y(this,l,h,1,127,-128),l<0&&(l=255+l+1),this[h]=l&255,h+1},a.prototype.writeInt16LE=function(l,h,m){return l=+l,h=h>>>0,m||Y(this,l,h,2,32767,-32768),this[h]=l&255,this[h+1]=l>>>8,h+2},a.prototype.writeInt16BE=function(l,h,m){return l=+l,h=h>>>0,m||Y(this,l,h,2,32767,-32768),this[h]=l>>>8,this[h+1]=l&255,h+2},a.prototype.writeInt32LE=function(l,h,m){return l=+l,h=h>>>0,m||Y(this,l,h,4,2147483647,-2147483648),this[h]=l&255,this[h+1]=l>>>8,this[h+2]=l>>>16,this[h+3]=l>>>24,h+4},a.prototype.writeInt32BE=function(l,h,m){return l=+l,h=h>>>0,m||Y(this,l,h,4,2147483647,-2147483648),l<0&&(l=4294967295+l+1),this[h]=l>>>24,this[h+1]=l>>>16,this[h+2]=l>>>8,this[h+3]=l&255,h+4},a.prototype.writeBigInt64LE=it(function(l,h=0){return mr(this,l,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=it(function(l,h=0){return _r(this,l,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function pr(f,l,h,m,y,w){if(h+m>f.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("Index out of range")}function yr(f,l,h,m,y){return l=+l,h=h>>>0,y||pr(f,l,h,4),e.write(f,l,h,m,23,4),h+4}a.prototype.writeFloatLE=function(l,h,m){return yr(this,l,h,!0,m)},a.prototype.writeFloatBE=function(l,h,m){return yr(this,l,h,!1,m)};function wr(f,l,h,m,y){return l=+l,h=h>>>0,y||pr(f,l,h,8),e.write(f,l,h,m,52,8),h+8}a.prototype.writeDoubleLE=function(l,h,m){return wr(this,l,h,!0,m)},a.prototype.writeDoubleBE=function(l,h,m){return wr(this,l,h,!1,m)},a.prototype.copy=function(l,h,m,y){if(!a.isBuffer(l))throw new TypeError("argument should be a Buffer");if(m||(m=0),!y&&y!==0&&(y=this.length),h>=l.length&&(h=l.length),h||(h=0),y>0&&y<m&&(y=m),y===m||l.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(m<0||m>=this.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("sourceEnd out of bounds");y>this.length&&(y=this.length),l.length-h<y-m&&(y=l.length-h+m);const w=y-m;return this===l&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(h,m,y):Uint8Array.prototype.set.call(l,this.subarray(m,y),h),w},a.prototype.fill=function(l,h,m,y){if(typeof l=="string"){if(typeof h=="string"?(y=h,h=0,m=this.length):typeof m=="string"&&(y=m,m=this.length),y!==void 0&&typeof y!="string")throw new TypeError("encoding must be a string");if(typeof y=="string"&&!a.isEncoding(y))throw new TypeError("Unknown encoding: "+y);if(l.length===1){const S=l.charCodeAt(0);(y==="utf8"&&S<128||y==="latin1")&&(l=S)}}else typeof l=="number"?l=l&255:typeof l=="boolean"&&(l=Number(l));if(h<0||this.length<h||this.length<m)throw new RangeError("Out of range index");if(m<=h)return this;h=h>>>0,m=m===void 0?this.length:m>>>0,l||(l=0);let w;if(typeof l=="number")for(w=h;w<m;++w)this[w]=l;else{const S=a.isBuffer(l)?l:a.from(l,y),A=S.length;if(A===0)throw new TypeError('The value "'+l+'" is invalid for argument "value"');for(w=0;w<m-h;++w)this[w+h]=S[w%A]}return this};const vt={};function ai(f,l,h){vt[f]=class extends h{constructor(){super(),Object.defineProperty(this,"message",{value:l.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${f}]`,this.stack,delete this.name}get code(){return f}set code(y){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:y,writable:!0})}toString(){return`${this.name} [${f}]: ${this.message}`}}}ai("ERR_BUFFER_OUT_OF_BOUNDS",function(f){return f?`${f} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ai("ERR_INVALID_ARG_TYPE",function(f,l){return`The "${f}" argument must be of type number. Received type ${typeof l}`},TypeError),ai("ERR_OUT_OF_RANGE",function(f,l,h){let m=`The value of "${f}" is out of range.`,y=h;return Number.isInteger(h)&&Math.abs(h)>4294967296?y=xr(String(h)):typeof h=="bigint"&&(y=String(h),(h>BigInt(2)**BigInt(32)||h<-(BigInt(2)**BigInt(32)))&&(y=xr(y)),y+="n"),m+=` It must be ${l}. Received ${y}`,m},RangeError);function xr(f){let l="",h=f.length;const m=f[0]==="-"?1:0;for(;h>=m+4;h-=3)l=`_${f.slice(h-3,h)}${l}`;return`${f.slice(0,h)}${l}`}function Dh(f,l,h){Et(l,"offset"),(f[l]===void 0||f[l+h]===void 0)&&$t(l,f.length-(h+1))}function Sr(f,l,h,m,y,w){if(f>h||f<l){const S=typeof l=="bigint"?"n":"";let A;throw l===0||l===BigInt(0)?A=`>= 0${S} and < 2${S} ** ${(w+1)*8}${S}`:A=`>= -(2${S} ** ${(w+1)*8-1}${S}) and < 2 ** ${(w+1)*8-1}${S}`,new vt.ERR_OUT_OF_RANGE("value",A,f)}Dh(m,y,w)}function Et(f,l){if(typeof f!="number")throw new vt.ERR_INVALID_ARG_TYPE(l,"number",f)}function $t(f,l,h){throw Math.floor(f)!==f?(Et(f,h),new vt.ERR_OUT_OF_RANGE("offset","an integer",f)):l<0?new vt.ERR_BUFFER_OUT_OF_BOUNDS:new vt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${l}`,f)}const Bh=/[^+/0-9A-Za-z-_]/g;function Nh(f){if(f=f.split("=")[0],f=f.trim().replace(Bh,""),f.length<2)return"";for(;f.length%4!==0;)f=f+"=";return f}function li(f,l){l=l||1/0;let h;const m=f.length;let y=null;const w=[];for(let S=0;S<m;++S){if(h=f.charCodeAt(S),h>55295&&h<57344){if(!y){if(h>56319){(l-=3)>-1&&w.push(239,191,189);continue}else if(S+1===m){(l-=3)>-1&&w.push(239,191,189);continue}y=h;continue}if(h<56320){(l-=3)>-1&&w.push(239,191,189),y=h;continue}h=(y-55296<<10|h-56320)+65536}else y&&(l-=3)>-1&&w.push(239,191,189);if(y=null,h<128){if((l-=1)<0)break;w.push(h)}else if(h<2048){if((l-=2)<0)break;w.push(h>>6|192,h&63|128)}else if(h<65536){if((l-=3)<0)break;w.push(h>>12|224,h>>6&63|128,h&63|128)}else if(h<1114112){if((l-=4)<0)break;w.push(h>>18|240,h>>12&63|128,h>>6&63|128,h&63|128)}else throw new Error("Invalid code point")}return w}function Gh(f){const l=[];for(let h=0;h<f.length;++h)l.push(f.charCodeAt(h)&255);return l}function $h(f,l){let h,m,y;const w=[];for(let S=0;S<f.length&&!((l-=2)<0);++S)h=f.charCodeAt(S),m=h>>8,y=h%256,w.push(y),w.push(m);return w}function Cr(f){return t.toByteArray(Nh(f))}function de(f,l,h,m){let y;for(y=0;y<m&&!(y+h>=l.length||y>=f.length);++y)l[y+h]=f[y];return y}function K(f,l){return f instanceof l||f!=null&&f.constructor!=null&&f.constructor.name!=null&&f.constructor.name===l.name}function hi(f){return f!==f}const Wh=function(){const f="0123456789abcdef",l=new Array(256);for(let h=0;h<16;++h){const m=h*16;for(let y=0;y<16;++y)l[m+y]=f[h]+f[y]}return l}();function it(f){return typeof BigInt>"u"?zh:f}function zh(){throw new Error("BigInt not supported")}})(Qe);const ii=/^ttf:\/\/(.+)#(.+)$/,Yn="geostyler-mark-symbolizer";class v{static getRgbaColor(t,e){if(Tt(t)&&(t=v.evaluateStringFunction(t)),typeof t!="string")return;if(t.startsWith("rgba("))return t;if(!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t))return;const r=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),o=parseInt(t.slice(5,7),16);return Rt(e)&&(e=v.evaluateNumberFunction(e)),e<0&&(e=1),"rgba("+r+", "+s+", "+o+", "+e+")"}static splitRgbaColor(t){const e=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/),n=parseInt(e[0],10),r=parseInt(e[1],10),s=parseInt(e[2],10),o=parseFloat(e[3]);return[n,r,s,o]}static getHexColor(t){if(t.startsWith("#"))return t;if(t.startsWith("rgb")){const e=v.splitRgbaColor(t);return v.getHexCodeFromRgbArray(e)}else if(Un[t.toLocaleLowerCase()]!==void 0){const e=Un[t.toLocaleLowerCase()];return v.getHexCodeFromRgbArray(e)}else return}static getHexCodeFromRgbArray(t){return"#"+t.map((e,n)=>{const r=e.toString(16);return n<3?r.length===1?"0"+r:r:""}).join("")}static getOpacity(t){if(!t.startsWith("rgba("))return;const e=v.splitRgbaColor(t);if(e.length===4)return e[3]}static getTextFont(t){const e=t.fontWeight??"normal",n=t.fontStyle??"normal",r=t.size,s=t.font;return e+" "+n+" "+r+"px "+(s==null?void 0:s.join(", "))}static getIsFontGlyphBased(t){return ii.test(t.wellKnownName)}static getIsMarkSymbolizerFont(t){if(!t)return!1;const e=Yn;return t.substring(t.length-e.length,t.length)===e}static getTextFontForMarkSymbolizer(t){const e=t.wellKnownName.match(ii);if(!e)throw new Error(`Could not parse font-based well known name: ${t.wellKnownName}`);const n=e[1];return`Normal ${t.radius||5}px '${n}', ${Yn}`}static getCharacterForMarkSymbolizer(t){const e=t.wellKnownName.match(ii);if(!e)throw new Error(`Could not parse font-based well known name: ${t.wellKnownName}`);return String.fromCharCode(parseInt(e[2],16))}static getFontNameFromOlFont(t){const e=t.match(/(?:\d+\S+) '?"?([^,'"]+)/);if(!e)throw new Error(`Could not find font family name in the following string: ${t}`);return e[1]}static getSizeFromOlFont(t){const e=t.match(/(?:(\d+)px)/);return e?parseInt(e[1],10):0}static createIconStyleFromSvg(t){const e=new Blob([t],{type:"image/svg+xml"}),n=URL.createObjectURL(e),r=new he({image:new ce({src:n,crossOrigin:"anonymous",scale:1})}),s=new Image;return s.onload=()=>{URL.revokeObjectURL(n)},s.src=n,r}static getBase64EncodedSvg(t){return"data:image/svg+xml;base64,"+Qe.Buffer.from(t).toString("base64")}static getBase64DecodedSvg(t){return Qe.Buffer.from(t.replace("data:image/svg+xml;base64,",""),"base64").toString("utf-8")}static resolveAttributeTemplate(t,e,n="n.v.",r=(s,o)=>o){let s="\\{\\{",o="\\}\\}",a=new RegExp(s+"(.*?)"+o,"g"),c=e.match(a);return c&&c.forEach(u=>{let d=0;for(let[_,g]of Object.entries(t.getProperties()))if(u.slice(2,u.length-2).toLowerCase()===_.toLowerCase()){e=e.replace(u,r(_,g));break}else d++;d===Object.keys(t.getProperties()).length&&(e=e.replace(u,n))}),e}static evaluateFunction(t,e){if(t.name==="property"){if(!e)throw new Error(`Could not evalute 'property' function. Feature ${e} is not defined.`);return Tt(t.args[0])?e==null?void 0:e.get(v.evaluateStringFunction(t.args[0],e)):e==null?void 0:e.get(t.args[0])}if(ln(t))return v.evaluateUnknownFunction(t,e);if(Tt(t))return v.evaluateStringFunction(t,e);if(Rt(t))return v.evaluateNumberFunction(t,e);if(mt(t))return v.evaluateBooleanFunction(t,e)}static evaluateBooleanFunction(t,e){const n=t.args.map(r=>N(r)?v.evaluateFunction(r,e):r);switch(t.name){case"all":return n.map(o=>this.evaluateBooleanFunction(o,e)).every(o=>o===!0);case"any":return n.map(o=>this.evaluateBooleanFunction(o,e)).some(o=>o===!0);case"between":return n[0]>=n[1]&&n[0]<=n[2];case"double2bool":return!1;case"equalTo":return n[0]===n[1];case"greaterThan":return n[0]>n[1];case"greaterThanOrEqualTo":return n[0]>=n[1];case"in":return n.slice(1).includes(n[0]);case"lessThan":return n[0]<n[1];case"lessThanOrEqualTo":return n[0]<=n[1];case"not":return!n[0];case"notEqualTo":return n[0]!==n[1];case"parseBoolean":return!!n[0];case"strEndsWith":return n[0].endsWith(n[1]);case"strEqualsIgnoreCase":return n[0].toLowerCase()===n[1].toLowerCase();case"strMatches":const s=n[1].match(/\/(.*?)\/([gimy]{0,4})$/);return s&&s.length===3?new RegExp(s[1],s[2]).test(n[0]):!1;case"strStartsWith":return n[0].startsWith(n[1]);default:return!1}}static evaluateNumberFunction(t,e){if(t.name==="pi")return Math.PI;if(t.name==="random")return Math.random();const n=t.args.map(r=>N(r)?v.evaluateFunction(r,e):r);switch(t.name){case"abs":return Math.abs(n[0]);case"acos":return Math.acos(n[0]);case"add":return n[0]+n[1];case"asin":return Math.asin(n[0]);case"atan":return Math.atan(n[0]);case"atan2":return n[0];case"ceil":return Math.ceil(n[0]);case"cos":return Math.cos(n[0]);case"div":return n[0]/n[1];case"exp":return Math.exp(n[0]);case"floor":return Math.floor(n[0]);case"log":return Math.log(n[0]);case"max":return Math.max(...n);case"min":return Math.min(...n);case"modulo":return n[0]%n[1];case"mul":return n[0]*n[1];case"pow":return Math.pow(n[0],n[1]);case"rint":return n[0];case"round":return Math.round(n[0]);case"sin":return Math.sin(n[0]);case"sqrt":return Math.sqrt(n[0]);case"strIndexOf":return n[0].indexOf(n[1]);case"strLastIndexOf":return n[0].lastIndexOf(n[1]);case"strLength":return n[0].length;case"sub":return n[0]-n[1];case"tan":return Math.tan(n[0]);case"toDegrees":return n[0]*(180/Math.PI);case"toRadians":return n[0]*(Math.PI/180);default:return n[0]}}static evaluateUnknownFunction(t,e){const n=t.args.map(r=>N(r)?v.evaluateFunction(r,e):r);switch(t.name){case"property":return e==null?void 0:e.get(n[0]);case"case":const r=n;let s;for(let o=0;o<r.length;o++){const a=r[o];if(o===r.length-1){s=a;break}else if(a.case===!0){s=a.value;break}else if(v.evaluateBooleanFunction(a.case,e)){s=a.value;break}}return s;default:return n[0]}}static evaluateStringFunction(t,e){var s;const n=t.args.map(o=>N(o)?v.evaluateFunction(o,e):o);switch(t.name){case"numberFormat":return n[0];case"strAbbreviate":return n[0];case"strCapitalize":var r=n[0].toLowerCase().split(" ");for(let o of r)o=o.charAt(0).toUpperCase()+o.substring(1);return r.join(" ");case"strConcat":return n.join();case"strDefaultIfBlank":return((s=n[0])==null?void 0:s.length)<1?n[1]:n[0];case"strReplace":return n[3]===!0?n[0].replaceAll(n[1],n[2]):n[0].replace(n[1],n[2]);case"strStripAccents":return n[0].normalize("NFKD").replace(/[\u0300-\u036f]/g,"");case"strSubstring":return n[0].substring(n[1],n[2]);case"strSubstringStart":return n[0].substring(n[1]);case"strToLowerCase":return n[0].toLowerCase();case"strToUpperCase":return n[0].toUpperCase();case"strTrim":return n[0].trim();default:return n[0]}}static containsGeoStylerFunctions(t){return t.rules.some(e=>{var o,a,c,u;const n=Array.isArray(e.filter)&&((o=e.filter)==null?void 0:o.some(N)),r=(a=e.symbolizers)==null?void 0:a.some(d=>Object.values(d).some(N)),s=N((c=e==null?void 0:e.scaleDenominator)==null?void 0:c.max)||N((u=e==null?void 0:e.scaleDenominator)==null?void 0:u.min);return n||r||s})}}const qn={arrow:'d="M 0,-10 L 5,-5 L 2.5,-5 L 2.5,10 L -2.5,10 L -2.5,-5 L -5,-5 L 0,-10 Z"',arrowhead:'d="M -10 -10 L 0 0 L -10 10"',asterisk_fill:'d="M -1.5,-10 L 1.5,-10L 1.5,-3.939 L 6.011,-8.132 L 8.132,-6.011 L 3.939,-1.5 L 10,-1.5 L 10,1.5 L 3.939,1.5 L 8.132,6.011 L 6.011,8.132 L 1.5,3.939 L 1.5,10 L -1.5,10 L -1.5,3.939 L -6.011,8.132 L -8.132,6.011 L -3.939,1.5 L -10,1.5 L -10,-1.5 L -3.939,-1.5 L -8.132,-6.011 L -6.011,-8.132 L -1.5,-3.939 L -1.5,-10 Z"',backslash:'d="M -12 -12 L 12 12"',carrow:'d="M -10 10 L 0 -10 L 10 10 Z"',circle:'cx="0" cy="0" r="10"',cross:'d="M -12 0 L 12 0 M 0 -12 L 0 12"',cross_fill:'d="M -10,-2 L -10,-2 L -10,2 L -2,2 L -2,10 L 2,10 L 2,2 L 10,2 L 10,-2 L 2,-2 L 2,-10 L -2,-10 L -2,-2 L -10,-2 Z"',cross2:'d="M -12 -12 L 12 12 M 12 -12 L -12 12"',decagon:'points="5.878,8.09 9.511,3.09 9.511,-3.09 5.878,-8.09 0,-10 -5.878,-8.09 -9.511,-3.09 -9.511,3.09 -5.878,8.09 0,10 5.878,8.09"',diagonal_half_square:'points="-10,-10 10,10 -10,10 -10,-10"',diamond:'points="-10,0 0,10 10,0 0,-10 -10,0"',equilateral_triangle:'points="-8.66,5 8.66,5 0,-10 -8.66,5"',filled_arrowhead:'d="M 0,0 L -10,10 L -10,-10 L 0,0 Z"',half_arc:'d="M -10 0 A -10 -10 0 0 1 10 0"',half_square:'points="-10,-10 0,-10 0,10 -10,10 -10,-10"',heart:'d="M -9.5 -2 A 1 1 0 0 1 0 -7.5 A 1 1 0 0 1 9.5 -2 L 0 10 Z"',hexagon:'points="-8.66,-5 -8.66,5 0,10 8.66,5 8.66,-5 0,-10 -8.66,-5"',horline:'d="M -12 0 L 12 0"',left_half_triangle:'points="0,10 10,10 0,-10 0,10"',line:'d="M 0 -12 L 0 12"',oarrow:'d="M -10 10 L 0 -10 L 10 10"',octagon:'points="-4.142,10 4.142,10 10,4.142 10,-4.142 4.142,-10 -4.142,-10 -10,-4.142 -10,4.142 -4.142,10"',parallelogram_left:'points="10,5 5,-5 -10,-5 -5,5 10,5"',parallelogram_right:'points="5,5 10,-5 -5,-5 -10,5 5,5"',pentagon:'points="-9.511,-3.09 -5.878,8.09 5.878,8.09 9.511,-3.09 0,-10 -9.511,-3.09"',quarter_arc:'d="M 0 -10 A 10 10 0 0 0 -10 0"',quarter_circle:'d="M 0 -10 A 10 10 0 0 0 -10 0 L 0 0 Z"',quarter_square:'points="-10,-10 0,-10 0,0 -10,0 -10,-10"',right_half_triangle:'points="-10,10 0,10 0,-10 -10,10"',rounded_square:'x="-10" y="-10" width="20" height="20" rx="2.5" ry="2.5"',semi_circle:'d="M -10 0 A -10 -10 0 0 1 10 0 L 0 0 Z"',shield:'points="10,5 10,-10 -10,-10 -10,5 0,10 10,5"',slash:'d="M 12 -12 L -12 12"',square:'points="-10,-10 10,-10 10,10 -10,10"',square_with_corners:'points="-6.072,10 6.072,10 10,6.072 10,-6.072 6.072,-10 -6.072,-10 -10,-6.072 -10,6.072 -6.072,10"',star:'d="M -2.24514,-3.09017 -9.51057,-3.09017 -3.63271,1.18034 -5.87785,8.09017 0,3.81966 5.87785,8.09017 3.63271,1.18034 9.51057,-3.09017 2.24514,-3.09017 0,-10 -2.24514,-3.09017 Z"',star_diamond:'d="M -2.70091,-2.70091 -10,0 -2.70091,2.70091 0,10 2.70091,2.70091 10,0 2.70091,-2.70091 0,-10 Z"',third_arc:'d="M 0 -10 A 10 10 0 0 0 -5 8.66"',third_circle:'d="M 0 -10 A 10 10 0 0 0 -5 8.66 L 0 0 Z"',trapezoid:'points="5,-5 10,5 -10,5 -5,-5 5,-5"',triangle:'points="-10,10 10,10 0,-10 -10,10"'},Ma=i=>{switch(i){case"shape://backslash":return"backslash";case"shape://carrow":return"carrow";case"shape://dot":return"circle";case"shape://horline":return"horline";case"shape://oarrow":return"oarrow";case"shape://plus":return"cross";case"shape://slash":return"slash";case"shape://times":case"x":return"cross2";case"shape://vertline":return"line";default:return i}},Hn=i=>i in qn,Pa=(i="circle",t={dimensions:40})=>{const{dimensions:e,fill:n,fillOpacity:r,stroke:s,strokeWidth:o,strokeOpacity:a}=t;if(!Hn(i))throw new Error("Unknown shape: "+i);const c='<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+e+'" viewBox = "-12 -12 24 24">',u="</svg>";let d=qn[i]+" ";d.startsWith("points=")?d='<polygon id="'+i+'" '+d:d.startsWith("x=")?d='<rect id="'+i+'" '+d:d.startsWith("cx=")?d='<circle id="'+i+'" '+d:d='<path id="'+i+'" '+d;let _="";return n&&(_+="fill:"+n+"; "),r&&(_+="fill-opacity:"+r+"; "),s&&(_+="stroke:"+s+"; "),o!==void 0&&o!==0&&(_+="stroke-width:"+o+"; "),a&&(_+="stroke-opacity:"+a+"; "),d+='style="'+_.trim()+'" />',c+d+u},Vn=i=>{try{const e=new DOMParser().parseFromString(i,"application/xml");if(e.querySelector("parsererror"))throw new Error("Invalid XML format");const r=e.querySelector("svg");if(!r)throw new Error("<svg> element not found");const s=r==null?void 0:r.getAttribute("width");if(!s)throw new Error("<svg> element must include dimensions (no width attribute exists)");const o=Array.from(r==null?void 0:r.children).find(g=>g instanceof Element),a=(o==null?void 0:o.getAttribute("id"))??"",u=((o==null?void 0:o.getAttribute("style"))??"").split(";").filter(g=>g.trim()!==""),d={};for(const g of u){const[p,x]=g.split(":").map(C=>C.trim());p&&x&&(d[p]=x)}return{id:a,dimensions:Number(s),...d.fill&&{fill:d.fill},...d["fill-opacity"]&&{fillOpacity:Number(d["fill-opacity"])},...d.stroke&&{stroke:d.stroke},...d["stroke-width"]&&{strokeWidth:Number(d["stroke-width"])},...d["stroke-opacity"]&&{strokeOpacity:Number(d["stroke-opacity"])}}}catch{throw new Error("Error parsing SVG")}};class Da{drawCustom(t,e,n,r,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,n){}drawFeature(t,e,n){}drawGeometryCollection(t,e,n){}drawLineString(t,e,n){}drawMultiLineString(t,e,n){}drawMultiPoint(t,e,n){}drawMultiPolygon(t,e,n){}drawPoint(t,e,n){}drawPolygon(t,e,n){}drawText(t,e,n){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class Ba extends Da{constructor(t,e,n,r,s,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=r,this.transformRotation_=r?Ho(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Be()}drawImages_(t,e,n,r){if(!this.image_)return;const s=Dt(t,e,n,r,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,c=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=c*this.imageOpacity_);let u=this.imageRotation_;this.transformRotation_===0&&(u-=this.viewRotation_),this.imageRotateWithView_&&(u+=this.viewRotation_);for(let d=0,_=s.length;d<_;d+=2){const g=s[d]-this.imageAnchorX_,p=s[d+1]-this.imageAnchorY_;if(u!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const x=g+this.imageAnchorX_,C=p+this.imageAnchorY_;wn(a,x,C,1,1,u,-x,-C),o.save(),o.transform.apply(o,a),o.translate(x,C),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,g,p,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=c)}drawText_(t,e,n,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=Dt(t,e,n,r,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<n;e+=r){const c=s[e]+this.textOffsetX_,u=s[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(c-this.textOffsetX_,u-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,c,u),this.textFillState_&&o.fillText(this.text_,c,u))}}moveToLineTo_(t,e,n,r,s){const o=this.context_,a=Dt(t,e,n,r,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let c=a.length;s&&(c-=2);for(let u=2;u<c;u+=2)o.lineTo(a[u],a[u+1]);return s&&o.closePath(),n}drawRings_(t,e,n,r){for(let s=0,o=n.length;s<o;++s)e=this.moveToLineTo_(t,e,n[s],r,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Mt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=oa(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],r=e[3]-e[1],s=Math.sqrt(n*n+r*r),o=this.context_;o.beginPath(),o.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const n=e.getGeometryFunction()(t);n&&(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,r=e.length;n<r;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Mt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(Mt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,r=t.getFlatCoordinates();let s=0;const o=t.getEnds(),a=t.getStride();n.beginPath();for(let c=0,u=o.length;c<u;++c)s=this.moveToLineTo_(r,s,o[c],a,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Mt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Mt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let r=0;const s=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,c=s.length;a<c;++a){const u=s[a];r=this.drawRings_(n,r,u,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),fn(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,r=t.textAlign?t.textAlign:$n;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=r&&(n.textAlign=r,e.textAlign=r),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:wt(n||re)}}if(!e)this.strokeState_=null;else{const n=e.getColor(),r=e.getLineCap(),s=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),c=e.getWidth(),u=e.getMiterLimit(),d=s||Nn;this.strokeState_={lineCap:r!==void 0?r:se,lineDash:this.pixelRatio_===1?d:d.map(_=>_*this.pixelRatio_),lineDashOffset:(o||Gn)*this.pixelRatio_,lineJoin:a!==void 0?a:oe,lineWidth:(c!==void 0?c:Je)*this.pixelRatio_,miterLimit:u!==void 0?u:He,strokeStyle:wt(n||Ve)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),r=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*n,this.imageAnchorY_=r[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const p=e.getColor();this.textFillState_={fillStyle:wt(p||re)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const p=n.getColor(),x=n.getLineCap(),C=n.getLineDash(),E=n.getLineDashOffset(),I=n.getLineJoin(),F=n.getWidth(),O=n.getMiterLimit();this.textStrokeState_={lineCap:x!==void 0?x:se,lineDash:C||Nn,lineDashOffset:E||Gn,lineJoin:I!==void 0?I:oe,lineWidth:F!==void 0?F:Je,miterLimit:O!==void 0?O:He,strokeStyle:wt(p||Ve)}}const r=t.getFont(),s=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),c=t.getRotation(),u=t.getScaleArray(),d=t.getText(),_=t.getTextAlign(),g=t.getTextBaseline();this.textState_={font:r!==void 0?r:va,textAlign:_!==void 0?_:$n,textBaseline:g!==void 0?g:Ea},this.text_=d!==void 0?Array.isArray(d)?d.reduce((p,x,C)=>p+=C%2?" ":x,""):d:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=c!==void 0?c:0,this.textScale_=[this.pixelRatio_*u[0],this.pixelRatio_*u[1]]}}}function Na(i,t){const e=i.canvas;t=t||{};const n=t.pixelRatio||ma,r=t.size;r&&(e.width=r[0]*n,e.height=r[1]*n,e.style.width=r[0]+"px",e.style.height=r[1]+"px");const s=[0,0,e.width,e.height],o=Oo(Be(),n,n);return new Ba(i,n,s,o,0)}let Ga=class Er extends De{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Er(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Pe(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=Zt(t,st.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?$a(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};function $a(i){if(typeof i=="function")return i;let t;return Array.isArray(i)?t=i:(jt(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[i]),function(){return t}}class Jn{constructor(t){$(this,"unsupportedProperties",{Symbolizer:{MarkSymbolizer:{avoidEdges:"none",blur:"none",offsetAnchor:"none",pitchAlignment:"none",pitchScale:"none"},FillSymbolizer:{antialias:"none",opacity:{support:"none",info:"Use fillOpacity instead."}},IconSymbolizer:{allowOverlap:"none",anchor:"none",avoidEdges:"none",color:"none",haloBlur:"none",haloColor:"none",haloWidth:"none",keepUpright:"none",offsetAnchor:"none",size:{support:"partial",info:"Will set/get the width of the ol Icon."},optional:"none",padding:"none",pitchAlignment:"none",rotationAlignment:"none",textFit:"none",textFitPadding:"none"},LineSymbolizer:{blur:"none",gapWidth:"none",gradient:"none",miterLimit:"none",roundLimit:"none",spacing:"none",graphicFill:"none",graphicStroke:"none",perpendicularOffset:"none"},RasterSymbolizer:"none",TextSymbolizer:{anchor:"none",placement:{support:"partial",info:"point and line supported. line-center will be mapped to line."}}},Function:{double2bool:{support:"none",info:"Always returns false"},atan2:{support:"none",info:"Currently returns the first argument"},rint:{support:"none",info:"Currently returns the first argument"},numberFormat:{support:"none",info:"Currently returns the first argument"},strAbbreviate:{support:"none",info:"Currently returns the first argument"}}});$(this,"title","OpenLayers Style Parser");$(this,"olIconStyleCache",{});$(this,"OlStyleConstructor",he);$(this,"OlStyleImageConstructor",Bt);$(this,"OlStyleFillConstructor",le);$(this,"OlStyleStrokeConstructor",Ze);$(this,"OlStyleTextConstructor",je);$(this,"OlStyleCircleConstructor",Ke);$(this,"OlStyleIconConstructor",ce);$(this,"OlStyleRegularshapeConstructor",ae);$(this,"isOlParserStyleFct",t=>typeof t=="function");t&&(this.OlStyleConstructor=t.style.Style,this.OlStyleImageConstructor=t.style.Image,this.OlStyleFillConstructor=t.style.Fill,this.OlStyleStrokeConstructor=t.style.Stroke,this.OlStyleTextConstructor=t.style.Text,this.OlStyleCircleConstructor=t.style.Circle,this.OlStyleIconConstructor=t.style.Icon,this.OlStyleRegularshapeConstructor=t.style.RegularShape)}getPointSymbolizerFromOlStyle(t){let e;if(t.getImage()instanceof this.OlStyleCircleConstructor){const n=t.getImage(),r=n.getFill(),s=n.getStroke(),o=n.getDisplacement();e={kind:"Mark",wellKnownName:"circle",color:r?v.getHexColor(r.getColor()):void 0,opacity:n.getOpacity()!==1?n.getOpacity():void 0,fillOpacity:r?v.getOpacity(r.getColor()):void 0,radius:n.getRadius()!==0?n.getRadius():5,strokeColor:s?s.getColor():void 0,strokeOpacity:s?v.getOpacity(s.getColor()):void 0,strokeWidth:s?s.getWidth():void 0,offset:o[0]||o[1]?o:void 0}}else if(t.getImage()instanceof this.OlStyleRegularshapeConstructor){const n=t.getImage(),r=n.getFill(),s=n.getStroke(),o=n.getRadius(),a=n.getRadius2(),c=n.getPoints(),u=n.getAngle(),d=n.getDisplacement(),_={kind:"Mark",color:r?v.getHexColor(r.getColor()):void 0,opacity:n.getOpacity()!==1?n.getOpacity():void 0,fillOpacity:r?v.getOpacity(r.getColor()):void 0,strokeColor:s?s.getColor():void 0,strokeOpacity:s?v.getOpacity(s.getColor()):void 0,strokeWidth:s?s.getWidth():void 0,radius:o!==0?o:5,rotate:n.getRotation()/Math.PI*180,offset:d[0]||d[1]?d:void 0};switch(c){case 2:switch(u){case 0:_.wellKnownName="shape://vertline";break;case Math.PI/2:_.wellKnownName="shape://horline";break;case Math.PI/4:_.wellKnownName="shape://slash";break;case 2*Math.PI-Math.PI/4:_.wellKnownName="shape://backslash";break}break;case 3:switch(u){case 0:_.wellKnownName="triangle";break;case Math.PI/2:_.wellKnownName="shape://carrow";break}break;case 4:Number.isFinite(a)?n.getAngle()===0?_.wellKnownName="cross":_.wellKnownName="x":_.wellKnownName="square";break;case 5:_.wellKnownName="star";break;default:throw new Error("Could not parse OlStyle. Only 2, 3, 4 or 5 point regular shapes are allowed")}e=_}else if(t.getText()instanceof this.OlStyleTextConstructor){const n=t.getText(),r=n.getFill(),s=n.getStroke(),o=n.getRotation();let a=n.getText()||"a";const c=n.getFont()||"10px sans-serif",u=v.getFontNameFromOlFont(c),d=v.getSizeFromOlFont(c),_=[n.getOffsetX(),n.getOffsetY()];Array.isArray(a)&&(a=a[0]),e={kind:"Mark",wellKnownName:`ttf://${u}#0x${a.charCodeAt(0).toString(16)}`,color:r?v.getHexColor(r.getColor()):void 0,opacity:r?v.getOpacity(r.getColor()):void 0,strokeColor:s?s.getColor():void 0,strokeOpacity:s?v.getOpacity(s.getColor()):void 0,strokeWidth:s?s.getWidth():void 0,radius:d!==0?d:5,rotate:o?o/Math.PI*180:0,offset:_[0]||_[1]?_:void 0}}else{const n=t.getImage(),r=n.getDisplacement();let s=n.getWidth();const o=n.getRotation()/Math.PI*180,a=n.getOpacity();try{const c=v.getBase64DecodedSvg(n.getSrc()),{id:u,dimensions:d,fill:_,stroke:g,strokeWidth:p}=Vn(c),x=g&&v.getOpacity(g)!==1?v.getOpacity(g):void 0;e={kind:"Mark",wellKnownName:u,..._&&{color:_},...a!==void 0&&a!==1&&{opacity:a},...g&&{strokeColor:g.substring(0,7)},...p!==void 0&&{strokeWidth:p},...x!==void 0&&{strokeOpacity:x},...d/2!==0&&{radius:d/2},...o!==void 0&&o!==0&&{rotate:o},...(r[0]||r[1])&&{offset:r}}}catch{e={kind:"Icon",image:this.getImageFromIconStyle(n),opacity:a<1?a:void 0,size:s,rotate:o!==0?o:void 0,offset:r[0]||r[1]?r:void 0}}}return e}getImageFromIconStyle(t){const e=t.getSize();if(Array.isArray(e)){let n=t.offset_;const r=t.offsetOrigin_;if(r&&r!=="top-left")throw new Error(`Offset origin ${r} not supported`);return{source:t.getSrc(),position:n,size:e}}else return t.getSrc()?t.getSrc():void 0}getLineSymbolizerFromOlStyle(t){const e=t.getStroke(),n=e?e.getLineDash():void 0;return{kind:"Line",color:e?v.getHexColor(e.getColor()):void 0,opacity:e?v.getOpacity(e.getColor()):void 0,width:e?e.getWidth():void 0,cap:e?e.getLineCap():"butt",join:e?e.getLineJoin():"miter",dasharray:n||void 0,dashOffset:e?e.getLineDashOffset():void 0}}getFillSymbolizerFromOlStyle(t){const e=t.getFill(),n=t.getStroke(),r=n?n.getLineDash():void 0,s={kind:"Fill"};return e&&(s.color=v.getHexColor(e.getColor())),e&&(s.fillOpacity=v.getOpacity(e.getColor())),n&&(s.outlineColor=v.getHexColor(n.getColor())),r&&(s.outlineDasharray=r),n&&(s.outlineOpacity=v.getOpacity(n.getColor())),n&&n.getWidth()&&(s.outlineWidth=n.getWidth()),s}getTextSymbolizerFromOlStyle(t){const e=t.getText();if(!e)throw new Error("Could not get text from olStyle.");const n=e.getFill(),r=e.getStroke(),s=e.getOffsetX(),o=e.getOffsetY(),a=e.getFont(),c=e.getRotation(),u=e.getOverflow()?e.getOverflow():void 0,d=e.getPlacement(),_=e.getText(),g=Array.isArray(_)?_[0]:_;let p=1/0,x,C,E;if(a){const I=po(a);if(I["font-weight"]&&(C=I["font-weight"]),I["font-size"]&&(p=parseInt(I["font-size"],10)),I["font-family"]){const F=I["font-family"];x=F==null?void 0:F.map(O=>O.includes(" ")?'"'+O+'"':O)}I["font-style"]&&(E=I["font-style"])}return{kind:"Text",label:g,placement:d,allowOverlap:u,color:n?v.getHexColor(n.getColor()):void 0,size:isFinite(p)?p:void 0,font:x,fontWeight:C||void 0,fontStyle:E||void 0,offset:s!==void 0&&o!==void 0?[s,o]:[0,0],haloColor:r&&r.getColor()?v.getHexColor(r.getColor()):void 0,haloWidth:r?r.getWidth():void 0,rotate:c!==void 0?c/Math.PI*180:void 0}}getSymbolizersFromOlStyle(t){const e=[];return t.forEach(n=>{let r;switch(this.getStyleTypeFromOlStyle(n)){case"Point":n.getText()&&!v.getIsMarkSymbolizerFont(n.getText().getFont())?r=this.getTextSymbolizerFromOlStyle(n):r=this.getPointSymbolizerFromOlStyle(n);break;case"Line":r=this.getLineSymbolizerFromOlStyle(n);break;case"Fill":r=this.getFillSymbolizerFromOlStyle(n);break;default:throw new Error("Failed to parse SymbolizerKind from OpenLayers Style")}e.push(r)}),e}getRuleFromOlStyle(t){let e;const n="OL Style Rule 0";return Array.isArray(t)?e=this.getSymbolizersFromOlStyle(t):e=this.getSymbolizersFromOlStyle([t]),{name:n,symbolizers:e}}getStyleTypeFromOlStyle(t){let e;if(t.getImage()instanceof this.OlStyleImageConstructor)e="Point";else if(t.getText()instanceof this.OlStyleTextConstructor)e="Point";else if(t.getFill()instanceof this.OlStyleFillConstructor)e="Fill";else if(t.getStroke()&&!t.getFill())e="Line";else throw new Error("StyleType could not be detected");return e}olStyleToGeoStylerStyle(t){const e="OL Style",n=this.getRuleFromOlStyle(t);return{name:e,rules:[n]}}readStyle(t){return new Promise(e=>{try{if(this.isOlParserStyleFct(t))e({output:t.__geoStylerStyle});else{t=t;const n=this.olStyleToGeoStylerStyle(t),r=this.checkForUnsupportedProperties(n);e({output:n,unsupportedProperties:r})}}catch(n){e({errors:[n]})}})}writeStyle(t){return new Promise(async e=>{const n=structuredClone(t),r=this.checkForUnsupportedProperties(n);try{const s=await this.getOlStyleTypeFromGeoStylerStyle(n);e({output:s,unsupportedProperties:r,warnings:r&&["Your style contains unsupportedProperties!"]})}catch(s){e({errors:[s]})}})}checkForUnsupportedProperties(t){const e=r=>r[0].toUpperCase()+r.slice(1),n={};if(t.rules.forEach(r=>{r.symbolizers.forEach(s=>{var c,u;const o=e(`${s.kind}Symbolizer`),a=(u=(c=this.unsupportedProperties)==null?void 0:c.Symbolizer)==null?void 0:u[o];a&&(typeof a=="string"?(n.Symbolizer||(n.Symbolizer={}),n.Symbolizer[o]=a):Object.keys(s).forEach(d=>{a[d]&&(n.Symbolizer||(n.Symbolizer={}),n.Symbolizer[o]||(n.Symbolizer[o]={}),n.Symbolizer[o][d]=a[d])}))})}),Object.keys(n).length>0)return n}async getOlStyleTypeFromGeoStylerStyle(t){var r,s,o,a,c,u,d,_;const e=t.rules;if(e.length===1){const g=((s=(r=t==null?void 0:t.rules)==null?void 0:r[0])==null?void 0:s.filter)!==void 0,p=((c=(a=(o=t==null?void 0:t.rules)==null?void 0:o[0])==null?void 0:a.scaleDenominator)==null?void 0:c.min)!==void 0,x=((_=(d=(u=t==null?void 0:t.rules)==null?void 0:u[0])==null?void 0:d.scaleDenominator)==null?void 0:_.max)!==void 0,C=!!(p||x),E=v.containsGeoStylerFunctions(t),I=t.rules[0].symbolizers.length,F=e[0].symbolizers.some(B=>B.kind==="Text"),O=e[0].symbolizers.some(B=>B.kind==="Icon"&&typeof B.image=="string"&&B.image.includes("{{"));return!g&&!C&&!F&&!O&&!E?I===1?await this.geoStylerStyleToOlStyle(t):await this.geoStylerStyleToOlStyleArray(t):await this.geoStylerStyleToOlParserStyleFct(t)}else return await this.geoStylerStyleToOlParserStyleFct(t)}async geoStylerStyleToOlStyle(t){const n=t.rules[0].symbolizers[0];return await this.getOlSymbolizerFromSymbolizer(n)}async geoStylerStyleToOlStyleArray(t){const e=t.rules[0],n=[];return e.symbolizers.forEach(async r=>{const s=await this.getOlSymbolizerFromSymbolizer(r);n.push(s)}),n}async geoStylerStyleToOlParserStyleFct(t){const e=structuredClone(t.rules),r=(s,o)=>{const a=[],c=90.7142857142857,u=vn.m,_=o*u*39.37*c;return e.forEach(g=>{var I,F;let p=(I=g==null?void 0:g.scaleDenominator)==null?void 0:I.min,x=(F=g==null?void 0:g.scaleDenominator)==null?void 0:F.max,C=!0;(p||x)&&(p=N(p)?v.evaluateNumberFunction(p):p,x=N(x)?v.evaluateNumberFunction(x):x,p&&_<p&&(C=!1),x&&_>=x&&(C=!1));let E=!1;if(!g.filter)E=!0;else try{E=this.geoStylerFilterToOlParserFilter(s,g.filter)}catch{E=!1}C&&E&&g.symbolizers.forEach(async O=>{O.visibility===!1&&a.push(null),mt(O.visibility)&&(v.evaluateBooleanFunction(O.visibility)||a.push(null));const B=await this.getOlSymbolizerFromSymbolizer(O,s);if(typeof B!="function")a.push(B);else{const G=B(s,o);a.push(G)}})}),a};return r.__geoStylerStyle=t,r}geoStylerFilterToOlParserFilter(t,e){const n={"&&":!0,"||":!0,"!":!0};let r=!0;if(mt(e))return v.evaluateBooleanFunction(e,t);if(e===!0||e===!1)return e;const s=e[0];let o=!1;n[s]&&(o=!0);try{if(o){let a,c;switch(e[0]){case"&&":a=!0,c=e.slice(1),c.forEach(u=>{this.geoStylerFilterToOlParserFilter(t,u)||(a=!1)}),r=a;break;case"||":a=!1,c=e.slice(1),c.forEach(u=>{this.geoStylerFilterToOlParserFilter(t,u)&&(a=!0)}),r=a;break;case"!":r=!this.geoStylerFilterToOlParserFilter(t,e[1]);break;default:throw new Error("Cannot parse Filter. Unknown combination or negation operator.")}}else{let a;N(e[1])?a=v.evaluateFunction(e[1],t):a=t.get(e[1]);let c;switch(N(e[2])?c=v.evaluateFunction(e[2],t):c=e[2],e[0]){case"==":r=""+a==""+c;break;case"*=":typeof c=="string"&&typeof a=="string"&&(c.length>a.length?r=!1:r=a.indexOf(c)!==-1);break;case"!=":r=""+a!=""+c;break;case"<":r=Number(a)<Number(c);break;case"<=":r=Number(a)<=Number(c);break;case">":r=Number(a)>Number(c);break;case">=":r=Number(a)>=Number(c);break;default:throw new Error("Cannot parse Filter. Unknown comparison operator.")}}}catch{throw new Error("Cannot parse Filter. Invalid structure.")}return r}async getOlSymbolizerFromSymbolizer(t,e){let n;switch(t=structuredClone(t),t.kind){case"Mark":n=await this.getOlPointSymbolizerFromMarkSymbolizer(t,e);break;case"Icon":n=await this.getOlIconSymbolizerFromIconSymbolizer(t,e);break;case"Text":n=this.getOlTextSymbolizerFromTextSymbolizer(t,e);break;case"Line":n=this.getOlLineSymbolizerFromLineSymbolizer(t,e);break;case"Fill":n=await this.getOlPolygonSymbolizerFromFillSymbolizer(t,e);break;default:const r=new this.OlStyleFillConstructor({color:"rgba(255,255,255,0.4)"}),s=new this.OlStyleStrokeConstructor({color:"#3399CC",width:1.25});n=new this.OlStyleConstructor({image:new this.OlStyleCircleConstructor({fill:r,stroke:s,radius:5}),fill:r,stroke:s});break}return n}async getOlPointSymbolizerFromMarkSymbolizer(t,e){for(const g of Object.keys(t))N(t[g])&&(t[g]=v.evaluateFunction(t[g],e));const n=t.strokeColor,r=t.strokeOpacity,s=t.strokeWidth,o=t.color,a=t.fillOpacity,c=Number(t.rotate)*Math.PI/180,u=t.offset;let d,_=Ma(t.wellKnownName);if(Hn(_)){const g=((t==null?void 0:t.radius)??6)*2,p=t.opacity,x={dimensions:g,...o&&{fill:o},...a&&{fillOpacity:a},...n&&{stroke:n},...s&&{strokeWidth:s},...r&&{strokeOpacity:r}},C=Pa(_,x);d=new this.OlStyleConstructor({image:new this.OlStyleIconConstructor({src:v.getBase64EncodedSvg(C),crossOrigin:"anonymous",...u&&{displacement:u},...p&&Number.isFinite(p)&&{opacity:p},...c&&{rotation:c},scale:1})})}else if(v.getIsFontGlyphBased(t)){const g=n&&r?v.getRgbaColor(n,r):n,p=o&&a?v.getRgbaColor(o,a):o,x=new this.OlStyleStrokeConstructor({...g&&{color:g},...s&&{width:s}}),C=new this.OlStyleFillConstructor({...p&&{color:p}});d=new this.OlStyleConstructor({text:new this.OlStyleTextConstructor({text:v.getCharacterForMarkSymbolizer(t),font:v.getTextFontForMarkSymbolizer(t),...C&&{fill:C},...u&&{offsetX:u[0]},...u&&{offsetY:u[1]},...x&&{stroke:x},...c&&{rotation:c}})})}else throw new Error("MarkSymbolizer cannot be parsed. Unsupported WellKnownName.");return d}async getOlIconSymbolizerFromIconSymbolizer(t,e){for(const c of Object.keys(t))N(t[c])&&(t[c]=v.evaluateFunction(t[c],e));const n={src:Me(t.image)?t.image.source:t.image,crossOrigin:"anonymous",opacity:t.opacity,width:t.size,rotation:typeof t.rotate=="number"?t.rotate*Math.PI/180:void 0,displacement:t.offset,size:Me(t.image)?t.image.size:void 0,offset:Me(t.image)?t.image.position:void 0},r="\\{\\{",s="\\}\\}",o=new RegExp(r+".*?"+s,"g");return(typeof t.image=="string"?t.image.match(o):null)?u=>{let d=v.resolveAttributeTemplate(u,t.image,"");d||(d=t.image+"");let _;return this.olIconStyleCache[d]?(_=this.olIconStyleCache[d],n.rotation!==void 0&&_.setRotation(n.rotation),n.opacity!==void 0&&_.setOpacity(n.opacity)):(_=new this.OlStyleIconConstructor({...n,src:d}),this.olIconStyleCache[d]=_),new this.OlStyleConstructor({image:_})}:new this.OlStyleConstructor({image:new this.OlStyleIconConstructor({...n})})}getOlLineSymbolizerFromLineSymbolizer(t,e){for(const o of Object.keys(t))N(t[o])&&(t[o]=v.evaluateFunction(t[o],e));const n=t.color,r=t.opacity,s=n&&r!==null&&r!==void 0?v.getRgbaColor(n,r):n;return new this.OlStyleConstructor({stroke:new this.OlStyleStrokeConstructor({color:s,width:t.width,lineCap:t.cap,lineJoin:t.join,lineDash:t.dasharray,lineDashOffset:t.dashOffset})})}async getOlPolygonSymbolizerFromFillSymbolizer(t,e){for(const g of Object.keys(t))N(t[g])&&(t[g]=v.evaluateFunction(t[g],e));const n=t.color,r=t.fillOpacity,s=n&&Number.isFinite(r)?v.getRgbaColor(n,r):n;let o=n?new this.OlStyleFillConstructor({color:s}):void 0;const a=t.outlineColor,c=t.outlineOpacity,u=a&&Number.isFinite(c)?v.getRgbaColor(a,c):a,d=a||t.outlineWidth?new this.OlStyleStrokeConstructor({color:u,width:t.outlineWidth,lineDash:t.outlineDasharray}):void 0,_=new this.OlStyleConstructor({fill:o,stroke:d});if(t.graphicFill){const g=this.getOlPatternFromGraphicFill(t.graphicFill);o||(o=new this.OlStyleFillConstructor({})),g&&o.setColor(await g),_.setFill(o)}return _}async getOlPatternFromGraphicFill(t){let e,n=[16,16];const r=new Image;if(on(t)){e=await this.getOlIconSymbolizerFromIconSymbolizer(t);const g=e==null?void 0:e.getImage();if(await(g==null?void 0:g.load()),(g==null?void 0:g.getImageState())!==L.LOADED)return null;n=e.getSize()}else if(an(t)){e=await this.getOlPointSymbolizerFromMarkSymbolizer(t);const g=e.getImage().getSrc(),p=v.getBase64DecodedSvg(g);r.src=g;const{dimensions:x}=Vn(p);x&&(n=[x,x])}else return null;console.log("ZZZ - graphicFillStyle",e);const s=e.clone(),o=s.getImage(),c=document.createElement("canvas").getContext("2d"),u=o.getScale()||1,d=u;o.setScale(1);const _=Na(c,{pixelRatio:d,size:n});return o.onload=()=>{const g=n.map(x=>x/2),p=new Ga(new $e(g));console.log("ZZZ - pointCoords",g),_.drawFeature(p,s),console.log("ZZZ - graphicFillStyle2",s,_,u)},new Promise((g,p)=>{const x=document.createElement("canvas"),C=x.getContext("2d");if(!C){p(new Error("Failed to get canvas context"));return}r.onload=()=>{x.width=30,x.height=30,C.drawImage(r,0,0);const E=C.createPattern(x,"repeat");if(!E){p(new Error("Failed to create pattern"));return}g(E)},r.onerror=E=>{p(new Error("Failed to load SVG image: "+E))}})}getOlTextSymbolizerFromTextSymbolizer(t,e){for(const C of Object.keys(t))N(t[C])&&(t[C]=v.evaluateFunction(t[C],e));const n=t.color;let r=t.placement;r||(r="point"),r==="line-center"&&(r="line");const s=t.opacity,o=n&&Number.isFinite(s)?v.getRgbaColor(n,s):n,a=t.haloColor,c=t.haloWidth,u=a&&Number.isFinite(s)?v.getRgbaColor(a,s):a,d={font:v.getTextFont(t),fill:new this.OlStyleFillConstructor({color:o}),stroke:new this.OlStyleStrokeConstructor({color:u,width:c||0}),overflow:t.allowOverlap,offsetX:t.offset?t.offset[0]:0,offsetY:t.offset?t.offset[1]:0,rotation:typeof t.rotate=="number"?t.rotate*Math.PI/180:void 0,placement:r},_="\\{\\{",g="\\}\\}",p=new RegExp(_+".*?"+g,"g");let x;return Tt(t.label)||(x=t.label?t.label.match(p):null),x?E=>{const I=new this.OlStyleTextConstructor({text:v.resolveAttributeTemplate(E,t.label,""),...d});return new this.OlStyleConstructor({text:I})}:new this.OlStyleConstructor({text:new this.OlStyleTextConstructor({text:t.label,...d})})}}$(Jn,"title","OpenLayers Style Parser");class ni extends pe{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new ni(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(_e(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=Wt(t,It.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Wa(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Wa(i){if(typeof i=="function")return i;let t;return Array.isArray(i)?t=i:(Hr(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[i]),function(){return t}}var ri="http://www.w3.org/1999/xhtml",Kn={svg:"http://www.w3.org/2000/svg",xhtml:ri,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Zn(i){var t=i+="",e=t.indexOf(":");return e>=0&&(t=i.slice(0,e))!=="xmlns"&&(i=i.slice(e+1)),Kn.hasOwnProperty(t)?{space:Kn[t],local:i}:i}function za(i){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===ri&&t.documentElement.namespaceURI===ri?t.createElement(i):t.createElementNS(e,i)}}function Ua(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function jn(i){var t=Zn(i);return(t.local?Ua:za)(t)}function Xa(){}function Qn(i){return i==null?Xa:function(){return this.querySelector(i)}}function Ya(i){typeof i!="function"&&(i=Qn(i));for(var t=this._groups,e=t.length,n=new Array(e),r=0;r<e;++r)for(var s=t[r],o=s.length,a=n[r]=new Array(o),c,u,d=0;d<o;++d)(c=s[d])&&(u=i.call(c,c.__data__,d,s))&&("__data__"in c&&(u.__data__=c.__data__),a[d]=u);return new q(n,this._parents)}function tr(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function qa(){return[]}function Ha(i){return i==null?qa:function(){return this.querySelectorAll(i)}}function Va(i){return function(){var t=i.apply(this,arguments);return t==null?[]:tr(t)}}function Ja(i){typeof i=="function"?i=Va(i):i=Ha(i);for(var t=this._groups,e=t.length,n=[],r=[],s=0;s<e;++s)for(var o=t[s],a=o.length,c,u=0;u<a;++u)(c=o[u])&&(n.push(i.call(c,c.__data__,u,o)),r.push(c));return new q(n,r)}function Ka(i){return function(){return this.matches(i)}}function er(i){return function(t){return t.matches(i)}}var Za=Array.prototype.find;function ja(i){return function(){return Za.call(this.children,i)}}function Qa(){return this.firstElementChild}function tl(i){return this.select(i==null?Qa:ja(typeof i=="function"?i:er(i)))}var el=Array.prototype.filter;function il(){return this.children}function nl(i){return function(){return el.call(this.children,i)}}function rl(i){return this.selectAll(i==null?il:nl(typeof i=="function"?i:er(i)))}function sl(i){typeof i!="function"&&(i=Ka(i));for(var t=this._groups,e=t.length,n=new Array(e),r=0;r<e;++r)for(var s=t[r],o=s.length,a=n[r]=[],c,u=0;u<o;++u)(c=s[u])&&i.call(c,c.__data__,u,s)&&a.push(c);return new q(n,this._parents)}function ir(i){return new Array(i.length)}function ol(){return new q(this._enter||this._groups.map(ir),this._parents)}function fe(i,t){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=t}fe.prototype={constructor:fe,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,t){return this._parent.insertBefore(i,t)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function al(i){return function(){return i}}function ll(i,t,e,n,r,s){for(var o=0,a,c=t.length,u=s.length;o<u;++o)(a=t[o])?(a.__data__=s[o],n[o]=a):e[o]=new fe(i,s[o]);for(;o<c;++o)(a=t[o])&&(r[o]=a)}function hl(i,t,e,n,r,s,o){var a,c,u=new Map,d=t.length,_=s.length,g=new Array(d),p;for(a=0;a<d;++a)(c=t[a])&&(g[a]=p=o.call(c,c.__data__,a,t)+"",u.has(p)?r[a]=c:u.set(p,c));for(a=0;a<_;++a)p=o.call(i,s[a],a,s)+"",(c=u.get(p))?(n[a]=c,c.__data__=s[a],u.delete(p)):e[a]=new fe(i,s[a]);for(a=0;a<d;++a)(c=t[a])&&u.get(g[a])===c&&(r[a]=c)}function cl(i){return i.__data__}function ul(i,t){if(!arguments.length)return Array.from(this,cl);var e=t?hl:ll,n=this._parents,r=this._groups;typeof i!="function"&&(i=al(i));for(var s=r.length,o=new Array(s),a=new Array(s),c=new Array(s),u=0;u<s;++u){var d=n[u],_=r[u],g=_.length,p=tr(i.call(d,d&&d.__data__,u,n)),x=p.length,C=a[u]=new Array(x),E=o[u]=new Array(x),I=c[u]=new Array(g);e(d,_,C,E,I,p,t);for(var F=0,O=0,B,G;F<x;++F)if(B=C[F]){for(F>=O&&(O=F+1);!(G=E[O])&&++O<x;);B._next=G||null}}return o=new q(o,n),o._enter=a,o._exit=c,o}function fl(){return new q(this._exit||this._groups.map(ir),this._parents)}function dl(i,t,e){var n=this.enter(),r=this,s=this.exit();return n=typeof i=="function"?i(n):n.append(i+""),t!=null&&(r=t(r)),e==null?s.remove():e(s),n&&r?n.merge(r).order():r}function gl(i){if(!(i instanceof q))throw new Error("invalid merge");for(var t=this._groups,e=i._groups,n=t.length,r=e.length,s=Math.min(n,r),o=new Array(n),a=0;a<s;++a)for(var c=t[a],u=e[a],d=c.length,_=o[a]=new Array(d),g,p=0;p<d;++p)(g=c[p]||u[p])&&(_[p]=g);for(;a<n;++a)o[a]=t[a];return new q(o,this._parents)}function ml(){for(var i=this._groups,t=-1,e=i.length;++t<e;)for(var n=i[t],r=n.length-1,s=n[r],o;--r>=0;)(o=n[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function _l(i){i||(i=pl);function t(_,g){return _&&g?i(_.__data__,g.__data__):!_-!g}for(var e=this._groups,n=e.length,r=new Array(n),s=0;s<n;++s){for(var o=e[s],a=o.length,c=r[s]=new Array(a),u,d=0;d<a;++d)(u=o[d])&&(c[d]=u);c.sort(t)}return new q(r,this._parents).order()}function pl(i,t){return i<t?-1:i>t?1:i>=t?0:NaN}function yl(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function wl(){return Array.from(this)}function xl(){for(var i=this._groups,t=0,e=i.length;t<e;++t)for(var n=i[t],r=0,s=n.length;r<s;++r){var o=n[r];if(o)return o}return null}function Sl(){let i=0;for(const t of this)++i;return i}function Cl(){return!this.node()}function vl(i){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],s=0,o=r.length,a;s<o;++s)(a=r[s])&&i.call(a,a.__data__,s,r);return this}function El(i){return function(){this.removeAttribute(i)}}function Il(i){return function(){this.removeAttributeNS(i.space,i.local)}}function Fl(i,t){return function(){this.setAttribute(i,t)}}function Al(i,t){return function(){this.setAttributeNS(i.space,i.local,t)}}function Ol(i,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(i):this.setAttribute(i,e)}}function Ll(i,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,e)}}function kl(i,t){var e=Zn(i);if(arguments.length<2){var n=this.node();return e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}return this.each((t==null?e.local?Il:El:typeof t=="function"?e.local?Ll:Ol:e.local?Al:Fl)(e,t))}function nr(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function bl(i){return function(){this.style.removeProperty(i)}}function Rl(i,t,e){return function(){this.style.setProperty(i,t,e)}}function Tl(i,t,e){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(i):this.style.setProperty(i,n,e)}}function Ml(i,t,e){return arguments.length>1?this.each((t==null?bl:typeof t=="function"?Tl:Rl)(i,t,e??"")):Pl(this.node(),i)}function Pl(i,t){return i.style.getPropertyValue(t)||nr(i).getComputedStyle(i,null).getPropertyValue(t)}function Dl(i){return function(){delete this[i]}}function Bl(i,t){return function(){this[i]=t}}function Nl(i,t){return function(){var e=t.apply(this,arguments);e==null?delete this[i]:this[i]=e}}function Gl(i,t){return arguments.length>1?this.each((t==null?Dl:typeof t=="function"?Nl:Bl)(i,t)):this.node()[i]}function rr(i){return i.trim().split(/^|\s+/)}function si(i){return i.classList||new sr(i)}function sr(i){this._node=i,this._names=rr(i.getAttribute("class")||"")}sr.prototype={add:function(i){var t=this._names.indexOf(i);t<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var t=this._names.indexOf(i);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function or(i,t){for(var e=si(i),n=-1,r=t.length;++n<r;)e.add(t[n])}function ar(i,t){for(var e=si(i),n=-1,r=t.length;++n<r;)e.remove(t[n])}function $l(i){return function(){or(this,i)}}function Wl(i){return function(){ar(this,i)}}function zl(i,t){return function(){(t.apply(this,arguments)?or:ar)(this,i)}}function Ul(i,t){var e=rr(i+"");if(arguments.length<2){for(var n=si(this.node()),r=-1,s=e.length;++r<s;)if(!n.contains(e[r]))return!1;return!0}return this.each((typeof t=="function"?zl:t?$l:Wl)(e,t))}function Xl(){this.textContent=""}function Yl(i){return function(){this.textContent=i}}function ql(i){return function(){var t=i.apply(this,arguments);this.textContent=t??""}}function Hl(i){return arguments.length?this.each(i==null?Xl:(typeof i=="function"?ql:Yl)(i)):this.node().textContent}function Vl(){this.innerHTML=""}function Jl(i){return function(){this.innerHTML=i}}function Kl(i){return function(){var t=i.apply(this,arguments);this.innerHTML=t??""}}function Zl(i){return arguments.length?this.each(i==null?Vl:(typeof i=="function"?Kl:Jl)(i)):this.node().innerHTML}function jl(){this.nextSibling&&this.parentNode.appendChild(this)}function Ql(){return this.each(jl)}function th(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function eh(){return this.each(th)}function ih(i){var t=typeof i=="function"?i:jn(i);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function nh(){return null}function rh(i,t){var e=typeof i=="function"?i:jn(i),n=t==null?nh:typeof t=="function"?t:Qn(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),n.apply(this,arguments)||null)})}function sh(){var i=this.parentNode;i&&i.removeChild(this)}function oh(){return this.each(sh)}function ah(){var i=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(i,this.nextSibling):i}function lh(){var i=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(i,this.nextSibling):i}function hh(i){return this.select(i?lh:ah)}function ch(i){return arguments.length?this.property("__data__",i):this.node().__data__}function uh(i){return function(t){i.call(this,t,this.__data__)}}function fh(i){return i.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}function dh(i){return function(){var t=this.__on;if(t){for(var e=0,n=-1,r=t.length,s;e<r;++e)s=t[e],(!i.type||s.type===i.type)&&s.name===i.name?this.removeEventListener(s.type,s.listener,s.options):t[++n]=s;++n?t.length=n:delete this.__on}}}function gh(i,t,e){return function(){var n=this.__on,r,s=uh(t);if(n){for(var o=0,a=n.length;o<a;++o)if((r=n[o]).type===i.type&&r.name===i.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=e),r.value=t;return}}this.addEventListener(i.type,s,e),r={type:i.type,name:i.name,value:t,listener:s,options:e},n?n.push(r):this.__on=[r]}}function mh(i,t,e){var n=fh(i+""),r,s=n.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,u=a.length,d;c<u;++c)for(r=0,d=a[c];r<s;++r)if((o=n[r]).type===d.type&&o.name===d.name)return d.value}return}for(a=t?gh:dh,r=0;r<s;++r)this.each(a(n[r],t,e));return this}function lr(i,t,e){var n=nr(i),r=n.CustomEvent;typeof r=="function"?r=new r(t,e):(r=n.document.createEvent("Event"),e?(r.initEvent(t,e.bubbles,e.cancelable),r.detail=e.detail):r.initEvent(t,!1,!1)),i.dispatchEvent(r)}function _h(i,t){return function(){return lr(this,i,t)}}function ph(i,t){return function(){return lr(this,i,t.apply(this,arguments))}}function yh(i,t){return this.each((typeof t=="function"?ph:_h)(i,t))}function*wh(){for(var i=this._groups,t=0,e=i.length;t<e;++t)for(var n=i[t],r=0,s=n.length,o;r<s;++r)(o=n[r])&&(yield o)}var xh=[null];function q(i,t){this._groups=i,this._parents=t}function Sh(){return this}q.prototype={constructor:q,select:Ya,selectAll:Ja,selectChild:tl,selectChildren:rl,filter:sl,data:ul,enter:ol,exit:fl,join:dl,merge:gl,selection:Sh,order:ml,sort:_l,call:yl,nodes:wl,node:xl,size:Sl,empty:Cl,each:vl,attr:kl,style:Ml,property:Gl,classed:Ul,text:Hl,html:Zl,raise:Ql,lower:eh,append:ih,insert:rh,remove:oh,clone:hh,datum:ch,on:mh,dispatch:yh,[Symbol.iterator]:wh};function oi(i){return typeof i=="string"?new q([[document.querySelector(i)]],[document.documentElement]):new q([[i]],xh)}class hr{constructor(t,e,n){this.size=t,this.maxColumnWidth=e,this.maxColumnHeight=n}}const cr="geostyler-legend-renderer";class Ch extends hr{constructor(e,n,r,s){super(e,n||0,r||0);$(this,"root",null);$(this,"currentContainer",null);const o=document.createElementNS("http://www.w3.org/2000/svg","svg");this.root=oi(o).attr("class",cr).attr("viewBox",`0 0 ${e[0]} ${e[1]}`).attr("top",0).attr("left",0).attr("width",e[0]).attr("height",e[1]),this.currentContainer=this.root,s&&(oi(s).select(`.${cr}`).remove(),s.append(this.root.node()))}useContainer(e){var n;this.currentContainer=(n=this.root)==null?void 0:n.append("g").attr("class","legend-item").attr("title",e)}useRoot(){this.currentContainer=this.root}addTitle(e,n,r){var s;(s=this.currentContainer)==null||s.append("g").append("text").text(e).attr("class","legend-title").attr("text-anchor","start").attr("dx",n).attr("dy",r)}addLabel(e,n,r){var s;(s=this.currentContainer)==null||s.append("text").text(e).attr("x",n).attr("y",r)}addImage(e,n,r,s,o,a){var c,u,d;return a&&((c=this.currentContainer)==null||c.append("rect").attr("x",s).attr("y",o).attr("width",n).attr("height",r).style("fill-opacity",0).style("stroke","black")),(u=this.currentContainer)==null||u.append("svg:image").attr("x",s).attr("y",o).attr("width",n).attr("height",r).attr("href",e),(d=this.root)==null||d.attr("xmlns","http://www.w3.org/2000/svg"),Promise.resolve()}generate(e){var r,s,o;const n=(r=this.root)==null?void 0:r.selectAll("g.legend-item");return this.shortenLabels(n,this.maxColumnWidth||0),this.maxColumnHeight||(s=this.root)==null||s.attr("viewBox",`0 0 ${this.size[0]} ${e}`).attr("height",e),(o=this.root)==null?void 0:o.node()}shortenLabels(e,n){e==null||e.each(function(){const r=oi(this),s=r.select("text");if(!(r.node()instanceof SVGElement)||!s.size())return;const o=s.node();let a=o.getBoundingClientRect().width,c=!1;for(;a>n;){let u=s.text();u=u.substring(0,u.length-1),s.text(u),a=o.getBoundingClientRect().width,c=!0}if(c){let u=s.text();u=u.substring(0,u.length-3),s.text(u+"...")}})}}const ur="geostyler-legend-renderer";function St(i){if(typeof i=="number")return i;const t=document.createElement("div");document.body.append(t),t.style.height=i;const e=parseFloat(getComputedStyle(t).height.replace(/px$/,""));return t.remove(),e}class vh extends hr{constructor(e,n,r,s){super(e,n,r);$(this,"canvas");$(this,"context");this.target=s,this.createCanvas(...e)}useContainer(e){}useRoot(){}addTitle(e,n,r){this.context.fillText(e,St(n),St(r))}addLabel(e,n,r){this.context.fillText(e,St(n),St(r))}async addImage(e,n,r,s,o,a){const c=St(s),u=St(o);this.expandHeight(u+r);const d=new Image,_=new Promise(g=>d.onload=g);d.src=e,await _,this.context.drawImage(d,c,u,n,r),a&&(this.context.strokeStyle="1px solid black",this.context.strokeRect(c,u,n,r))}generate(e){return this.canvas}createCanvas(e,n){this.canvas=document.createElement("canvas"),this.canvas.className=ur,this.canvas.width=e,this.canvas.height=n,this.context=this.canvas.getContext("2d"),this.context.font="14px sans-serif",this.target&&(this.target.querySelectorAll(`.${ur}`).forEach(r=>r.remove()),this.target.append(this.canvas))}expandHeight(e){if(this.canvas.height>=e)return;const n=this.canvas;this.createCanvas(this.canvas.width,e),this.context.drawImage(n,0,0)}}const R=[45,30];class Eh{constructor(t){$(this,"config",null);this.config=t}extractConfigFromStyle(t){const e={items:[],title:""};return t.name&&(e.title=t.name),t.rules.forEach(n=>{e.items.push({title:n.name,rule:n})}),e}renderLegendItem(t,e,n){if(!this.config)return;const{hideRect:r,maxColumnHeight:s,maxColumnWidth:o}=this.config;if(e.rule)return t.useContainer(e.title),this.getRuleIcon(e.rule).then(async a=>{await t.addImage(a,...R,n[0]+1,n[1],!r),t.addLabel(e.title,n[0]+R[0]+5,n[1]+20),n[1]+=R[1]+5,s&&n[1]+R[1]+5>=s&&(n[1]=5,n[0]+=o||0)}).catch(()=>{})}getGeometryForSymbolizer(t){if(!sn(t))throw new Error("Invalid symbolizer");switch(t.kind){case"Mark":case"Icon":case"Text":return new ve([R[0]/2,R[1]/2]);case"Fill":return new qt([[[3,3],[R[0]-3,3],[R[0]-3,R[1]-3],[3,R[1]-3],[3,3]]]);case"Line":return new Ht([[R[0]/6,R[1]/6],[R[0]/3,R[1]/3*2],[R[0]/2,R[1]/3],[R[0]/6*5,R[1]/6*5]]);default:return new ve([R[0]/2,R[1]/2])}}getRuleIcon(t){if(!mo(t))return Promise.reject("Invalid rule");const e=document.createElement("canvas");e.setAttribute("width",`${R[0]}`),e.setAttribute("height",`${R[1]}`);const n=lt([[0,0],[R[0],R[1]]]),r=1,s=e.getContext("2d"),o=ye(),a=new to(s,r,n,o,0),c=[];t.symbolizers.forEach(_=>c.push(this.getGeometryForSymbolizer(_)));const u=new Jn,d={name:"",rules:[{name:"",symbolizers:t.symbolizers}]};return new Promise(async(_,g)=>{function p(){c.forEach(x=>a.drawGeometry(x))}try{let{output:x,errors:C=[]}=await u.writeStyle(d);C.length>0&&g(C[0]),typeof x=="function"&&(x=x(new ni(c[0]),1)),Array.isArray(x)?x.forEach(E=>{a.setStyle(E),p()}):(a.setStyle(x),p()),_(e.toDataURL("image/png"))}catch{g()}})}renderLegend(t,e,n){if(this.config)return e.useRoot(),this.config.overflow!=="auto"&&n[0]!==0&&t.items.length*(R[1]+5)+20+n[1]>this.config.maxColumnHeight&&(n[0]+=this.config.maxColumnWidth,n[1]=0),t.title&&(e.addTitle(t.title,n[0],n[1]===0?"1em":n[1]+15),n[1]+=20),t.items.reduce((r,s)=>r.then(()=>this.renderLegendItem(e,s,n)),Promise.resolve())}async renderImages(t,e,n){for(let o=0;o<t.length;o++){const a=t[o].url,c=t[o].title;try{const d=await(await fetch(a)).blob(),g=await(async x=>new Promise((C,E)=>{try{const I=new FileReader;I.onload=async F=>{const O=F.target.result;C(O)},I.readAsDataURL(x)}catch(I){E(I)}}))(d);let p=new Image;p.src=g.toString(),await p.decode(),this.config.overflow==="auto"&&p.height+20+5+n[1]>this.config.maxColumnHeight&&(n[0]+=this.config.maxColumnWidth,n[1]=0),c&&(e.useRoot(),n[1]+=20,e.addTitle(c,...n),n[1]+=5),await e.addImage(g.toString(),p.width,p.height,...n,!1),n[1]+=p.height}catch(u){console.error("Error on fetching legend: ",u);continue}}}async renderAsImage(t,e){if(!this.config)return Promise.reject();const{styles:n,configs:r,size:[s,o],remoteLegends:a,maxColumnWidth:c,maxColumnHeight:u}=this.config,d=[];n&&n.forEach(x=>d.push(this.extractConfigFromStyle(x))),r&&d.unshift.apply(d,r);const _=t==="svg"?Ch:vh,g=new _([s,o],c||0,u||0,e),p=[0,0];for(let x=0;x<d.length;x++)await this.renderLegend(d[x],g,p);return a&&await this.renderImages(a,g,p),g.generate(p[1])}async render(t,e="svg"){await this.renderAsImage(e,t)}}return Z.LegendRenderer=Eh,Z}({});
//# sourceMappingURL=geoStylerLegend.iife.js.map
